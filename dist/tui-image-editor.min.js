/*!
 * tui-image-editor.min.js
 * @version 3.14.3
 * @author NHN. FE Development Lab <dl_javascript@nhn.com>
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("tui-code-snippet"),require("fabric").fabric):"function"==typeof define&&define.amd?define(["tui-code-snippet","fabric"],t):"object"==typeof exports?exports.ImageEditor=t(require("tui-code-snippet"),require("fabric").fabric):(e.tui=e.tui||{},e.tui.ImageEditor=t(e.tui.util,e.fabric))}(window,function(n,o){return a={},i.m=r=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultResizePixelValues=t.emptyCropRectValues=t.defaultFilterRangeValues=t.defaultTextRangeValues=t.defaultShapeStrokeValues=t.defaultDrawRangeValues=t.defaultRotateRangeValues=t.defaultIconPath=t.rejectMessages=t.fObjectOptions=t.keyCodes=t.zoomModes=t.drawingMenuNames=t.drawingModes=t.historyNames=t.selectorNames=t.eventNames=t.commandNames=t.CROPZONE_DEFAULT_OPTIONS=t.SHAPE_DEFAULT_OPTIONS=t.componentNames=t.filterType=t.OBJ_TYPE=t.SHAPE_TYPE=t.SHAPE_FILL_TYPE=t.HELP_MENUS=t.DELETE_HELP_MENUS=t.COMMAND_HELP_MENUS=t.ZOOM_HELP_MENUS=void 0;var o=n(1),i=t.ZOOM_HELP_MENUS=["zoomIn","zoomOut","hand"],r=t.COMMAND_HELP_MENUS=["history","undo","redo","reset"],n=t.DELETE_HELP_MENUS=["delete","deleteAll"];t.HELP_MENUS=[].concat(i,r,n),t.SHAPE_FILL_TYPE={FILTER:"filter",COLOR:"color"},t.SHAPE_TYPE=["rect","circle","triangle"],t.OBJ_TYPE={CROPZONE:"cropzone"},t.filterType={VINTAGE:"vintage",SEPIA2:"sepia2",REMOVE_COLOR:"removeColor",COLOR_FILTER:"colorFilter",REMOVE_WHITE:"removeWhite",BLEND_COLOR:"blendColor",BLEND:"blend"},t.componentNames=(0,o.keyMirror)("IMAGE_LOADER","CROPPER","FLIP","ROTATION","FREE_DRAWING","LINE","TEXT","ICON","FILTER","SHAPE","ZOOM","RESIZE"),t.SHAPE_DEFAULT_OPTIONS={lockSkewingX:!0,lockSkewingY:!0,bringForward:!0,isRegular:!1},t.CROPZONE_DEFAULT_OPTIONS={hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0,lockSkewingX:!0,lockSkewingY:!0},t.commandNames={CLEAR_OBJECTS:"clearObjects",LOAD_IMAGE:"loadImage",FLIP_IMAGE:"flip",ROTATE_IMAGE:"rotate",ADD_OBJECT:"addObject",REMOVE_OBJECT:"removeObject",APPLY_FILTER:"applyFilter",REMOVE_FILTER:"removeFilter",ADD_ICON:"addIcon",CHANGE_ICON_COLOR:"changeIconColor",ADD_SHAPE:"addShape",CHANGE_SHAPE:"changeShape",ADD_TEXT:"addText",CHANGE_TEXT:"changeText",CHANGE_TEXT_STYLE:"changeTextStyle",ADD_IMAGE_OBJECT:"addImageObject",RESIZE_CANVAS_DIMENSION:"resizeCanvasDimension",SET_OBJECT_PROPERTIES:"setObjectProperties",SET_OBJECT_POSITION:"setObjectPosition",CHANGE_SELECTION:"changeSelection",RESIZE_IMAGE:"resize"},t.eventNames={OBJECT_ACTIVATED:"objectActivated",OBJECT_MOVED:"objectMoved",OBJECT_SCALED:"objectScaled",OBJECT_CREATED:"objectCreated",OBJECT_ROTATED:"objectRotated",OBJECT_ADDED:"objectAdded",OBJECT_MODIFIED:"objectModified",TEXT_EDITING:"textEditing",TEXT_CHANGED:"textChanged",ICON_CREATE_RESIZE:"iconCreateResize",ICON_CREATE_END:"iconCreateEnd",ADD_TEXT:"addText",ADD_OBJECT:"addObject",ADD_OBJECT_AFTER:"addObjectAfter",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",REDO_STACK_CHANGED:"redoStackChanged",UNDO_STACK_CHANGED:"undoStackChanged",SELECTION_CLEARED:"selectionCleared",SELECTION_CREATED:"selectionCreated",EXECUTE_COMMAND:"executeCommand",AFTER_UNDO:"afterUndo",AFTER_REDO:"afterRedo",ZOOM_CHANGED:"zoomChanged",HAND_STARTED:"handStarted",HAND_STOPPED:"handStopped",KEY_DOWN:"keydown",KEY_UP:"keyup",INPUT_BOX_EDITING_STARTED:"inputBoxEditingStarted",INPUT_BOX_EDITING_STOPPED:"inputBoxEditingStopped",FOCUS:"focus",BLUR:"blur",IMAGE_RESIZED:"imageResized"},t.selectorNames={COLOR_PICKER_INPUT_BOX:".tui-colorpicker-palette-hex"},t.historyNames={LOAD_IMAGE:"Load",LOAD_MASK_IMAGE:"Mask",ADD_MASK_IMAGE:"Mask",ADD_IMAGE_OBJECT:"Mask",CROP:"Crop",RESIZE:"Resize",APPLY_FILTER:"Filter",REMOVE_FILTER:"Filter",CHANGE_SHAPE:"Shape",CHANGE_ICON_COLOR:"Icon",ADD_TEXT:"Text",CHANGE_TEXT_STYLE:"Text",REMOVE_OBJECT:"Delete",CLEAR_OBJECTS:"Delete"},t.drawingModes=(0,o.keyMirror)("NORMAL","CROPPER","FREE_DRAWING","LINE_DRAWING","TEXT","SHAPE","ICON","ZOOM","RESIZE"),t.drawingMenuNames={TEXT:"text",CROP:"crop",RESIZE:"resize",SHAPE:"shape",ZOOM:"zoom"},t.zoomModes={DEFAULT:"normal",ZOOM:"zoom",HAND:"hand"},t.keyCodes={Z:90,Y:89,C:67,V:86,SHIFT:16,BACKSPACE:8,DEL:46,ARROW_DOWN:40,ARROW_UP:38,SPACE:32},t.fObjectOptions={SELECTION_STYLE:{borderColor:"red",cornerColor:"green",cornerSize:10,originX:"center",originY:"center",transparentCorners:!1}},t.rejectMessages={addedObject:"The object is already added.",flip:"The flipX and flipY setting values are not changed.",invalidDrawingMode:"This operation is not supported in the drawing mode.",invalidParameters:"Invalid parameters.",isLock:"The executing command state is locked.",loadImage:"The background image is empty.",loadingImageFailed:"Invalid image loaded.",noActiveObject:"There is no active object.",noObject:"The object is not in canvas.",redo:"The promise of redo command is reject.",rotation:"The current angle is same the old angle.",undo:"The promise of undo command is reject.",unsupportedOperation:"Unsupported operation.",unsupportedType:"Unsupported object type."},t.defaultIconPath={"icon-arrow":"M40 12V0l24 24-24 24V36H0V12h40z","icon-arrow-2":"M49,32 H3 V22 h46 l-18,-18 h12 l23,23 L43,50 h-12 l18,-18  z ","icon-arrow-3":"M43.349998,27 L17.354,53 H1.949999 l25.996,-26 L1.949999,1 h15.404 L43.349998,27  z ","icon-star":"M35,54.557999 l-19.912001,10.468 l3.804,-22.172001 l-16.108,-15.7 l22.26,-3.236 L35,3.746 l9.956,20.172001 l22.26,3.236 l-16.108,15.7 l3.804,22.172001  z ","icon-star-2":"M17,31.212 l-7.194,4.08 l-4.728,-6.83 l-8.234,0.524 l-1.328,-8.226 l-7.644,-3.14 l2.338,-7.992 l-5.54,-6.18 l5.54,-6.176 l-2.338,-7.994 l7.644,-3.138 l1.328,-8.226 l8.234,0.522 l4.728,-6.83 L17,-24.312 l7.194,-4.08 l4.728,6.83 l8.234,-0.522 l1.328,8.226 l7.644,3.14 l-2.338,7.992 l5.54,6.178 l-5.54,6.178 l2.338,7.992 l-7.644,3.14 l-1.328,8.226 l-8.234,-0.524 l-4.728,6.83  z ","icon-polygon":"M3,31 L19,3 h32 l16,28 l-16,28 H19  z ","icon-location":"M24 62C8 45.503 0 32.837 0 24 0 10.745 10.745 0 24 0s24 10.745 24 24c0 8.837-8 21.503-24 38zm0-28c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z","icon-heart":"M49.994999,91.349998 l-6.96,-6.333 C18.324001,62.606995 2.01,47.829002 2.01,29.690998 C2.01,14.912998 13.619999,3.299999 28.401001,3.299999 c8.349,0 16.362,5.859 21.594,12 c5.229,-6.141 13.242001,-12 21.591,-12 c14.778,0 26.390999,11.61 26.390999,26.390999 c0,18.138 -16.314001,32.916 -41.025002,55.374001 l-6.96,6.285  z ","icon-bubble":"M44 48L34 58V48H12C5.373 48 0 42.627 0 36V12C0 5.373 5.373 0 12 0h40c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12h-8z"},t.defaultRotateRangeValues={realTimeEvent:!0,min:-360,max:360,value:0},t.defaultDrawRangeValues={min:5,max:30,value:12},t.defaultShapeStrokeValues={realTimeEvent:!0,min:2,max:300,value:3},t.defaultTextRangeValues={realTimeEvent:!0,min:10,max:100,value:50},t.defaultFilterRangeValues={tintOpacityRange:{realTimeEvent:!0,min:0,max:1,value:.7,useDecimal:!0},removewhiteDistanceRange:{realTimeEvent:!0,min:0,max:1,value:.2,useDecimal:!0},brightnessRange:{realTimeEvent:!0,min:-1,max:1,value:0,useDecimal:!0},noiseRange:{realTimeEvent:!0,min:0,max:1e3,value:100},pixelateRange:{realTimeEvent:!0,min:2,max:20,value:4},colorfilterThresholdRange:{realTimeEvent:!0,min:0,max:1,value:.2,useDecimal:!0},blurFilterRange:{value:.1}},t.emptyCropRectValues={LEFT:0,TOP:0,WIDTH:.5,HEIGHT:.5},t.defaultResizePixelValues={realTimeEvent:!0,min:32,max:4088,value:800}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Promise=void 0,t.clamp=function(e,t,n){{var o;n<t&&(t=(o=[n,t])[0],n=o[1])}return l(t,u(e,n))},t.keyMirror=function(){for(var t={},e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return(0,i.forEach)(n,function(e){t[e]=e}),t},t.makeStyleText=function(e){var n="";return(0,i.forEach)(e,function(e,t){n+=t+": "+e+";"}),n},t.getProperties=function(e,t){var n={},o=t.length,i=0,r=void 0;for(i=0;i<o;i+=1)r=t[i],n[r]=e[r];return n},t.toInteger=function(e){return parseInt(e,10)},t.toCamelCase=function(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})},t.isSupportFileApi=function(){return!!(window.File&&window.FileList&&window.FileReader)},t.getRgb=function(e,t){4===e.length&&(e=""+e+e.slice(1,4));var n=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),e=parseInt(e.slice(5,7),16);return"rgba("+n+", "+o+", "+e+", "+(t||1)+")"},t.sendHostName=function(){h||(h=!0,(0,i.sendHostname)("image-editor","UA-129999381-1"))},t.styleLoad=function(e,t){var n=document.getElementsByTagName("head")[0],o=document.createElement("link"),e=encodeURIComponent(e);t&&(o.id=t);o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","data:text/css;charset=UTF-8,"+e),n.appendChild(o)},t.getSelector=function(t){return function(e){return t.querySelector(e)}},t.base64ToBlob=function(e){var n="",t=void 0,o=void 0,i=void 0;t=e.replace(/data:(image\/.+);base64,/,function(e,t){return n=t,""});var r=(t=atob(t)).length;for(o=new Uint8Array(r),i=0;i<r;i+=1)o[i]=t.charCodeAt(i);return new Blob([o],{type:n})},t.fixFloatingPoint=function(e){return Number(e.toFixed(s))},t.assignmentForDestroy=function(n){(0,i.forEach)(n,function(e,t){n[t]=null})},t.cls=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return"."!==e.charAt(0)?""+c+t+e:"."+c+t+e.slice(1)},t.changeOrigin=function(e,t){var n=t.originX,o=t.originY,i=e.getPointByOrigin(n,o),t=i.x,i=i.y;e.set({left:t,top:i,originX:n,originY:o}),e.setCoords()},t.flipObject=function(t){var n={};return Object.keys(t).forEach(function(e){n[t[e]]=e}),n},t.setCustomProperty=function(e,t){e.customProps=e.customProps||{},(0,i.extend)(e.customProps,t)},t.getCustomProperty=function(t,e){var n={};(0,i.isString)(e)&&(e=[e]);return(0,i.forEach)(e,function(e){n[e]=t.customProps[e]}),n},t.capitalizeString=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},t.includes=f,t.getFillTypeFromOption=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,i.pick)(e,"type")||g.SHAPE_FILL_TYPE.COLOR},t.getFillTypeFromObject=function(e){e=e.fill;if((void 0===e?{}:e).source)return g.SHAPE_FILL_TYPE.FILTER;return g.SHAPE_FILL_TYPE.COLOR},t.isShape=function(e){return 0<=(0,i.inArray)(e.get("type"),g.SHAPE_TYPE)},t.getObjectType=function(e){if(f(g.SHAPE_TYPE,e))return"Shape";switch(e){case"i-text":return"Text";case"path":case"line":return"Draw";case"activeSelection":return"Group";default:return m(e)}},t.isSilentCommand=function(e){var t=g.commandNames.LOAD_IMAGE;return"string"==typeof e?t===e:t===e.name},t.getHistoryTitle=function(e){var t=g.commandNames.FLIP_IMAGE,n=g.commandNames.ROTATE_IMAGE,o=g.commandNames.ADD_TEXT,i=g.commandNames.APPLY_FILTER,r=g.commandNames.REMOVE_FILTER,a=g.commandNames.CHANGE_SHAPE,s=g.commandNames.CHANGE_ICON_COLOR,c=g.commandNames.CHANGE_TEXT_STYLE,u=g.commandNames.CLEAR_OBJECTS,l=g.commandNames.ADD_IMAGE_OBJECT,h=g.commandNames.REMOVE_OBJECT,f=g.commandNames.RESIZE_IMAGE,d=e.name,p=e.args,v=void 0;switch(d){case t:v={name:d,detail:"reset"===p[1]?p[1]:p[1].slice(4)};break;case n:v={name:d,detail:p[2]};break;case i:v={name:g.historyNames.APPLY_FILTER,detail:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.useAlpha,o=void 0===n||n,i=t.mode,r=g.filterType.VINTAGE,n=g.filterType.REMOVE_COLOR,t=g.filterType.BLEND_COLOR,a=g.filterType.SEPIA2,s=g.filterType.COLOR_FILTER,c=g.filterType.REMOVE_WHITE,u=g.filterType.BLEND,l=void 0;switch(e){case r:l=a;break;case n:l=o?s:c;break;case t:l="add"===i?u:i;break;default:l=e}return m(l)}(p[1],p[2])};break;case r:v={name:g.historyNames.REMOVE_FILTER,detail:"Remove"};break;case a:v={name:g.historyNames.CHANGE_SHAPE,detail:"Change"};break;case s:v={name:g.historyNames.CHANGE_ICON_COLOR,detail:"Change"};break;case c:v={name:g.historyNames.CHANGE_TEXT_STYLE,detail:"Change"};break;case h:v={name:g.historyNames.REMOVE_OBJECT,detail:p[2]};break;case u:v={name:g.historyNames.CLEAR_OBJECTS,detail:"All"};break;case l:v={name:g.historyNames.ADD_IMAGE_OBJECT,detail:"Add"};break;case o:v={name:g.historyNames.ADD_TEXT};break;case f:v={name:g.historyNames.RESIZE,detail:~~p[1].width+"x"+~~p[1].height};break;default:v={name:d}}"mask"===p[1]&&(v={name:g.historyNames.LOAD_MASK_IMAGE,detail:"Apply"});return v},t.getHelpMenuBarPosition=function(e){return"top"!==e?"left"!==e?"right"!==e?"top":"left":"right":"bottom"},t.isEmptyCropzone=function(e){var t=e.left,n=e.top,o=e.width,i=e.height,r=g.emptyCropRectValues.LEFT,a=g.emptyCropRectValues.TOP,s=g.emptyCropRectValues.WIDTH,e=g.emptyCropRectValues.HEIGHT;return t===r&&n===a&&o===s&&i===e};var o,i=n(3),r=n(76),a=(o=r)&&o.__esModule?o:{default:o},g=n(0);var s=2,c="tui-image-editor-",u=Math.min,l=Math.max,h=!1;function f(e,t){return 0<=e.indexOf(t)}function m(e){return e.replace(/[a-z]/,function(e){return e.toUpperCase()})}t.Promise=a.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(75),r=(o=i)&&o.__esModule?o:{default:o};var a={};t.default={create:function(e){if(e=a[e]){for(var t=arguments.length,n=Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return new r.default(e,n)}return null},register:function(e){a[e.name]=e}}},function(e,t){e.exports=n},function(e,t){e.exports=o},function(n,e,t){!function(e){function t(e){return e&&e.Math==Math&&e}n.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof e&&e)||function(){return this}()||Function("return this")()}.call(this,t(78))},function(e,t,n){var o=n(5),i=n(52),r=n(10),a=n(53),s=n(58),n=n(90),c=i("wks"),u=o.Symbol,l=n?u:u&&u.withoutSetter||a;e.exports=function(e){return r(c,e)&&(s||"string"==typeof c[e])||(s&&r(u,e)?c[e]=u[e]:c[e]=l("Symbol."+e)),c[e]}},function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}(r,[{key:"fire",value:function(){for(var e=this.graphics,t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return this.graphics.fire.apply(e,n)}},{key:"setCanvasImage",value:function(e,t){this.graphics.setCanvasImage(e,t)}},{key:"getCanvasElement",value:function(){return this.graphics.getCanvasElement()}},{key:"getCanvas",value:function(){return this.graphics.getCanvas()}},{key:"getCanvasImage",value:function(){return this.graphics.getCanvasImage()}},{key:"getImageName",value:function(){return this.graphics.getImageName()}},{key:"getEditor",value:function(){return this.graphics.getEditor()}},{key:"getName",value:function(){return this.name}},{key:"setImageProperties",value:function(e,t){this.graphics.setImageProperties(e,t)}},{key:"setCanvasCssDimension",value:function(e){this.graphics.setCanvasCssDimension(e)}},{key:"setCanvasBackstoreDimension",value:function(e){this.graphics.setCanvasBackstoreDimension(e)}},{key:"adjustCanvasDimension",value:function(){this.graphics.adjustCanvasDimension()}},{key:"adjustCanvasDimensionBase",value:function(){this.graphics.adjustCanvasDimensionBase()}}]),r);function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.name=e,this.graphics=t}t.default=i},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var o=n(15),i=n(23),r=n(21);e.exports=o?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var o=n(49),i={}.hasOwnProperty;e.exports=function(e,t){return i.call(o(e),t)}},function(e,t,n){var o=n(14);e.exports=function(e){if(!o(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(45),n=(r=a)&&r.__esModule?r:{default:r};var s=n.default.create,c=n.default.types,o=(o(u,[{key:"getName",value:function(){return this.name}},{key:"start",value:function(){throw new Error(s(c.UN_IMPLEMENTATION,"start"))}},{key:"end",value:function(){throw new Error(s(c.UN_IMPLEMENTATION,"stop"))}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.name=e}t.default=o},function(e,t,n){"use strict";function p(o){function e(e,t,n){if(this instanceof o){switch(arguments.length){case 0:return new o;case 1:return new o(e);case 2:return new o(e,t)}return new o(e,t,n)}return o.apply(this,arguments)}return e.prototype=o.prototype,e}var v=n(5),g=n(47).f,m=n(51),y=n(31),_=n(32),b=n(9),O=n(10);e.exports=function(e,t){var n,o,i,r,a,s=e.target,c=e.global,u=e.stat,l=e.proto,h=c?v:u?v[s]:(v[s]||{}).prototype,f=c?y:y[s]||(y[s]={}),d=f.prototype;for(n in t)r=!m(c?n:s+(u?".":"#")+n,e.forced)&&h&&O(h,n),o=f[n],r&&(i=e.noTargetGet?(a=g(h,n))&&a.value:h[n]),a=r&&i?i:t[n],r&&typeof o==typeof a||(r=e.bind&&r?_(a,v):e.wrap&&r?p(a):l&&"function"==typeof a?_(Function.call,a):a,(e.sham||a&&a.sham||o&&o.sham)&&b(r,"sham",!0),f[n]=r,l&&(O(y,r=s+"Prototype")||b(y,r,{}),y[r][n]=a,e.real&&d&&!d[n]&&b(d,n,a)))}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){n=n(8);e.exports=!n(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,n){function o(e){return"function"==typeof e?e:void 0}var i=n(31),r=n(5);e.exports=function(e,t){return arguments.length<2?o(i[e])||o(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}},function(e,t){e.exports={}},function(e,t){e.exports=!0},function(e,t,n){"use strict";function o(e){var n,o;this.promise=new e(function(e,t){if(void 0!==n||void 0!==o)throw TypeError("Bad Promise constructor");n=e,o=t}),this.resolve=i(n),this.reject=i(o)}var i=n(16);e.exports.f=function(e){return new o(e)}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var o=n(80),i=n(29);e.exports=function(e){return o(i(e))}},function(e,t,n){var o=n(15),i=n(50),r=n(11),a=n(48),s=Object.defineProperty;t.f=o?s:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){function g(e,t){this.stopped=e,this.result=t}var m=n(11),y=n(89),_=n(55),b=n(32),O=n(91),E=n(92);e.exports=function(e,t,n){function o(e){return r&&E(r),new g(!0,e)}function i(e){return f?(m(e),p?v(e[0],e[1],o):v(e[0],e[1])):p?v(e,o):v(e)}var r,a,s,c,u,l,h=n&&n.that,f=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),v=b(t,h,1+f+p);if(d)r=e;else{if("function"!=typeof(d=O(e)))throw TypeError("Target is not iterable");if(y(d)){for(a=0,s=_(e.length);a<s;a++)if((c=i(e[a]))&&c instanceof g)return c;return new g(!1)}r=d.call(e)}for(u=r.next;!(l=u.call(r)).done;){try{c=i(l.value)}catch(e){throw E(r),e}if("object"==typeof c&&c&&c instanceof g)return c}return new g(!1)}},function(e,t,n){var i=n(9);e.exports=function(e,t,n,o){o&&o.enumerable?e[t]=n:i(e,t,n)}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCachedUndoDataForDimension=function(e){a=e},t.getCachedUndoDataForDimension=function(){return a},t.makeSelectionUndoData=function(u,l){var e=void 0;e="activeSelection"===u.type?u.getObjects().map(function(e){var t=e.angle,n=e.left,o=e.top,i=e.scaleX,r=e.scaleY,a=e.width,s=e.height;h.default.util.addTransformToObject(e,u.calcTransformMatrix());var c=l(e);return e.set({angle:t,left:n,top:o,width:a,height:s,scaleX:i,scaleY:r}),c}):[l(u)];return e},t.makeSelectionUndoDatum=function(e,t,n){return n?{id:e,width:t.width,height:t.height,top:t.top,left:t.left,angle:t.angle,scaleX:t.scaleX,scaleY:t.scaleY}:(0,i.extend)({id:e},t)};var o,i=n(3),r=n(4),h=(o=r)&&o.__esModule?o:{default:o};var a=null},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var o=n(5),n=n(14),i=o.document,r=n(i)&&n(i.createElement);e.exports=function(e){return r?i.createElement(e):{}}},function(e,t){e.exports={}},function(e,t,n){var r=n(16);e.exports=function(o,i,e){if(r(o),void 0===i)return o;switch(e){case 0:return function(){return o.call(i)};case 1:return function(e){return o.call(i,e)};case 2:return function(e,t){return o.call(i,e,t)};case 3:return function(e,t,n){return o.call(i,e,t,n)}}return function(){return o.apply(i,arguments)}}},function(e,t,n){var o=n(10),i=n(49),r=n(34),n=n(82),a=r("IE_PROTO"),s=Object.prototype;e.exports=n?Object.getPrototypeOf:function(e){return e=i(e),o(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,n){var o=n(52),i=n(53),r=o("keys");e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var o=n(5),i=n(81),n="__core-js_shared__",n=o[n]||i(n,{});e.exports=n},function(e,t,n){var i=n(11),r=n(83);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,o=!1,e={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),o=e instanceof Array}catch(e){}return function(e,t){return i(e),r(t),o?n.call(e,t):e.__proto__=t,e}}():void 0)},function(e,t){var n=Math.ceil,o=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?o:n)(e)}},function(e,t){e.exports={}},function(e,t,n){n=n(17);e.exports=n("navigator","userAgent")||""},function(e,t,n){var o=n(41),i=n(28),r=n(6)("toStringTag"),a="Arguments"==i(function(){return arguments}());e.exports=o?i:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(e=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),r))?e:a?i(t):"Object"==(e=i(t))&&"function"==typeof t.callee?"Arguments":e}},function(e,t,n){var o={};o[n(6)("toStringTag")]="z",e.exports="[object z]"===String(o)},function(e,t,n){var i=n(41),r=n(23).f,a=n(9),s=n(10),c=n(96),u=n(6)("toStringTag");e.exports=function(e,t,n,o){e&&(e=n?e:e.prototype,s(e,u)||r(e,u,{configurable:!0,value:t}),o&&!i&&a(e,"toString",c))}},function(e,t,n){var o=n(28),n=n(5);e.exports="process"==o(n.process)},function(e,t,n){var o,i,r,a,s,c,u,l,h=n(103),f=n(5),d=n(14),p=n(9),v=n(10),g=n(35),m=n(34),n=n(38),y="Object already initialized",f=f.WeakMap;u=h||g.state?(o=g.state||(g.state=new f),i=o.get,r=o.has,a=o.set,s=function(e,t){if(r.call(o,e))throw new TypeError(y);return t.facade=e,a.call(o,e,t),t},c=function(e){return i.call(o,e)||{}},function(e){return r.call(o,e)}):(n[l=m("state")]=!0,s=function(e,t){if(v(e,l))throw new TypeError(y);return t.facade=e,p(e,l,t),t},c=function(e){return v(e,l)?e[l]:{}},function(e){return v(e,l)}),e.exports={set:s,get:c,has:u,enforce:function(e){return u(e)?c(e):s(e,{})},getterFor:function(n){return function(e){var t;if(!d(e)||(t=c(e)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o};var n=(0,n(1).keyMirror)("UN_IMPLEMENTATION","NO_COMPONENT_NAME"),a="Should implement a method: ",s="Should set a component name",c={UN_IMPLEMENTATION:function(e){return a+e},NO_COMPONENT_NAME:function(){return s}};t.default={types:r.default.extend({},n),create:function(e){e=e.toLowerCase();for(var e=c[e],t=arguments.length,n=Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return e.apply(void 0,n)}}},function(e,t,n){"use strict";var o=n(13),i=n(33),r=n(36),a=n(54),s=n(9),c=n(21),u=n(24),l=function(e,t){var n=this;if(!(n instanceof l))return new l(e,t);r&&(n=r(new Error(void 0),i(n))),void 0!==t&&s(n,"message",String(t));t=[];return u(e,t.push,{that:t}),s(n,"errors",t),n};l.prototype=a(Error.prototype,{constructor:c(5,l),message:c(5,""),name:c(5,"AggregateError")}),o({global:!0},{AggregateError:l})},function(e,t,n){var o=n(15),i=n(79),r=n(21),a=n(22),s=n(48),c=n(10),u=n(50),l=Object.getOwnPropertyDescriptor;t.f=o?l:function(e,t){if(e=a(e),t=s(t,!0),u)try{return l(e,t)}catch(e){}if(c(e,t))return r(!i.f.call(e,t),e[t])}},function(e,t,n){var i=n(14);e.exports=function(e,t){if(!i(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!i(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!i(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!i(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var o=n(29);e.exports=function(e){return Object(o(e))}},function(e,t,n){var o=n(15),i=n(8),r=n(30);e.exports=!o&&!i(function(){return 7!=Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var o=n(8),i=/#|\.prototype\./,n=function(e,t){e=a[r(e)];return e==c||e!=s&&("function"==typeof t?o(t):!!t)},r=n.normalize=function(e){return String(e).replace(i,".").toLowerCase()},a=n.data={},s=n.NATIVE="N",c=n.POLYFILL="P";e.exports=n},function(e,t,n){var o=n(19),i=n(35);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.13.0",mode:o?"pure":"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t){var n=0,o=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+o).toString(36)}},function(e,t,n){function o(){}function i(e){return"<script>"+e+"</"+d+">"}var r,a=n(11),s=n(84),c=n(56),u=n(38),l=n(57),h=n(30),n=n(34),f="prototype",d="script",p=n("IE_PROTO"),v=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e;v=r?function(e){e.write(i("")),e.close();var t=e.parentWindow.Object;return e=null,t}(r):((e=h("iframe")).style.display="none",l.appendChild(e),e.src=String("javascript:"),(e=e.contentWindow.document).open(),e.write(i("document.F=Object")),e.close(),e.F);for(var t=c.length;t--;)delete v[f][c[t]];return v()};u[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(o[f]=a(e),n=new o,o[f]=null,n[p]=e):n=v(),void 0===t?n:s(n,t)}},function(e,t,n){var o=n(37),i=Math.min;e.exports=function(e){return 0<e?i(o(e),9007199254740991):0}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,n){n=n(17);e.exports=n("document","documentElement")},function(e,t,n){var o=n(59),n=n(8);e.exports=!!Object.getOwnPropertySymbols&&!n(function(){return!String(Symbol())||!Symbol.sham&&o&&o<41})},function(e,t,n){var o,i,r=n(5),n=n(39),r=r.process,r=r&&r.versions,r=r&&r.v8;r?i=(o=r.split("."))[0]<4?1:o[0]+o[1]:n&&(!(o=n.match(/Edge\/(\d+)/))||74<=o[1])&&(o=n.match(/Chrome\/(\d+)/))&&(i=o[1]),e.exports=i&&+i},function(e,t,n){n=n(5);e.exports=n.Promise},function(e,t,n){var n=n(35),o=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return o.call(e)}),e.exports=n.inspectSource},function(e,t,n){var o=n(11),i=n(16),r=n(6)("species");e.exports=function(e,t){var n,e=o(e).constructor;return void 0===e||null==(n=o(e)[r])?t:i(n)}},function(e,t,n){function o(e){var t;O.hasOwnProperty(e)&&(t=O[e],delete O[e],t())}function i(e){return function(){o(e)}}function r(e){o(e.data)}var a,s=n(5),c=n(8),u=n(32),l=n(57),h=n(30),f=n(64),d=n(43),p=s.location,v=s.setImmediate,g=s.clearImmediate,m=s.process,y=s.MessageChannel,_=s.Dispatch,b=0,O={},E="onreadystatechange",n=function(e){s.postMessage(e+"",p.protocol+"//"+p.host)};v&&g||(v=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return O[++b]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},a(b),b},g=function(e){delete O[e]},d?a=function(e){m.nextTick(i(e))}:_&&_.now?a=function(e){_.now(i(e))}:y&&!f?(y=(f=new y).port2,f.port1.onmessage=r,a=u(y.postMessage,y,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts&&p&&"file:"!==p.protocol&&!c(n)?(a=n,s.addEventListener("message",r,!1)):a=E in h("script")?function(e){l.appendChild(h("script"))[E]=function(){l.removeChild(this),o(e)}}:function(e){setTimeout(i(e),0)}),e.exports={set:v,clear:g}},function(e,t,n){n=n(39);e.exports=/(?:iphone|ipod|ipad).*applewebkit/i.test(n)},function(e,t,n){var o=n(11),i=n(14),r=n(20);e.exports=function(e,t){if(o(e),i(t)&&t.constructor===e)return t;e=r.f(e);return(0,e.resolve)(t),e.promise}},function(e,t,n){"use strict";var o=n(13),u=n(16),i=n(20),r=n(26),l=n(24);o({target:"Promise",stat:!0},{allSettled:function(e){var s=this,t=i.f(s),c=t.resolve,n=t.reject,o=r(function(){var o=u(s.resolve),i=[],r=0,a=1;l(e,function(e){var t=r++,n=!1;i.push(void 0),a++,o.call(s,e).then(function(e){n||(n=!0,i[t]={status:"fulfilled",value:e},--a||c(i))},function(e){n||(n=!0,i[t]={status:"rejected",reason:e},--a||c(i))})}),--a||c(i)});return o.error&&n(o.value),t.promise}})},function(e,t,n){"use strict";var o=n(13),h=n(16),f=n(17),i=n(20),r=n(26),d=n(24),p="No one promise resolved";o({target:"Promise",stat:!0},{any:function(e){var c=this,t=i.f(c),u=t.resolve,l=t.reject,n=r(function(){var o=h(c.resolve),i=[],r=0,a=1,s=!1;d(e,function(e){var t=r++,n=!1;i.push(void 0),a++,o.call(c,e).then(function(e){n||s||(s=!0,u(e))},function(e){n||s||(n=!0,i[t]=e,--a||l(new(f("AggregateError"))(i,p)))})}),--a||l(new(f("AggregateError"))(i,p))});return n.error&&l(n.value),t.promise}})},function(e,t,n){"use strict";function v(){return this}var g=n(13),m=n(108),y=n(33),_=n(36),b=n(42),O=n(9),E=n(25),o=n(6),C=n(19),w=n(18),n=n(69),k=n.IteratorPrototype,M=n.BUGGY_SAFARI_ITERATORS,j=o("iterator"),x="values",P="entries";e.exports=function(e,t,n,o,i,r,a){m(n,t,o);function s(e){if(e===i&&p)return p;if(!M&&e in f)return f[e];switch(e){case"keys":case x:case P:return function(){return new n(this,e)}}return function(){return new n(this)}}var c,u,l=t+" Iterator",h=!1,f=e.prototype,d=f[j]||f["@@iterator"]||i&&f[i],p=!M&&d||s(i),o="Array"==t&&f.entries||d;if(o&&(e=y(o.call(new e)),k!==Object.prototype&&e.next&&(C||y(e)===k||(_?_(e,k):"function"!=typeof e[j]&&O(e,j,v)),b(e,l,!0,!0),C&&(w[l]=v))),i==x&&d&&d.name!==x&&(h=!0,p=function(){return d.call(this)}),C&&!a||f[j]===p||O(f,j,p),w[t]=p,i)if(c={values:s(x),keys:r?p:s("keys"),entries:s(P)},a)for(u in c)!M&&!h&&u in f||E(f,u,c[u]);else g({target:t,proto:!0,forced:M||h},c);return c}},function(e,t,n){"use strict";var o,i=n(8),r=n(33),a=n(9),s=n(10),c=n(6),u=n(19),l=c("iterator"),n=!1;[].keys&&("next"in(c=[].keys())?(c=r(r(c)))!==Object.prototype&&(o=c):n=!0);i=null==o||i(function(){var e={};return o[l].call(e)!==e});i&&(o={}),u&&!i||s(o,l)||a(o,l,function(){return this}),e.exports={IteratorPrototype:o,BUGGY_SAFARI_ITERATORS:n}},function(e,t,n){"use strict";var f={rect:1,circle:2,triangle:1},d={rect:{w:"width",h:"height"},circle:{w:"rx",h:"ry"},triangle:{w:"width",h:"height"}};function p(e,t,n){var o=e.x,i=e.y,e=t.x,t=t.y,n=n*Math.PI/180;return{originX:(e-o)*Math.cos(n)-(t-i)*Math.sin(n)+o<o?"right":"left",originY:(e-o)*Math.sin(n)+(t-i)*Math.cos(n)+i<i?"bottom":"top"}}e.exports={setOrigins:function(e){var t=e.getPointByOrigin("left","top"),n=e.getPointByOrigin("right","top"),o=e.getPointByOrigin("right","bottom"),i=e.getPointByOrigin("left","bottom");e.origins={lt:t,rt:n,rb:o,lb:i}},resize:function(e,t,n){var o,i,r,a,s,c,u,l,h;"center"===(o=e).originX&&"center"===o.originY&&(r=t,c=(a=e).getPointByOrigin("center","center"),s=(i=p(c,r,-a.angle)).originX,u=i.originY,r=a.getPointByOrigin(s,u),i=a.left-(c.x-r.x),r=a.top-(c.y-r.y),a.set({originX:s,originY:u,left:i,top:r}),a.setCoords(),s=(c=e).originX,u=c.originY,u=s.substring(0,1)+u.substring(0,1),c.startPoint=c.origins[u]),n?function(e){var t=e.type,n=e.scaleX,o=e.scaleY,i=d[t],r=e[i.w]*n,t=e[i.h]*o;e.isRegular&&(a=Math.max(n,o),r=e[i.w]*a,t=e[i.h]*a);var a={hasControls:!1,hasBorders:!1,scaleX:1,scaleY:1};a[i.w]=r,a[i.h]=t,e.set(a)}(e):(i=t,r=(l=e).type,a=l.strokeWidth,s=l.startPoint,c=f[r],u=d[r],n=!("triangle"!==l.type),h={},r=Math.abs(s.x-i.x)/c,i=Math.abs(s.y-i.y)/c,a<r&&(r-=a/c),a<i&&(i-=a/c),l.isRegular&&(r=i=Math.max(r,i),n&&(i=Math.sqrt(3)/2*r)),h[u.w]=r,h[u.h]=i,l.set(h)),l=t,e=(h=e).startPoint,l=(t=p(e,t,-h.angle)).originX,t=t.originY,h.setPositionByOrigin(e,l,t),h.setCoords()},adjustOriginToCenter:function(e){var t=e.getPointByOrigin("center","center"),n=e.originX,o=e.originY,n=e.getPointByOrigin(n,o),o=e.left+(t.x-n.x),n=e.top+(t.y-n.y);e.set({hasControls:!0,hasBorders:!0,originX:"center",originY:"center",left:o,top:n}),e.setCoords()}}},function(e,t,n){"use strict";n(72);var o,i=n(73),r=(o=i)&&o.__esModule?o:{default:o};n(147),n(148),n(149),n(150),n(151),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(167),n(168),e.exports=r.default},function(e,t,n){"use strict";var o,i,r,v,a,g,m,y,s,c;Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t}while(null!==(t=t.parentElement||t.parentNode)&&1===t.nodeType);return null})
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */,"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||function(e){if("Element"in e){var t="classList",n="prototype",o=e.Element[n],i=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},a=Array[n].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},s=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},c=function(e,t){if(""===t)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return a.call(e,t)},u=function(e){for(var t=r.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],o=0,i=n.length;o<i;o++)this.push(n[o]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=u[n]=[],e=function(){return new u(this)};if(s[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return-1!==c(this,e+="")},l.add=function(){for(var e,t=arguments,n=0,o=t.length,i=!1;-1===c(this,e=t[n]+"")&&(this.push(e),i=!0),++n<o;);i&&this._updateClassName()},l.remove=function(){var e,t,n=arguments,o=0,i=n.length,r=!1;do{for(t=c(this,e=n[o]+"");-1!==t;)this.splice(t,1),r=!0,t=c(this,e)}while(++o<i);r&&this._updateClassName()},l.toggle=function(e,t){var n=this.contains(e+=""),o=n?!0!==t&&"remove":!1!==t&&"add";return o&&this[o](e),!0===t||!1===t?t:!n},l.toString=function(){return this.join(" ")},i.defineProperty){l={get:e,enumerable:!0,configurable:!0};try{i.defineProperty(o,t,l)}catch(e){void 0!==e.number&&-2146823252!==e.number||(l.enumerable=!1,i.defineProperty(o,t,l))}}else i[n].__defineGetter__&&o.__defineGetter__(t,e)}}(window.self),(r=document.createElement("_")).classList.add("c1","c2"),r.classList.contains("c2")||((o=function(e){var o=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){for(var t=arguments.length,n=0;n<t;n++)o.call(this,arguments[n])}})("add"),o("remove")),r.classList.toggle("c3",!1),r.classList.contains("c3")&&(i=DOMTokenList.prototype.toggle,DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:i.call(this,e)}),r=null),"undefined"!=typeof window&&window.addEventListener&&(v=Object.create(null),g=function(){clearTimeout(a),a=setTimeout(s,100)},m=function(){},y="http://www.w3.org/1999/xlink",s=function(){var e,t,n,o,i,r,a,s,c,u,l,h=0;function f(){var e;0===--h&&(m(),window.addEventListener("resize",g,!1),window.addEventListener("orientationchange",g,!1),m=window.MutationObserver?((e=new MutationObserver(g)).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}),function(){try{e.disconnect(),window.removeEventListener("resize",g,!1),window.removeEventListener("orientationchange",g,!1)}catch(e){}}):(document.documentElement.addEventListener("DOMSubtreeModified",g,!1),function(){document.documentElement.removeEventListener("DOMSubtreeModified",g,!1),window.removeEventListener("resize",g,!1),window.removeEventListener("orientationchange",g,!1)}))}function d(e){return function(){!0!==v[e.base]&&(e.useEl.setAttributeNS(y,"xlink:href","#"+e.hash),e.useEl.hasAttribute("href")&&e.useEl.setAttribute("href","#"+e.hash))}}function p(e){return function(){e.onerror=null,e.ontimeout=null,f()}}for(m(),r=document.getElementsByTagName("use"),o=0;o<r.length;o+=1){try{t=r[o].getBoundingClientRect()}catch(e){t=!1}e=(u=(l=r[o].getAttribute("href")||r[o].getAttributeNS(y,"href")||r[o].getAttribute("xlink:href"))&&l.split?l.split("#"):["",""])[0],n=u[1],i=t&&0===t.left&&0===t.right&&0===t.top&&0===t.bottom,t&&0===t.width&&0===t.height&&!i?(r[o].hasAttribute("href")&&r[o].setAttributeNS(y,"xlink:href",l),e.length&&(!0!==(a=v[e])&&setTimeout(d({useEl:r[o],base:e,hash:n}),0),void 0===a&&(s=e,c=function(e){var t;return void 0!==e.protocol?t=e:(t=document.createElement("a")).href=e,t.protocol.replace(/:/g,"")+t.host},l=u=void 0,window.XMLHttpRequest&&(u=new XMLHttpRequest,l=c(location),s=c(s),u=void 0===u.withCredentials&&""!==s&&s!==l?XDomainRequest||void 0:XMLHttpRequest),void 0!==u&&(a=new u,(v[e]=a).onload=function(n){return function(){var e=document.body,t=document.createElement("x");n.onload=null,t.innerHTML=n.responseText,(t=t.getElementsByTagName("svg")[0])&&(t.setAttribute("aria-hidden","true"),t.style.position="absolute",t.style.width=0,t.style.height=0,t.style.overflow="hidden",e.insertBefore(t,e.firstChild)),f()}}(a),a.onerror=p(a),a.ontimeout=p(a),a.open("GET",e),a.send(),h+=1)))):i?e.length&&v[e]&&setTimeout(d({useEl:r[o],base:e,hash:n}),0):void 0===v[e]?v[e]=!0:v[e].onload&&(v[e].abort(),delete v[e].onload,v[e]=!0)}r="",h+=1,f()},c=function(){window.removeEventListener("load",c,!1),a=setTimeout(s,0)},"complete"!==document.readyState?window.addEventListener("load",c,!1):c())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=d(n(3)),a=d(n(74)),s=d(n(117)),c=d(n(2)),u=d(n(119)),l=n(27),h=n(1),f=n(0);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=r.default.isUndefined,g=r.default.forEach,n=r.default.CustomEvents,m=f.eventNames.MOUSE_DOWN,y=f.eventNames.OBJECT_MOVED,_=f.eventNames.OBJECT_SCALED,b=f.eventNames.OBJECT_ACTIVATED,O=f.eventNames.OBJECT_ROTATED,E=f.eventNames.OBJECT_ADDED,C=f.eventNames.OBJECT_MODIFIED,w=f.eventNames.ADD_TEXT,k=f.eventNames.ADD_OBJECT,M=f.eventNames.TEXT_EDITING,j=f.eventNames.TEXT_CHANGED,x=f.eventNames.ICON_CREATE_RESIZE,P=f.eventNames.ICON_CREATE_END,T=f.eventNames.SELECTION_CLEARED,S=f.eventNames.SELECTION_CREATED,A=f.eventNames.ADD_OBJECT_AFTER,o=(o(D,[{key:"_setSelectionStyle",value:function(t,e){var n=e.applyCropSelectionStyle,e=e.applyGroupSelectionStyle;t&&this._graphics.setSelectionStyle(t),n&&this._graphics.setCropSelectionStyle(t),e&&this.on("selectionCreated",function(e){"activeSelection"===e.type&&e.set(t)})}},{key:"_attachInvokerEvents",value:function(){var e=f.eventNames.UNDO_STACK_CHANGED,t=f.eventNames.REDO_STACK_CHANGED;this._invoker.on(e,this.fire.bind(this,e)),this._invoker.on(t,this.fire.bind(this,t))}},{key:"_attachGraphicsEvents",value:function(){var e;this._graphics.on((p(e={},m,this._handlers.mousedown),p(e,y,this._handlers.objectMoved),p(e,_,this._handlers.objectScaled),p(e,O,this._handlers.objectRotated),p(e,b,this._handlers.objectActivated),p(e,E,this._handlers.objectAdded),p(e,C,this._handlers.objectModified),p(e,w,this._handlers.addText),p(e,k,this._handlers.addObject),p(e,M,this._handlers.textEditing),p(e,j,this._handlers.textChanged),p(e,x,this._handlers.iconCreateResize),p(e,P,this._handlers.iconCreateEnd),p(e,T,this._handlers.selectionCleared),p(e,S,this._handlers.selectionCreated),e))}},{key:"_attachDomEvents",value:function(){document.addEventListener("keydown",this._handlers.keydown)}},{key:"_detachDomEvents",value:function(){document.removeEventListener("keydown",this._handlers.keydown)}},{key:"_onKeyDown",value:function(e){var t=e.ctrlKey,n=e.keyCode,o=e.metaKey;(t||o)&&(n===f.keyCodes.C?this._graphics.resetTargetObjectForCopyPaste():n===f.keyCodes.V?(this._graphics.pasteObject(),this.clearRedoStack()):n===f.keyCodes.Z?this.undo().catch(function(){}):n===f.keyCodes.Y&&this.redo().catch(function(){}));o=n===f.keyCodes.BACKSPACE||n===f.keyCodes.DEL,n=this._graphics.isReadyRemoveObject();!this.isColorPickerInputBoxEditing&&n&&o&&(e.preventDefault(),this.removeActiveObject())}},{key:"removeActiveObject",value:function(){var e=this._graphics.getActiveObjectIdForRemove();this.removeObject(e)}},{key:"_onMouseDown",value:function(e,t){this.fire(f.eventNames.MOUSE_DOWN,e,t)}},{key:"_pushAddObjectCommand",value:function(e){e=c.default.create(f.commandNames.ADD_OBJECT,this._graphics,e);this._invoker.pushUndoStack(e)}},{key:"_pushModifyObjectCommand",value:function(e){var t=this,n=e.type,o=(0,l.makeSelectionUndoData)(e,function(e){return(0,l.makeSelectionUndoDatum)(t._graphics.getObjectId(e),e,"activeSelection"===n)}),e=c.default.create(f.commandNames.CHANGE_SELECTION,this._graphics,o);e.execute(this._graphics,o),this._invoker.pushUndoStack(e)}},{key:"_onObjectActivated",value:function(e){this.fire(f.eventNames.OBJECT_ACTIVATED,e)}},{key:"_onObjectMoved",value:function(e){this.fire(f.eventNames.OBJECT_MOVED,e)}},{key:"_onObjectScaled",value:function(e){this.fire(f.eventNames.OBJECT_SCALED,e)}},{key:"_onObjectRotated",value:function(e){this.fire(f.eventNames.OBJECT_ROTATED,e)}},{key:"getDrawingMode",value:function(){return this._graphics.getDrawingMode()}},{key:"clearObjects",value:function(){return this.execute(f.commandNames.CLEAR_OBJECTS)}},{key:"deactivateAll",value:function(){this._graphics.deactivateAll(),this._graphics.renderAll()}},{key:"discardSelection",value:function(){this._graphics.discardSelection()}},{key:"changeSelectableAll",value:function(e){this._graphics.changeSelectableAll(e)}},{key:"clearHistory",value:function(){this._invoker.clearUndoStack(),this._invoker.clearRedoStack()}},{key:"execute",value:function(e){for(var t,n=arguments.length,o=Array(1<n?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];var r=[this._graphics].concat(o);return(t=this._invoker).execute.apply(t,[e].concat(r))}},{key:"executeSilent",value:function(e){for(var t,n=arguments.length,o=Array(1<n?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];var r=[this._graphics].concat(o);return(t=this._invoker).executeSilent.apply(t,[e].concat(r))}},{key:"undo",value:function(){for(var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=h.Promise.resolve(),o=0;o<t;o+=1)n=n.then(function(){return e._invoker.undo()});return n}},{key:"redo",value:function(){for(var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=h.Promise.resolve(),o=0;o<t;o+=1)n=n.then(function(){return e._invoker.redo()});return n}},{key:"zoom",value:function(e){var t=e.x,n=e.y,e=e.zoomLevel;this._graphics.zoom({x:t,y:n},e)}},{key:"resetZoom",value:function(){this._graphics.resetZoom()}},{key:"loadImageFromFile",value:function(t,e){if(!t)return h.Promise.reject(f.rejectMessages.invalidParameters);var n=URL.createObjectURL(t);return e=e||t.name,this.loadImageFromURL(n,e).then(function(e){return URL.revokeObjectURL(t),e})}},{key:"loadImageFromURL",value:function(e,t){return t&&e?this.execute(f.commandNames.LOAD_IMAGE,t,e):h.Promise.reject(f.rejectMessages.invalidParameters)}},{key:"addImageObject",value:function(e){return e?this.execute(f.commandNames.ADD_IMAGE_OBJECT,e):h.Promise.reject(f.rejectMessages.invalidParameters)}},{key:"startDrawingMode",value:function(e,t){return this._graphics.startDrawingMode(e,t)}},{key:"stopDrawingMode",value:function(){this._graphics.stopDrawingMode()}},{key:"crop",value:function(e){e=this._graphics.getCroppedImageData(e);return e?this.loadImageFromURL(e.url,e.imageName):h.Promise.reject(f.rejectMessages.invalidParameters)}},{key:"getCropzoneRect",value:function(){return this._graphics.getCropzoneRect()}},{key:"setCropzoneRect",value:function(e){this._graphics.setCropzoneRect(e)}},{key:"_flip",value:function(e){return this.execute(f.commandNames.FLIP_IMAGE,e)}},{key:"flipX",value:function(){return this._flip("flipX")}},{key:"flipY",value:function(){return this._flip("flipY")}},{key:"resetFlip",value:function(){return this._flip("reset")}},{key:"_rotate",value:function(e,t,n){return n?this.executeSilent(f.commandNames.ROTATE_IMAGE,e,t):this.execute(f.commandNames.ROTATE_IMAGE,e,t)}},{key:"rotate",value:function(e,t){return this._rotate("rotate",e,t)}},{key:"setAngle",value:function(e,t){return this._rotate("setAngle",e,t)}},{key:"setBrush",value:function(e){this._graphics.setBrush(e)}},{key:"setDrawingShape",value:function(e,t){this._graphics.setDrawingShape(e,t)}},{key:"setDrawingIcon",value:function(e,t){this._graphics.setIconStyle(e,t)}},{key:"addShape",value:function(e,t){return this._setPositions(t=t||{}),this.execute(f.commandNames.ADD_SHAPE,e,t)}},{key:"changeShape",value:function(e,t,n){return this[n?"executeSilent":"execute"](f.commandNames.CHANGE_SHAPE,e,t)}},{key:"addText",value:function(e,t){return this.execute(f.commandNames.ADD_TEXT,e=e||"",t=t||{})}},{key:"changeText",value:function(e,t){return this.execute(f.commandNames.CHANGE_TEXT,e,t=t||"")}},{key:"changeTextStyle",value:function(e,t,n){return this[n?"executeSilent":"execute"](f.commandNames.CHANGE_TEXT_STYLE,e,t)}},{key:"_changeActivateMode",value:function(e){"ICON"!==e&&this.getDrawingMode()!==e&&this.startDrawingMode(e)}},{key:"_onTextChanged",value:function(e){this.fire(f.eventNames.TEXT_CHANGED,e)}},{key:"_onIconCreateResize",value:function(e){this.fire(f.eventNames.ICON_CREATE_RESIZE,e)}},{key:"_onIconCreateEnd",value:function(e){this.fire(f.eventNames.ICON_CREATE_END,e)}},{key:"_onTextEditing",value:function(){this.fire(f.eventNames.TEXT_EDITING)}},{key:"_onAddText",value:function(e){this.fire(f.eventNames.ADD_TEXT,{originPosition:e.originPosition,clientPosition:e.clientPosition})}},{key:"_onAddObject",value:function(e){e=this._graphics.getObject(e.id);this._invoker.fire(f.eventNames.EXECUTE_COMMAND,(0,h.getObjectType)(e.type)),this._pushAddObjectCommand(e)}},{key:"_onObjectAdded",value:function(e){this.fire(E,e),this.fire(A,e)}},{key:"_onObjectModified",value:function(e){e.type!==f.OBJ_TYPE.CROPZONE&&(this._invoker.fire(f.eventNames.EXECUTE_COMMAND,(0,h.getObjectType)(e.type)),this._pushModifyObjectCommand(e))}},{key:"_selectionCleared",value:function(){this.fire(T)}},{key:"_selectionCreated",value:function(e){this.fire(S,e)}},{key:"registerIcons",value:function(e){this._graphics.registerPaths(e)}},{key:"changeCursor",value:function(e){this._graphics.changeCursor(e)}},{key:"addIcon",value:function(e,t){return this._setPositions(t=t||{}),this.execute(f.commandNames.ADD_ICON,e,t)}},{key:"changeIconColor",value:function(e,t){return this.execute(f.commandNames.CHANGE_ICON_COLOR,e,t)}},{key:"removeObject",value:function(e){var t=this._graphics.getObject(e).type;return this.execute(f.commandNames.REMOVE_OBJECT,e,(0,h.getObjectType)(t))}},{key:"hasFilter",value:function(e){return this._graphics.hasFilter(e)}},{key:"removeFilter",value:function(e){return this.execute(f.commandNames.REMOVE_FILTER,e)}},{key:"applyFilter",value:function(e,t,n){return this[n?"executeSilent":"execute"](f.commandNames.APPLY_FILTER,e,t)}},{key:"toDataURL",value:function(e){return this._graphics.toDataURL(e)}},{key:"getImageName",value:function(){return this._graphics.getImageName()}},{key:"clearUndoStack",value:function(){this._invoker.clearUndoStack()}},{key:"clearRedoStack",value:function(){this._invoker.clearRedoStack()}},{key:"isEmptyUndoStack",value:function(){return this._invoker.isEmptyUndoStack()}},{key:"isEmptyRedoStack",value:function(){return this._invoker.isEmptyRedoStack()}},{key:"resizeCanvasDimension",value:function(e){return e?this.execute(f.commandNames.RESIZE_CANVAS_DIMENSION,e):h.Promise.reject(f.rejectMessages.invalidParameters)}},{key:"destroy",value:function(){var n=this;this.stopDrawingMode(),this._detachDomEvents(),this._graphics.destroy(),this._graphics=null,g(this,function(e,t){n[t]=null},this)}},{key:"_setPositions",value:function(e){var t=this._graphics.getCenter();v(e.left)&&(e.left=t.left),v(e.top)&&(e.top=t.top)}},{key:"setObjectProperties",value:function(e,t){return this.execute(f.commandNames.SET_OBJECT_PROPERTIES,e,t)}},{key:"setObjectPropertiesQuietly",value:function(e,t){this._graphics.setObjectProperties(e,t)}},{key:"getObjectProperties",value:function(e,t){return this._graphics.getObject(e)?this._graphics.getObjectProperties(e,t):null}},{key:"getCanvasSize",value:function(){return this._graphics.getCanvasSize()}},{key:"getObjectPosition",value:function(e,t,n){return this._graphics.getObjectPosition(e,t,n)}},{key:"setObjectPosition",value:function(e,t){return this.execute(f.commandNames.SET_OBJECT_POSITION,e,t)}},{key:"resize",value:function(e){return this.execute(f.commandNames.RESIZE_IMAGE,e)}},{key:"toJSON",value:function(){return this._graphics.toJSON()}},{key:"loadFromJSON",value:function(e){this._graphics.loadFromJSON(e)}}]),D);function D(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,D),t=r.default.extend({includeUI:!1,usageStatistics:!0},t),this.mode=null,this.activeObjectId=null,this._invoker=new a.default,this._graphics=new u.default(e,{cssMaxWidth:t.cssMaxWidth,cssMaxHeight:t.cssMaxHeight}),this._handlers={keydown:this._onKeyDown.bind(this),mousedown:this._onMouseDown.bind(this),objectActivated:this._onObjectActivated.bind(this),objectMoved:this._onObjectMoved.bind(this),objectScaled:this._onObjectScaled.bind(this),objectRotated:this._onObjectRotated.bind(this),objectAdded:this._onObjectAdded.bind(this),objectModified:this._onObjectModified.bind(this),createdPath:this._onCreatedPath,addText:this._onAddText.bind(this),addObject:this._onAddObject.bind(this),textEditing:this._onTextEditing.bind(this),textChanged:this._onTextChanged.bind(this),iconCreateResize:this._onIconCreateResize.bind(this),iconCreateEnd:this._onIconCreateEnd.bind(this),selectionCleared:this._selectionCleared.bind(this),selectionCreated:this._selectionCreated.bind(this)},this._attachInvokerEvents(),this._attachGraphicsEvents(),this._attachDomEvents(),this._setSelectionStyle(t.selectionStyle,{applyCropSelectionStyle:t.applyCropSelectionStyle,applyGroupSelectionStyle:t.applyGroupSelectionStyle}),t.usageStatistics&&(0,h.sendHostName)(),fabric.enableGLFiltering=!1}s.default.mixin(o),n.mixin(o),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=u(n(3)),a=u(n(2)),s=n(1),c=n(0);function u(e){return e&&e.__esModule?e:{default:e}}var l=r.default.isFunction,h=r.default.isString,r=r.default.CustomEvents,o=(o(f,[{key:"_invokeExecution",value:function(t){var n=this,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.lock();var e=t.args;return t.execute.apply(t,e=e||[]).then(function(e){return n._isSilent||(n.pushUndoStack(t),n.fire(o?c.eventNames.AFTER_REDO:c.eventNames.EXECUTE_COMMAND,t)),n.unlock(),l(t.executeCallback)&&t.executeCallback(e),e}).catch(function(e){return n.unlock(),s.Promise.reject(e)})}},{key:"_invokeUndo",value:function(t){var n=this;this.lock();var e=t.args;return t.undo.apply(t,e=e||[]).then(function(e){return n.pushRedoStack(t),n.fire(c.eventNames.AFTER_UNDO,t),n.unlock(),l(t.undoCallback)&&t.undoCallback(e),e}).catch(function(e){return n.unlock(),s.Promise.reject(e)})}},{key:"_fireRedoStackChanged",value:function(){this.fire(c.eventNames.REDO_STACK_CHANGED,this._redoStack.length)}},{key:"_fireUndoStackChanged",value:function(){this.fire(c.eventNames.UNDO_STACK_CHANGED,this._undoStack.length)}},{key:"lock",value:function(){this._isLocked=!0}},{key:"unlock",value:function(){this._isLocked=!1}},{key:"executeSilent",value:function(){var e=this;this._isSilent=!0;for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return this.execute.apply(this,n.concat([this._isSilent])).then(function(){e._isSilent=!1})}},{key:"execute",value:function(){var t=this;if(this._isLocked)return s.Promise.reject(c.rejectMessages.isLock);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];var i=n[0];return h(i)&&(i=a.default.create.apply(a.default,n)),this._invokeExecution(i).then(function(e){return t.clearRedoStack(),e})}},{key:"undo",value:function(){var e=this._undoStack.pop(),t="";return e&&this._isLocked&&(this.pushUndoStack(e,!0),e=null),e?(this.isEmptyUndoStack()&&this._fireUndoStackChanged(),this._invokeUndo(e)):(t=c.rejectMessages.undo,this._isLocked&&(t=t+" Because "+c.rejectMessages.isLock),s.Promise.reject(t))}},{key:"redo",value:function(){var e=this._redoStack.pop(),t="";return e&&this._isLocked&&(this.pushRedoStack(e,!0),e=null),e?(this.isEmptyRedoStack()&&this._fireRedoStackChanged(),this._invokeExecution(e,!0)):(t=c.rejectMessages.redo,this._isLocked&&(t=t+" Because "+c.rejectMessages.isLock),s.Promise.reject(t))}},{key:"pushUndoStack",value:function(e,t){this._undoStack.push(e),t||this._fireUndoStackChanged()}},{key:"pushRedoStack",value:function(e,t){this._redoStack.push(e),t||this._fireRedoStackChanged()}},{key:"isEmptyRedoStack",value:function(){return 0===this._redoStack.length}},{key:"isEmptyUndoStack",value:function(){return 0===this._undoStack.length}},{key:"clearUndoStack",value:function(){this.isEmptyUndoStack()||(this._undoStack=[],this._fireUndoStackChanged())}},{key:"clearRedoStack",value:function(){this.isEmptyRedoStack()||(this._redoStack=[],this._fireRedoStackChanged())}}]),f);function f(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this._undoStack=[],this._redoStack=[],this._isLocked=!1,this._isSilent=!1}r.mixin(o),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=a(n(3)),n=a(n(45));function a(e){return e&&e.__esModule?e:{default:e}}var s=n.default.create,c=n.default.types,o=(o(u,[{key:"execute",value:function(){throw new Error(s(c.UN_IMPLEMENTATION,"execute"))}},{key:"undo",value:function(){throw new Error(s(c.UN_IMPLEMENTATION,"undo"))}},{key:"setUndoData",value:function(e,t,n){return t&&(e=t),t=n?t||e:(r.default.extend(this.undoData,e),null)}},{key:"setExecuteCallback",value:function(e){return this.executeCallback=e,this}},{key:"setUndoCallback",value:function(e){return this.undoCallback=e,this}},{key:"isRedo",get:function(){return 0<Object.keys(this.undoData).length}}]),u);function u(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.name=e.name,this.args=t,this.execute=e.execute,this.undo=e.undo,this.executeCallback=e.executeCallback||null,this.undoCallback=e.undoCallback||null,this.undoData={}}t.default=o},function(e,t,n){var o=n(77);n(113),n(114),n(115),n(116),e.exports=o},function(e,t,n){n(46),n(93),n(94),n(66),n(67),n(105),n(106),n(109);n=n(31);e.exports=n.Promise},function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var o={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!o.call({1:2},1);t.f=r?function(e){e=i(this,e);return!!e&&e.enumerable}:o},function(e,t,n){var o=n(8),i=n(28),r="".split;e.exports=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==i(e)?r.call(e,""):Object(e)}:Object},function(e,t,n){var o=n(5),i=n(9);e.exports=function(t,n){try{i(o,t,n)}catch(e){o[t]=n}return n}},function(e,t,n){n=n(8);e.exports=!n(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},function(e,t,n){var o=n(14);e.exports=function(e){if(!o(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,n){var o=n(15),a=n(23),s=n(11),c=n(85);e.exports=o?Object.defineProperties:function(e,t){s(e);for(var n,o=c(t),i=o.length,r=0;r<i;)a.f(e,n=o[r++],t[n]);return e}},function(e,t,n){var o=n(86),i=n(56);e.exports=Object.keys||function(e){return o(e,i)}},function(e,t,n){var a=n(10),s=n(22),c=n(87).indexOf,u=n(38);e.exports=function(e,t){var n,o=s(e),i=0,r=[];for(n in o)!a(u,n)&&a(o,n)&&r.push(n);for(;t.length>i;)a(o,n=t[i++])&&(~c(r,n)||r.push(n));return r}},function(e,t,n){var c=n(22),u=n(55),l=n(88),n=function(s){return function(e,t,n){var o,i=c(e),r=u(i.length),a=l(n,r);if(s&&t!=t){for(;a<r;)if((o=i[a++])!=o)return!0}else for(;a<r;a++)if((s||a in i)&&i[a]===t)return s||a||0;return!s&&-1}};e.exports={includes:n(!0),indexOf:n(!1)}},function(e,t,n){var o=n(37),i=Math.max,r=Math.min;e.exports=function(e,t){e=o(e);return e<0?i(e+t,0):r(e,t)}},function(e,t,n){var o=n(6),i=n(18),r=o("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[r]===e)}},function(e,t,n){n=n(58);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var o=n(40),i=n(18),r=n(6)("iterator");e.exports=function(e){if(null!=e)return e[r]||e["@@iterator"]||i[o(e)]}},function(e,t,n){var o=n(11);e.exports=function(e){var t=e.return;if(void 0!==t)return o(t.call(e)).value}},function(e,t){},function(e,t,n){"use strict";function p(e){var t;return!(!E(e)||"function"!=typeof(t=e.then))&&t}function i(h,f){var d;h.notified||(h.notified=!0,d=h.reactions,T(function(){for(var e=h.value,t=1==h.state,n=0;d.length>n;){var o,i,r,a=d[n++],s=t?a.ok:a.fail,c=a.resolve,u=a.reject,l=a.domain;try{s?(t||(2===h.rejection&&re(h),h.rejection=1),!0===s?o=e:(l&&l.enter(),o=s(e),l&&(l.exit(),r=!0)),o===a.promise?u(V("Promise-chain cycle")):(i=p(o))?i.call(o,c,u):c(o)):u(e)}catch(e){l&&!r&&l.exit(),u(e)}}h.reactions=[],h.notified=!1,f&&!h.rejection&&oe(h)}))}function r(e,t,n){var o,i;$?((o=J.createEvent("Event")).promise=t,o.reason=n,o.initEvent(e,!1,!0),d.dispatchEvent(o)):o={promise:t,reason:n},!ee&&(i=d["on"+e])?i(o):e===te&&A("Unhandled promise rejection",n)}function a(t,n,o){return function(e){t(n,e,o)}}function s(e,t,n){e.done||(e.done=!0,(e=n?n:e).value=t,e.state=2,i(e,!0))}var o,c,u,l,h=n(13),f=n(19),d=n(5),v=n(17),g=n(60),m=n(25),y=n(95),_=n(36),b=n(42),O=n(97),E=n(14),C=n(16),w=n(98),k=n(61),M=n(24),j=n(99),x=n(62),P=n(63).set,T=n(100),S=n(65),A=n(102),D=n(20),I=n(26),N=n(44),R=n(51),L=n(6),F=n(104),z=n(43),H=n(59),B=L("species"),U="Promise",X=N.get,Z=N.set,Y=N.getterFor(U),N=g&&g.prototype,G=g,W=N,V=d.TypeError,J=d.document,q=d.process,K=D.f,Q=K,$=!!(J&&J.createEvent&&d.dispatchEvent),ee="function"==typeof PromiseRejectionEvent,te="unhandledrejection",ne=!1,R=R(U,function(){var e=k(G)!==String(G);if(!e&&66===H)return!0;if(f&&!W.finally)return!0;if(51<=H&&/native code/.test(G))return!1;function t(e){e(function(){},function(){})}var n=new G(function(e){e(1)});return(n.constructor={})[B]=t,!(ne=n.then(function(){})instanceof t)||!e&&F&&!ee}),j=R||!j(function(e){G.all(e).catch(function(){})}),oe=function(i){P.call(d,function(){var e,t=i.facade,n=i.value,o=ie(i);if(o&&(e=I(function(){z?q.emit("unhandledRejection",n,t):r(te,t,n)}),i.rejection=z||ie(i)?2:1,e.error))throw e.value})},ie=function(e){return 1!==e.rejection&&!e.parent},re=function(t){P.call(d,function(){var e=t.facade;z?q.emit("rejectionHandled",e):r("rejectionhandled",e,t.value)})},ae=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw V("Promise can't be resolved itself");var o=p(e);o?T(function(){var t={done:!1};try{o.call(e,a(ae,t,n),a(s,t,n))}catch(e){s(t,e,n)}}):(n.value=e,n.state=1,i(n,!1))}catch(e){s({done:!1},e,n)}}};if(R&&(W=(G=function(e){w(this,G,U),C(e),o.call(this);var t=X(this);try{e(a(ae,t),a(s,t))}catch(e){s(t,e)}}).prototype,(o=function(e){Z(this,{type:U,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=y(W,{then:function(e,t){var n=Y(this),o=K(x(this,G));return o.ok="function"!=typeof e||e,o.fail="function"==typeof t&&t,o.domain=z?q.domain:void 0,n.parent=!0,n.reactions.push(o),0!=n.state&&i(n,!1),o.promise},catch:function(e){return this.then(void 0,e)}}),c=function(){var e=new o,t=X(e);this.promise=e,this.resolve=a(ae,t),this.reject=a(s,t)},D.f=K=function(e){return e===G||e===u?new c:Q(e)},!f&&"function"==typeof g&&N!==Object.prototype)){l=N.then,ne||(m(N,"then",function(e,t){var n=this;return new G(function(e,t){l.call(n,e,t)}).then(e,t)},{unsafe:!0}),m(N,"catch",W.catch,{unsafe:!0}));try{delete N.constructor}catch(e){}_&&_(N,W)}h({global:!0,wrap:!0,forced:R},{Promise:G}),b(G,U,!1,!0),O(U),u=v(U),h({target:U,stat:!0,forced:R},{reject:function(e){var t=K(this);return t.reject.call(void 0,e),t.promise}}),h({target:U,stat:!0,forced:f||R},{resolve:function(e){return S(f&&this===u?G:this,e)}}),h({target:U,stat:!0,forced:j},{all:function(e){var s=this,t=K(s),c=t.resolve,u=t.reject,n=I(function(){var o=C(s.resolve),i=[],r=0,a=1;M(e,function(e){var t=r++,n=!1;i.push(void 0),a++,o.call(s,e).then(function(e){n||(n=!0,i[t]=e,--a||c(i))},u)}),--a||c(i)});return n.error&&u(n.value),t.promise},race:function(e){var n=this,o=K(n),i=o.reject,t=I(function(){var t=C(n.resolve);M(e,function(e){t.call(n,e).then(o.resolve,i)})});return t.error&&i(t.value),o.promise}})},function(e,t,n){var i=n(25);e.exports=function(e,t,n){for(var o in t)n&&n.unsafe&&e[o]?e[o]=t[o]:i(e,o,t[o],n);return e}},function(e,t,n){"use strict";var o=n(41),i=n(40);e.exports=o?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,n){"use strict";var o=n(17),i=n(23),r=n(6),a=n(15),s=r("species");e.exports=function(e){var t=o(e),e=i.f;a&&t&&!t[s]&&e(t,s,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},function(e,t,n){var i=n(6)("iterator"),r=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){r=!0}};a[i]=function(){return this},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var o={};o[i]=function(){return{next:function(){return{done:n=!0}}}},e(o)}catch(e){}return n}},function(e,t,n){var o,i,r,a,s,c,u,l,h=n(5),f=n(47).f,d=n(63).set,p=n(64),v=n(101),g=n(43),m=h.MutationObserver||h.WebKitMutationObserver,y=h.document,_=h.process,n=h.Promise,f=f(h,"queueMicrotask"),f=f&&f.value;f||(o=function(){var e,t;for(g&&(e=_.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?a():r=void 0,e}}r=void 0,e&&e.enter()},a=p||g||v||!m||!y?n&&n.resolve?((u=n.resolve(void 0)).constructor=n,l=u.then,function(){l.call(u,o)}):g?function(){_.nextTick(o)}:function(){d.call(h,o)}:(s=!0,c=y.createTextNode(""),new m(o).observe(c,{characterData:!0}),function(){c.data=s=!s})),e.exports=f||function(e){e={fn:e,next:void 0};r&&(r.next=e),i||(i=e,a()),r=e}},function(e,t,n){n=n(39);e.exports=/web0s(?!.*chrome)/i.test(n)},function(e,t,n){var o=n(5);e.exports=function(e,t){var n=o.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},function(e,t,n){var o=n(5),n=n(61),o=o.WeakMap;e.exports="function"==typeof o&&/native code/.test(n(o))},function(e,t){e.exports="object"==typeof window},function(e,t,n){"use strict";var o=n(13),i=n(19),r=n(60),a=n(8),s=n(17),c=n(62),u=n(65),n=n(25);o({target:"Promise",proto:!0,real:!0,forced:!!r&&a(function(){r.prototype.finally.call({then:function(){}},function(){})})},{finally:function(t){var n=c(this,s("Promise")),e="function"==typeof t;return this.then(e?function(e){return u(n,t()).then(function(){return e})}:t,e?function(e){return u(n,t()).then(function(){throw e})}:t)}}),i||"function"!=typeof r||(i=s("Promise").prototype.finally,r.prototype.finally!==i&&n(r.prototype,"finally",i,{unsafe:!0}))},function(e,t,n){"use strict";var o=n(107).charAt,i=n(44),n=n(68),r="String Iterator",a=i.set,s=i.getterFor(r);n(String,"String",function(e){a(this,{type:r,string:String(e),index:0})},function(){var e=s(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(n=o(t,n),e.index+=n.length,{value:n,done:!1})})},function(e,t,n){var a=n(37),s=n(29),n=function(r){return function(e,t){var n,o=String(s(e)),i=a(t),e=o.length;return i<0||e<=i?r?"":void 0:(t=o.charCodeAt(i))<55296||56319<t||i+1===e||(n=o.charCodeAt(i+1))<56320||57343<n?r?o.charAt(i):t:r?o.slice(i,i+2):n-56320+(t-55296<<10)+65536}};e.exports={codeAt:n(!1),charAt:n(!0)}},function(e,t,n){"use strict";function o(){return this}var i=n(69).IteratorPrototype,r=n(54),a=n(21),s=n(42),c=n(18);e.exports=function(e,t,n){t+=" Iterator";return e.prototype=r(i,{next:a(1,n)}),s(e,t,!1,!0),c[t]=o,e}},function(e,t,n){n(110);var o,i=n(112),r=n(5),a=n(40),s=n(9),c=n(18),u=n(6)("toStringTag");for(o in i){var l=r[o],l=l&&l.prototype;l&&a(l)!==u&&s(l,u,o),c[o]=c.Array}},function(e,t,n){"use strict";var o=n(22),i=n(111),r=n(18),a=n(44),n=n(68),s="Array Iterator",c=a.set,u=a.getterFor(s);e.exports=n(Array,"Array",function(e,t){c(this,{type:s,target:o(e),index:0,kind:t})},function(){var e=u(this),t=e.target,n=e.kind,o=e.index++;return!t||o>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:o,done:!1}:"values"==n?{value:t[o],done:!1}:{value:[o,t[o]],done:!1}},"values"),r.Arguments=r.Array,i("keys"),i("values"),i("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,n){n(46)},function(e,t,n){n(66)},function(e,t,n){"use strict";var o=n(13),i=n(20),r=n(26);o({target:"Promise",stat:!0},{try:function(e){var t=i.f(this),e=r(e);return(e.error?t.reject:t.resolve)(e.value),t.promise}})},function(e,t,n){n(67)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=n(3),i=n(118),a=(o=i)&&o.__esModule?o:{default:o},s=n(1),c=n(0);t.default={getActions:function(){return{main:this._mainAction(),shape:this._shapeAction(),crop:this._cropAction(),resize:this._resizeAction(),flip:this._flipAction(),rotate:this._rotateAction(),text:this._textAction(),mask:this._maskAction(),draw:this._drawAction(),icon:this._iconAction(),filter:this._filterAction(),history:this._historyAction()}},_mainAction:function(){function n(){"crop"===i.ui.submenu&&(i.stopDrawingMode(),i.ui.changeMenu("crop"))}function e(e){var t;return t=e,"rotate"===i.ui.submenu&&i.ui.rotate.setRangeBarAngle("setAngle",t),t=e,"filter"===i.ui.submenu&&i.ui.filter.setFilterState(t),e}function t(){i.ui.filter&&i.ui.filter.initFilterCheckBoxState()}var i=this;return(0,r.extend)({initLoadImage:function(t,e){return i.loadImageFromURL(t,e).then(function(e){n(),i.ui.initializeImgUrl=t,i.ui.resizeEditor({imageSize:e}),i.clearUndoStack(),i._invoker.fire(c.eventNames.EXECUTE_COMMAND,c.historyNames.LOAD_IMAGE)})},undo:function(){i.isEmptyUndoStack()||(n(),i.deactivateAll(),i.undo().then(e))},redo:function(){i.isEmptyRedoStack()||(n(),i.deactivateAll(),i.redo().then(e))},reset:function(){n(),i.loadImageFromURL(i.ui.initializeImgUrl,"resetImage").then(function(e){n(),t(),i.ui.resizeEditor({imageSize:e}),i.clearUndoStack(),i._initHistory()})},delete:function(){i.ui.changeHelpButtonEnabled("delete",!1),n(),i.removeActiveObject(),i.activeObjectId=null},deleteAll:function(){n(),i.clearObjects(),i.ui.changeHelpButtonEnabled("delete",!1),i.ui.changeHelpButtonEnabled("deleteAll",!1)},load:function(e){(0,s.isSupportFileApi)()||alert("This browser does not support file-api"),i.ui.initializeImgUrl=URL.createObjectURL(e),i.loadImageFromFile(e).then(function(e){n(),t(),i.clearUndoStack(),i.ui.activeMenuEvent(),i.ui.resizeEditor({imageSize:e}),i._clearHistory(),i._invoker.fire(c.eventNames.EXECUTE_COMMAND,c.historyNames.LOAD_IMAGE)}).catch(function(e){return Promise.reject(e)})},download:function(){var e,t=i.toDataURL(),n=i.getImageName(),o=void 0;(0,s.isSupportFileApi)()&&window.saveAs?(e=(o=(0,s.base64ToBlob)(t)).type.split("/")[1],n.split(".").pop()!==e&&(n+="."+e),saveAs(o,n)):window.open().document.body.innerHTML="<img src='"+t+"'>"},history:function(e){i.ui.toggleHistoryMenu(e)},zoomIn:function(){var e;i.ui.toggleZoomButtonStatus("zoomIn"),i.deactivateAll(),e=i._graphics.getZoomMode(),i.stopDrawingMode(),e!==c.zoomModes.ZOOM?(i.startDrawingMode(c.drawingModes.ZOOM),i._graphics.startZoomInMode()):i._graphics.endZoomInMode()},zoomOut:function(){i._graphics.zoomOut()},hand:function(){var e;i.ui.offZoomInButtonStatus(),i.ui.toggleZoomButtonStatus("hand"),i.deactivateAll(),e=i._graphics.getZoomMode(),i.stopDrawingMode(),e!==c.zoomModes.HAND?(i.startDrawingMode(c.drawingModes.ZOOM),i._graphics.startHandMode()):i._graphics.endHandMode()}},this._commonAction())},_iconAction:function(){var o=this;return(0,r.extend)({changeColor:function(e){o.activeObjectId&&o.changeIconColor(o.activeObjectId,e)},addIcon:function(e,t){o.startDrawingMode("ICON"),o.setDrawingIcon(e,t)},cancelAddIcon:function(){o.ui.icon.clearIconType(),o.changeSelectableAll(!0),o.changeCursor("default"),o.stopDrawingMode()},registerDefaultIcons:function(e,t){var n={};n[e]=t,o.registerIcons(n)},registerCustomIcon:function(e,n){(new a.default).imageToSVG(e,function(e){var t=e.match(/path[^>]*d="([^"]*)"/)[1],e={};e[n.name]=t,o.registerIcons(e),o.addIcon(n.name,{left:100,top:100})},a.default.tracerDefaultOption())}},this._commonAction())},_drawAction:function(){var n=this;return(0,r.extend)({setDrawMode:function(e,t){n.stopDrawingMode(),"free"===e?n.startDrawingMode("FREE_DRAWING",t):n.startDrawingMode("LINE_DRAWING",t)},setColor:function(e){n.setBrush({color:e})}},this._commonAction())},_maskAction:function(){var n=this;return(0,r.extend)({loadImageFromURL:function(e,t){return n.loadImageFromURL(n.toDataURL(),"FilterImage").then(function(){n.addImageObject(e).then(function(){URL.revokeObjectURL(t)}),n._invoker.fire(c.eventNames.EXECUTE_COMMAND,c.historyNames.LOAD_MASK_IMAGE)})},applyFilter:function(){n.applyFilter("mask",{maskObjId:n.activeObjectId})}},this._commonAction())},_textAction:function(){var n=this;return(0,r.extend)({changeTextStyle:function(e,t){n.activeObjectId&&n.changeTextStyle(n.activeObjectId,e,t)}},this._commonAction())},_rotateAction:function(){var n=this;return(0,r.extend)({rotate:function(e,t){n.rotate(e,t),n.ui.resizeEditor(),n.ui.rotate.setRangeBarAngle("rotate",e)},setAngle:function(e,t){n.setAngle(e,t),n.ui.resizeEditor(),n.ui.rotate.setRangeBarAngle("setAngle",e)}},this._commonAction())},_shapeAction:function(){var n=this;return(0,r.extend)({changeShape:function(e,t){n.activeObjectId&&n.changeShape(n.activeObjectId,e,t)},setDrawingShape:function(e){n.setDrawingShape(e)}},this._commonAction())},_cropAction:function(){var t=this;return(0,r.extend)({crop:function(){var e=t.getCropzoneRect();e&&!(0,s.isEmptyCropzone)(e)&&t.crop(e).then(function(){t.stopDrawingMode(),t.ui.resizeEditor(),t.ui.changeMenu("crop"),t._invoker.fire(c.eventNames.EXECUTE_COMMAND,c.historyNames.CROP)}).catch(function(e){return Promise.reject(e)})},cancel:function(){t.stopDrawingMode(),t.ui.changeMenu("crop")},preset:function(e){switch(e){case"preset-square":t.setCropzoneRect(1);break;case"preset-3-2":t.setCropzoneRect(1.5);break;case"preset-4-3":t.setCropzoneRect(4/3);break;case"preset-5-4":t.setCropzoneRect(5/4);break;case"preset-7-5":t.setCropzoneRect(1.4);break;case"preset-16-9":t.setCropzoneRect(16/9);break;default:t.setCropzoneRect(),t.ui.crop.changeApplyButtonStatus(!1)}}},this._commonAction())},_resizeAction:function(){var s=this;return(0,r.extend)({getCurrentDimensions:function(){return s._graphics.getCurrentDimensions()},preview:function(e,t,n){function o(){return i.width/i.height}var i=s._graphics.getCurrentDimensions(),r={};switch(e){case"width":r.width=t,r.height=n?t/o():i.height;break;case"height":r.height=t,r.width=n?t*o():i.width;break;default:r=i}s._graphics.resize(r).then(function(){s.ui.resizeEditor()}),n&&(s.ui.resize.setWidthValue(r.width),s.ui.resize.setHeightValue(r.height))},lockAspectRatio:function(e,t,n){var o,i=s._graphics.getCurrentDimensions(),r=i.width,a=i.height,i=r/a;e?a<r?s.ui.resize.setLimit({minWidth:t<(o=t*i)?o:t,minHeight:t,maxWidth:n,maxHeight:(o=n/i)<n?o:n}):s.ui.resize.setLimit({minWidth:t,minHeight:t<(o=t/i)?o:t,maxWidth:(i=n*i)<n?i:n,maxHeight:n}):s.ui.resize.setLimit({minWidth:t,minHeight:t,maxWidth:n,maxHeight:n})},resize:function(){var e=(e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null)||s._graphics.getCurrentDimensions();s.resize(e).then(function(){s._graphics.setOriginalDimensions(e),s.stopDrawingMode(),s.ui.resizeEditor(),s.ui.changeMenu("resize")}).catch(function(e){return Promise.reject(e)})},reset:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=s._graphics.getOriginalDimensions();s.ui.resize.setWidthValue(t.width,!0),s.ui.resize.setHeightValue(t.height,!0),s._graphics.resize(t).then(function(){e||(s.stopDrawingMode(),s.ui.resizeEditor(),s.ui.changeMenu("resize"))})}},this._commonAction())},_flipAction:function(){var t=this;return(0,r.extend)({flip:function(e){return t[e]()}},this._commonAction())},_filterAction:function(){var i=this;return(0,r.extend)({applyFilter:function(e,t,n,o){e?i.applyFilter(t,n,o):i.hasFilter(t)&&i.removeFilter(t)}},this._commonAction())},setReAction:function(){var a=this;this.on({undoStackChanged:function(e){e?(a.ui.changeHelpButtonEnabled("undo",!0),a.ui.changeHelpButtonEnabled("reset",!0)):(a.ui.changeHelpButtonEnabled("undo",!1),a.ui.changeHelpButtonEnabled("reset",!1)),a.ui.resizeEditor()},redoStackChanged:function(e){e?a.ui.changeHelpButtonEnabled("redo",!0):a.ui.changeHelpButtonEnabled("redo",!1),a.ui.resizeEditor()},objectActivated:function(e){a.activeObjectId=e.id,a.ui.changeHelpButtonEnabled("delete",!0),a.ui.changeHelpButtonEnabled("deleteAll",!0),"cropzone"===e.type?a.ui.crop.changeApplyButtonStatus(!0):-1<["rect","circle","triangle"].indexOf(e.type)?(a.stopDrawingMode(),"shape"!==a.ui.submenu&&a.ui.changeMenu("shape",!1,!1),a.ui.shape.setShapeStatus({strokeColor:e.stroke,strokeWidth:e.strokeWidth,fillColor:e.fill}),a.ui.shape.setMaxStrokeValue(Math.min(e.width,e.height))):"path"===e.type||"line"===e.type?"draw"!==a.ui.submenu&&(a.ui.changeMenu("draw",!1,!1),a.ui.draw.changeStandbyMode()):-1<["i-text","text"].indexOf(e.type)?("text"!==a.ui.submenu&&a.ui.changeMenu("text",!1,!1),a.ui.text.setTextStyleStateOnAction(e)):"icon"===e.type&&(a.stopDrawingMode(),"icon"!==a.ui.submenu&&a.ui.changeMenu("icon",!1,!1),a.ui.icon.setIconPickerColor(e.fill))},addText:function(e){var t=a.ui.text,n=t.textColor,o=t.fontSize,i=t.fontStyle,r=t.fontWeight,t=t.underline;a.addText("Double Click",{position:e.originPosition,styles:{fill:n,fontSize:o,fontFamily:"Noto Sans",fontStyle:i,fontWeight:r,underline:t}}).then(function(){a.changeCursor("default")})},addObjectAfter:function(e){"icon"===e.type?a.ui.icon.changeStandbyMode():-1<["rect","circle","triangle"].indexOf(e.type)&&(a.ui.shape.setMaxStrokeValue(Math.min(e.width,e.height)),a.ui.shape.changeStandbyMode())},objectScaled:function(e){var t,n;-1<["i-text","text"].indexOf(e.type)?a.ui.text.fontSize=(0,s.toInteger)(e.fontSize):0<=["rect","circle","triangle"].indexOf(e.type)&&(t=e.width,n=e.height,t<(e=a.ui.shape.getStrokeValue())&&a.ui.shape.setStrokeValue(t),n<e&&a.ui.shape.setStrokeValue(n))},selectionCleared:function(){a.activeObjectId=null,"text"===a.ui.submenu?a.changeCursor("text"):(0,s.includes)(["draw","crop","resize"],a.ui.submenu)||a.stopDrawingMode()}})},_historyAction:function(){var t=this;return{undo:function(e){return t.undo(e)},redo:function(e){return t.redo(e)}}},_commonAction:function(){var t=this,n=c.drawingModes.TEXT,o=c.drawingModes.CROPPER,i=c.drawingModes.SHAPE,r=c.drawingModes.ZOOM,a=c.drawingModes.RESIZE;return{modeChange:function(e){switch(e){case c.drawingMenuNames.TEXT:t._changeActivateMode(n);break;case c.drawingMenuNames.CROP:t.startDrawingMode(o);break;case c.drawingMenuNames.SHAPE:t._changeActivateMode(i),t.setDrawingShape(t.ui.shape.type,t.ui.shape.options);break;case c.drawingMenuNames.ZOOM:t.startDrawingMode(r);break;case c.drawingMenuNames.RESIZE:t.startDrawingMode(a)}},deactivateAll:this.deactivateAll.bind(this),changeSelectableAll:this.changeSelectableAll.bind(this),discardSelection:this.discardSelection.bind(this),stopDrawingMode:this.stopDrawingMode.bind(this)}},mixin:function(e){(0,r.extend)(e.prototype,this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}o(r,null,[{key:"tracerDefaultOption",value:function(){return{pathomit:100,ltres:.1,qtres:1,scale:1,strokewidth:5,viewbox:!1,linefilter:!0,desc:!1,rightangleenhance:!1,pal:[{r:0,g:0,b:0,a:255},{r:255,g:255,b:255,a:255}]}}}]),o(r,[{key:"imageToSVG",value:function(e,t,n){var o=this;n=this.checkoptions(n),this.loadImage(e,function(e){t(o.imagedataToSVG(o.getImgdata(e),n))},n)}},{key:"imagedataToSVG",value:function(e,t){t=this.checkoptions(t);e=this.imagedataToTracedata(e,t);return this.getsvgstring(e,t)}},{key:"imageToTracedata",value:function(e,t,n){var o=this;n=this.checkoptions(n),this.loadImage(e,function(e){t(o.imagedataToTracedata(o.getImgdata(e),n))},n)}},{key:"imagedataToTracedata",value:function(e,t){t=this.checkoptions(t);var n=this.colorquantization(e,t),o=void 0;if(0===t.layering)for(var o={layers:[],palette:n.palette,width:n.array[0].length-2,height:n.array.length-2},i=0;i<n.palette.length;i+=1){var r=this.batchtracepaths(this.internodes(this.pathscan(this.layeringstep(n,i),t.pathomit),t),t.ltres,t.qtres);o.layers.push(r)}else{var a=this.layering(n);t.layercontainerid&&this.drawLayers(a,this.specpalette,t.scale,t.layercontainerid);a=this.batchpathscan(a,t.pathomit),a=this.batchinternodes(a,t);o={layers:this.batchtracelayers(a,t.ltres,t.qtres),palette:n.palette,width:e.width,height:e.height}}return o}},{key:"checkoptions",value:function(e){"string"==typeof(e=e||{})&&(e=e.toLowerCase(),e=this.optionpresets[e]||{});for(var t=Object.keys(this.optionpresets.default),n=0;n<t.length;n+=1)e.hasOwnProperty(t[n])||(e[t[n]]=this.optionpresets.default[t[n]]);return e}},{key:"colorquantization",value:function(e,t){for(var n,o,i=[],r=void 0,a=void 0,s=[],c=e.width*e.height,u=void 0,l=void 0,h=void 0,f=void 0,d=void 0,l=0;l<e.height+2;l+=1)for(i[l]=[],u=0;u<e.width+2;u+=1)i[l][u]=-1;for(d=t.pal||(0===t.colorsampling?this.generatepalette(t.numberofcolors):1===t.colorsampling?this.samplepalette(t.numberofcolors,e):this.samplepalette2(t.numberofcolors,e)),0<t.blurradius&&(e=this.blur(e,t.blurradius,t.blurdelta)),f=0;f<t.colorquantcycles;f+=1){if(0<f)for(h=0;h<d.length;h+=1)0<s[h].n&&(d[h]={r:Math.floor(s[h].r/s[h].n),g:Math.floor(s[h].g/s[h].n),b:Math.floor(s[h].b/s[h].n),a:Math.floor(s[h].a/s[h].n)}),s[h].n/c<t.mincolorratio&&f<t.colorquantcycles-1&&(d[h]={r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())});for(u=0;u<d.length;u+=1)s[u]={r:0,g:0,b:0,a:0,n:0};for(l=0;l<e.height;l+=1)for(u=0;u<e.width;u+=1){for(n=4*(l*e.width+u),r=1024,h=a=0;h<d.length;h+=1)(o=Math.abs(d[h].r-e.data[n])+Math.abs(d[h].g-e.data[1+n])+Math.abs(d[h].b-e.data[2+n])+Math.abs(d[h].a-e.data[3+n]))<r&&(r=o,a=h);s[a].r+=e.data[n],s[a].g+=e.data[1+n],s[a].b+=e.data[2+n],s[a].a+=e.data[3+n],s[a].n+=1,i[l+1][u+1]=a}}return{array:i,palette:d}}},{key:"samplepalette",value:function(e,t){for(var n,o=[],i=0;i<e;i+=1)n=4*Math.floor(Math.random()*t.data.length/4),o.push({r:t.data[n],g:t.data[1+n],b:t.data[2+n],a:t.data[3+n]});return o}},{key:"samplepalette2",value:function(e,t){for(var n,o=[],i=Math.ceil(Math.sqrt(e)),r=Math.ceil(e/i),a=t.width/(i+1),s=t.height/(r+1),c=0;c<r;c+=1)for(var u=0;u<i&&o.length!==e;u+=1)n=4*Math.floor((c+1)*s*t.width+(u+1)*a),o.push({r:t.data[n],g:t.data[1+n],b:t.data[2+n],a:t.data[3+n]});return o}},{key:"generatepalette",value:function(e){var t=[],n=void 0,o=void 0,i=void 0;if(e<8)for(var r=Math.floor(255/(e-1)),a=0;a<e;a+=1)t.push({r:a*r,g:a*r,b:a*r,a:255});else{for(var s=Math.floor(Math.pow(e,1/3)),c=Math.floor(255/(s-1)),u=e-s*s*s,n=0;n<s;n+=1)for(o=0;o<s;o+=1)for(i=0;i<s;i+=1)t.push({r:n*c,g:o*c,b:i*c,a:255});for(n=0;n<u;n+=1)t.push({r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())})}return t}},{key:"layering",value:function(e){for(var t,n,o,i,r,a,s,c,u,l=[],h=e.array.length,f=e.array[0].length,d=void 0,p=void 0,v=void 0,v=0;v<e.palette.length;v+=1)for(l[v]=[],p=0;p<h;p+=1)for(l[v][p]=[],d=0;d<f;d+=1)l[v][p][d]=0;for(p=1;p<h-1;p+=1)for(d=1;d<f-1;d+=1)t=e.array[p][d],n=e.array[p-1][d-1]===t?1:0,o=e.array[p-1][d]===t?1:0,i=e.array[p-1][d+1]===t?1:0,r=e.array[p][d-1]===t?1:0,a=e.array[p][d+1]===t?1:0,s=e.array[p+1][d-1]===t?1:0,c=e.array[p+1][d]===t?1:0,u=e.array[p+1][d+1]===t?1:0,l[t][p+1][d+1]=1+2*a+4*u+8*c,r||(l[t][p+1][d]=2+4*c+8*s),o||(l[t][p][d+1]=0+2*i+4*a+8),n||(l[t][p][d]=0+2*o+4+8*r);return l}},{key:"layeringstep",value:function(e,t){for(var n=[],o=e.array.length,i=e.array[0].length,r=void 0,a=void 0,a=0;a<o;a+=1)for(n[a]=[],r=0;r<i;r+=1)n[a][r]=0;for(a=1;a<o;a+=1)for(r=1;r<i;r+=1)n[a][r]=(e.array[a-1][r-1]===t?1:0)+(e.array[a-1][r]===t?2:0)+(e.array[a][r-1]===t?8:0)+(e.array[a][r]===t?4:0);return n}},{key:"pathscan",value:function(e,t){for(var n,o,i=[],r=0,a=0,s=0,c=0,u=e[0].length,l=e.length,h=0,f=!0,d=0;d<l;d+=1)for(var p=0;p<u;p+=1)if(4===e[d][p]||11===e[d][p])for(s=p,c=d,i[r]={},i[r].points=[],i[r].boundingbox=[s,c,s,c],f=!(i[r].holechildren=[]),a=0,n=11===e[d][p],h=1;!f;){if(i[r].points[a]={},i[r].points[a].x=s-1,i[r].points[a].y=c-1,i[r].points[a].t=e[c][s],s-1<i[r].boundingbox[0]&&(i[r].boundingbox[0]=s-1),s-1>i[r].boundingbox[2]&&(i[r].boundingbox[2]=s-1),c-1<i[r].boundingbox[1]&&(i[r].boundingbox[1]=c-1),c-1>i[r].boundingbox[3]&&(i[r].boundingbox[3]=c-1),o=this.pathscan_combined_lookup[e[c][s]][h],e[c][s]=o[0],h=o[1],s+=o[2],c+=o[3],s-1===i[r].points[0].x&&c-1===i[r].points[0].y)if(f=!0,i[r].points.length<t)i.pop();else{if(i[r].isholepath=!!n,n){for(var v=0,g=[-1,-1,u+1,l+1],m=0;m<r;m++)!i[m].isholepath&&this.boundingboxincludes(i[m].boundingbox,i[r].boundingbox)&&this.boundingboxincludes(g,i[m].boundingbox)&&(g=i[v=m].boundingbox);i[v].holechildren.push(r)}r+=1}a+=1}return i}},{key:"boundingboxincludes",value:function(e,t){return e[0]<t[0]&&e[1]<t[1]&&e[2]>t[2]&&e[3]>t[3]}},{key:"batchpathscan",value:function(e,t){var n,o=[];for(n in e)e.hasOwnProperty(n)&&(o[n]=this.pathscan(e[n],t));return o}},{key:"internodes",value:function(e,t){for(var n,o,i,r=[],a=void 0,s=void 0,a=0;a<e.length;a+=1)for(r[a]={},r[a].points=[],r[a].boundingbox=e[a].boundingbox,r[a].holechildren=e[a].holechildren,r[a].isholepath=e[a].isholepath,n=e[a].points.length,s=0;s<n;s+=1)o=(s+1)%n,i=(s+2)%n,t.rightangleenhance&&this.testrightangle(e[a],(s-2+n)%n,(s-1+n)%n,s,o,i)&&(0<r[a].points.length&&(r[a].points[r[a].points.length-1].linesegment=this.getdirection(r[a].points[r[a].points.length-1].x,r[a].points[r[a].points.length-1].y,e[a].points[s].x,e[a].points[s].y)),r[a].points.push({x:e[a].points[s].x,y:e[a].points[s].y,linesegment:this.getdirection(e[a].points[s].x,e[a].points[s].y,(e[a].points[s].x+e[a].points[o].x)/2,(e[a].points[s].y+e[a].points[o].y)/2)})),r[a].points.push({x:(e[a].points[s].x+e[a].points[o].x)/2,y:(e[a].points[s].y+e[a].points[o].y)/2,linesegment:this.getdirection((e[a].points[s].x+e[a].points[o].x)/2,(e[a].points[s].y+e[a].points[o].y)/2,(e[a].points[o].x+e[a].points[i].x)/2,(e[a].points[o].y+e[a].points[i].y)/2)});return r}},{key:"testrightangle",value:function(e,t,n,o,i,r){return e.points[o].x===e.points[t].x&&e.points[o].x===e.points[n].x&&e.points[o].y===e.points[i].y&&e.points[o].y===e.points[r].y||e.points[o].y===e.points[t].y&&e.points[o].y===e.points[n].y&&e.points[o].x===e.points[i].x&&e.points[o].x===e.points[r].x}},{key:"getdirection",value:function(e,t,n,o){return e<n?t<o?1:o<t?7:0:n<e?t<o?3:o<t?5:4:t<o?2:o<t?6:8}},{key:"batchinternodes",value:function(e,t){var n,o=[];for(n in e)e.hasOwnProperty(n)&&(o[n]=this.internodes(e[n],t));return o}},{key:"tracepath",value:function(e,t,n){var o,i=0,r=void 0,a=void 0,s={segments:[]};for(s.boundingbox=e.boundingbox,s.holechildren=e.holechildren,s.isholepath=e.isholepath;i<e.points.length;){for(o=e.points[i].linesegment,r=-1,a=i+1;(e.points[a].linesegment===o||e.points[a].linesegment===r||-1===r)&&a<e.points.length-1;)e.points[a].linesegment!==o&&-1===r&&(r=e.points[a].linesegment),a+=1;a===e.points.length-1&&(a=0),s.segments=s.segments.concat(this.fitseq(e,t,n,i,a)),i=0<a?a:e.points.length}return s}},{key:"fitseq",value:function(e,t,n,o,i){if(i>e.points.length||i<0)return[];var r=o,a=0,s=!0,c=void 0,u=void 0,l=void 0,h=i-o;h<0&&(h+=e.points.length);for(var f=(e.points[i].x-e.points[o].x)/h,d=(e.points[i].y-e.points[o].y)/h,p=(o+1)%e.points.length,v=void 0;p!=i;)(v=p-o)<0&&(v+=e.points.length),c=e.points[o].x+f*v,u=e.points[o].y+d*v,t<(l=(e.points[p].x-c)*(e.points[p].x-c)+(e.points[p].y-u)*(e.points[p].y-u))&&(s=!1),a<l&&(r=p,a=l),p=(p+1)%e.points.length;if(s)return[{type:"L",x1:e.points[o].x,y1:e.points[o].y,x2:e.points[i].x,y2:e.points[i].y}];for(var g=r,s=!0,a=0,m=(g-o)/h,y=(1-m)*(1-m),_=2*(1-m)*m,b=m*m,O=(y*e.points[o].x+b*e.points[i].x-e.points[g].x)/-_,E=(y*e.points[o].y+b*e.points[i].y-e.points[g].y)/-_,p=o+1;p!=i;)c=(y=(1-(m=(p-o)/h))*(1-m))*e.points[o].x+(_=2*(1-m)*m)*O+(b=m*m)*e.points[i].x,u=y*e.points[o].y+_*E+b*e.points[i].y,n<(l=(e.points[p].x-c)*(e.points[p].x-c)+(e.points[p].y-u)*(e.points[p].y-u))&&(s=!1),a<l&&(r=p,a=l),p=(p+1)%e.points.length;if(s)return[{type:"Q",x1:e.points[o].x,y1:e.points[o].y,x2:O,y2:E,x3:e.points[i].x,y3:e.points[i].y}];return this.fitseq(e,t,n,o,g).concat(this.fitseq(e,t,n,g,i))}},{key:"batchtracepaths",value:function(e,t,n){var o,i=[];for(o in e)e.hasOwnProperty(o)&&i.push(this.tracepath(e[o],t,n));return i}},{key:"batchtracelayers",value:function(e,t,n){var o,i=[];for(o in e)e.hasOwnProperty(o)&&(i[o]=this.batchtracepaths(e[o],t,n));return i}},{key:"roundtodec",value:function(e,t){return Number(e.toFixed(t))}},{key:"svgpathstring",value:function(e,t,n,o){var i=e.layers[t],r=i[n],a="",s=void 0;if(o.linefilter&&r.segments.length<3)return a;if(a="<path "+(o.desc?'desc="l '+t+" p "+n+'" ':"")+this.tosvgcolorstr(e.palette[t],o)+'d="',-1===o.roundcoords){for(a+="M "+r.segments[0].x1*o.scale+" "+r.segments[0].y1*o.scale+" ",s=0;s<r.segments.length;s++)a+=r.segments[s].type+" "+r.segments[s].x2*o.scale+" "+r.segments[s].y2*o.scale+" ",r.segments[s].hasOwnProperty("x3")&&(a+=r.segments[s].x3*o.scale+" "+r.segments[s].y3*o.scale+" ");a+="Z "}else{for(a+="M "+this.roundtodec(r.segments[0].x1*o.scale,o.roundcoords)+" "+this.roundtodec(r.segments[0].y1*o.scale,o.roundcoords)+" ",s=0;s<r.segments.length;s++)a+=r.segments[s].type+" "+this.roundtodec(r.segments[s].x2*o.scale,o.roundcoords)+" "+this.roundtodec(r.segments[s].y2*o.scale,o.roundcoords)+" ",r.segments[s].hasOwnProperty("x3")&&(a+=this.roundtodec(r.segments[s].x3*o.scale,o.roundcoords)+" "+this.roundtodec(r.segments[s].y3*o.scale,o.roundcoords)+" ");a+="Z "}for(var c=0;c<r.holechildren.length;c++){var u=i[r.holechildren[c]];if(-1===o.roundcoords)for(u.segments[u.segments.length-1].hasOwnProperty("x3")?a+="M "+u.segments[u.segments.length-1].x3*o.scale+" "+u.segments[u.segments.length-1].y3*o.scale+" ":a+="M "+u.segments[u.segments.length-1].x2*o.scale+" "+u.segments[u.segments.length-1].y2*o.scale+" ",s=u.segments.length-1;0<=s;s--)a+=u.segments[s].type+" ",u.segments[s].hasOwnProperty("x3")&&(a+=u.segments[s].x2*o.scale+" "+u.segments[s].y2*o.scale+" "),a+=u.segments[s].x1*o.scale+" "+u.segments[s].y1*o.scale+" ";else for(u.segments[u.segments.length-1].hasOwnProperty("x3")?a+="M "+this.roundtodec(u.segments[u.segments.length-1].x3*o.scale)+" "+this.roundtodec(u.segments[u.segments.length-1].y3*o.scale)+" ":a+="M "+this.roundtodec(u.segments[u.segments.length-1].x2*o.scale)+" "+this.roundtodec(u.segments[u.segments.length-1].y2*o.scale)+" ",s=u.segments.length-1;0<=s;s--)a+=u.segments[s].type+" ",u.segments[s].hasOwnProperty("x3")&&(a+=this.roundtodec(u.segments[s].x2*o.scale)+" "+this.roundtodec(u.segments[s].y2*o.scale)+" "),a+=this.roundtodec(u.segments[s].x1*o.scale)+" "+this.roundtodec(u.segments[s].y1*o.scale)+" ";a+="Z "}if(a+='" />',o.lcpr||o.qcpr){for(s=0;s<r.segments.length;s++)r.segments[s].hasOwnProperty("x3")&&o.qcpr&&(a+='<circle cx="'+r.segments[s].x2*o.scale+'" cy="'+r.segments[s].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+.2*o.qcpr+'" stroke="black" />',a+='<circle cx="'+r.segments[s].x3*o.scale+'" cy="'+r.segments[s].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+.2*o.qcpr+'" stroke="black" />',a+='<line x1="'+r.segments[s].x1*o.scale+'" y1="'+r.segments[s].y1*o.scale+'" x2="'+r.segments[s].x2*o.scale+'" y2="'+r.segments[s].y2*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />',a+='<line x1="'+r.segments[s].x2*o.scale+'" y1="'+r.segments[s].y2*o.scale+'" x2="'+r.segments[s].x3*o.scale+'" y2="'+r.segments[s].y3*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />'),!r.segments[s].hasOwnProperty("x3")&&o.lcpr&&(a+='<circle cx="'+r.segments[s].x2*o.scale+'" cy="'+r.segments[s].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+.2*o.lcpr+'" stroke="black" />');for(c=0;c<r.holechildren.length;c++)for(u=i[r.holechildren[c]],s=0;s<u.segments.length;s++)u.segments[s].hasOwnProperty("x3")&&o.qcpr&&(a+='<circle cx="'+u.segments[s].x2*o.scale+'" cy="'+u.segments[s].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+.2*o.qcpr+'" stroke="black" />',a+='<circle cx="'+u.segments[s].x3*o.scale+'" cy="'+u.segments[s].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+.2*o.qcpr+'" stroke="black" />',a+='<line x1="'+u.segments[s].x1*o.scale+'" y1="'+u.segments[s].y1*o.scale+'" x2="'+u.segments[s].x2*o.scale+'" y2="'+u.segments[s].y2*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />',a+='<line x1="'+u.segments[s].x2*o.scale+'" y1="'+u.segments[s].y2*o.scale+'" x2="'+u.segments[s].x3*o.scale+'" y2="'+u.segments[s].y3*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />'),!u.segments[s].hasOwnProperty("x3")&&o.lcpr&&(a+='<circle cx="'+u.segments[s].x2*o.scale+'" cy="'+u.segments[s].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+.2*o.lcpr+'" stroke="black" />')}return a}},{key:"getsvgstring",value:function(e,t){t=this.checkoptions(t);for(var n=e.width*t.scale,o=e.height*t.scale,i="<svg "+(t.viewbox?'viewBox="0 0 '+n+" "+o+'" ':'width="'+n+'" height="'+o+'" ')+'version="1.1" xmlns="http://www.w3.org/2000/svg" desc="Created with imagetracer.js version '+this.versionnumber+'" >',r=0;r<e.layers.length;r+=1)for(var a=0;a<e.layers[r].length;a+=1)e.layers[r][a].isholepath||(i+=this.svgpathstring(e,r,a,t));return i+="</svg>"}},{key:"compareNumbers",value:function(e,t){return e-t}},{key:"torgbastr",value:function(e){return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"}},{key:"tosvgcolorstr",value:function(e,t){return'fill="rgb('+e.r+","+e.g+","+e.b+')" stroke="rgb('+e.r+","+e.g+","+e.b+')" stroke-width="'+t.strokewidth+'" opacity="'+e.a/255+'" '}},{key:"appendSVGString",value:function(e,t){var n=void 0;t?(n=document.getElementById(t))||((n=document.createElement("div")).id=t,document.body.appendChild(n)):(n=document.createElement("div"),document.body.appendChild(n)),n.innerHTML+=e}},{key:"blur",value:function(e,t,n){var o=void 0,i=void 0,r=void 0,a=void 0,s=void 0,c=void 0,u=void 0,l=void 0,h=void 0,f={width:e.width,height:e.height,data:[]};if((t=Math.floor(t))<1)return e;5<t&&(t=5),1024<(n=Math.abs(n))&&(n=1024);for(var d=this.gks[t-1],i=0;i<e.height;i++)for(o=0;o<e.width;o++){for(h=l=u=c=s=0,r=-t;r<t+1;r++)0<o+r&&o+r<e.width&&(a=4*(i*e.width+o+r),s+=e.data[a]*d[r+t],c+=e.data[a+1]*d[r+t],u+=e.data[a+2]*d[r+t],l+=e.data[a+3]*d[r+t],h+=d[r+t]);a=4*(i*e.width+o),f.data[a]=Math.floor(s/h),f.data[a+1]=Math.floor(c/h),f.data[a+2]=Math.floor(u/h),f.data[a+3]=Math.floor(l/h)}var p=new Uint8ClampedArray(f.data);for(i=0;i<e.height;i++)for(o=0;o<e.width;o++){for(h=l=u=c=s=0,r=-t;r<t+1;r++)0<i+r&&i+r<e.height&&(s+=p[a=4*((i+r)*e.width+o)]*d[r+t],c+=p[a+1]*d[r+t],u+=p[a+2]*d[r+t],l+=p[a+3]*d[r+t],h+=d[r+t]);a=4*(i*e.width+o),f.data[a]=Math.floor(s/h),f.data[a+1]=Math.floor(c/h),f.data[a+2]=Math.floor(u/h),f.data[a+3]=Math.floor(l/h)}for(i=0;i<e.height;i++)for(o=0;o<e.width;o++)a=4*(i*e.width+o),n<Math.abs(f.data[a]-e.data[a])+Math.abs(f.data[a+1]-e.data[a+1])+Math.abs(f.data[a+2]-e.data[a+2])+Math.abs(f.data[a+3]-e.data[a+3])&&(f.data[a]=e.data[a],f.data[a+1]=e.data[a+1],f.data[a+2]=e.data[a+2],f.data[a+3]=e.data[a+3]);return f}},{key:"loadImage",value:function(e,t,n){var o=new Image;n&&n.corsenabled&&(o.crossOrigin="Anonymous"),o.src=e,o.onload=function(){var e=document.createElement("canvas");e.width=o.width,e.height=o.height,e.getContext("2d").drawImage(o,0,0),t(e)}}},{key:"getImgdata",value:function(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)}},{key:"drawLayers",value:function(e,t,n,o){n=n||1;var i=void 0,r=void 0,a=void 0,s=void 0;for(a in o?(s=document.getElementById(o))||((s=document.createElement("div")).id=o,document.body.appendChild(s)):(s=document.createElement("div"),document.body.appendChild(s)),e)if(e.hasOwnProperty(a)){var c=e[a][0].length,u=e[a].length,l=document.createElement("canvas");l.width=c*n,l.height=u*n;for(var h=l.getContext("2d"),r=0;r<u;r+=1)for(i=0;i<c;i+=1)h.fillStyle=this.torgbastr(t[e[a][r][i]%t.length]),h.fillRect(i*n,r*n,n,n);s.appendChild(l)}}}]),o=r;function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.versionnumber="1.2.4",this.optionpresets={default:{corsenabled:!1,ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:!1,scale:1,roundcoords:1,viewbox:!1,desc:!1,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:.01,linefilter:!0,rightangleenhance:!1},sharp:{qtres:.01,linefilter:!1},detailed:{pathomit:0,roundcoords:2,ltres:.5,qtres:.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:.01,linefilter:!0,numberofcolors:16,strokewidth:2},artistic2:{qtres:.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:!0,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:!1,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}},this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],this.gks=[[.27901,.44198,.27901],[.135336,.228569,.272192,.228569,.135336],[.086776,.136394,.178908,.195843,.178908,.136394,.086776],[.063327,.093095,.122589,.144599,.152781,.144599,.122589,.093095,.063327],[.049692,.069304,.089767,.107988,.120651,.125194,.120651,.107988,.089767,.069304,.049692]],this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}]}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=T(n(3)),r=T(n(4)),a=T(n(120)),s=T(n(121)),c=T(n(123)),l=T(n(124)),h=T(n(125)),f=T(n(126)),d=T(n(128)),p=T(n(129)),v=T(n(130)),g=T(n(135)),m=T(n(137)),y=T(n(138)),_=T(n(139)),b=T(n(140)),O=T(n(141)),E=T(n(142)),C=T(n(143)),w=T(n(144)),k=n(27),M=n(1),j=n(0),x=T(n(145)),P=T(n(146));function T(e){return e&&e.__esModule?e:{default:e}}var S=u.default.extend,A=u.default.stamp,D=u.default.isArray,I=u.default.isString,N=u.default.forEachArray,R=u.default.forEachOwnProperties,n=u.default.CustomEvents,L=1e3,F=800,z={cssOnly:!0},H={backstoreOnly:!0},o=(o(B,[{key:"destroy",value:function(){var e=this._canvas.wrapperEl;this._canvas.clear(),e.parentNode.removeChild(e),this._detachZoomEvents()}},{key:"_attachZoomEvents",value:function(){this.getComponent(j.componentNames.ZOOM).attachKeyboardZoomEvents()}},{key:"_detachZoomEvents",value:function(){this.getComponent(j.componentNames.ZOOM).detachKeyboardZoomEvents()}},{key:"deactivateAll",value:function(){return this._canvas.discardActiveObject(),this}},{key:"renderAll",value:function(){return this._canvas.renderAll(),this}},{key:"add",value:function(e){var t=[];D(e)?t=e:t.push(e),(e=this._canvas).add.apply(e,t)}},{key:"contains",value:function(e){return this._canvas.contains(e)}},{key:"getObjects",value:function(){return this._canvas.getObjects().slice()}},{key:"getObject",value:function(e){return this._objects[e]}},{key:"remove",value:function(e){this._canvas.remove(e)}},{key:"removeAll",value:function(e){var t=this._canvas,n=t.getObjects().slice();return t.remove.apply(t,this._canvas.getObjects()),e&&t.clear(),n}},{key:"removeObjectById",value:function(e){var t=[],n=this._canvas,e=this.getObject(e);return e&&e.isType("group")&&!e.isEmpty()?(n.discardActiveObject(),e.forEachObject(function(e){t.push(e),n.remove(e)})):n.contains(e)&&(t.push(e),n.remove(e)),t}},{key:"getObjectId",value:function(e){var t=null;for(t in this._objects)if(this._objects.hasOwnProperty(t)&&e===this._objects[t])return t;return null}},{key:"getActiveObject",value:function(){return this._canvas._activeObject}},{key:"getActiveObjectIdForRemove",value:function(){var e=this.getActiveObject(),t=e.type,n=e.left,o=e.top;if("activeSelection"!==t)return this.getObjectId(e);o=new r.default.Group([].concat(e.getObjects()),{left:n,top:o});return this._addFabricObject(o)}},{key:"isReadyRemoveObject",value:function(){var e=this.getActiveObject();return e&&!e.isEditing}},{key:"getActiveObjects",value:function(){var e=this._canvas._activeObject;return e&&"activeSelection"===e.type?e:null}},{key:"getActiveSelectionFromObjects",value:function(e){var t=this.getCanvas();return new r.default.ActiveSelection(e,{canvas:t})}},{key:"setActiveObject",value:function(e){this._canvas.setActiveObject(e)}},{key:"setCropSelectionStyle",value:function(e){this.cropSelectionStyle=e}},{key:"getComponent",value:function(e){return this._componentMap[e]}},{key:"getDrawingMode",value:function(){return this._drawingMode}},{key:"startDrawingMode",value:function(e,t){if(this._isSameDrawingMode(e))return!0;this.stopDrawingMode();var n=this._getDrawingModeInstance(e);return n&&n.start&&(n.start(this,t),this._drawingMode=e),!!n}},{key:"stopDrawingMode",value:function(){var e;this._isSameDrawingMode(j.drawingModes.NORMAL)||((e=this._getDrawingModeInstance(this.getDrawingMode()))&&e.end&&e.end(this),this._drawingMode=j.drawingModes.NORMAL)}},{key:"zoom",value:function(e,t){var n=e.x,e=e.y;this.getComponent(j.componentNames.ZOOM).zoom({x:n,y:e},t)}},{key:"getZoomMode",value:function(){return this.getComponent(j.componentNames.ZOOM).mode}},{key:"startZoomInMode",value:function(){this.getComponent(j.componentNames.ZOOM).startZoomInMode()}},{key:"endZoomInMode",value:function(){this.getComponent(j.componentNames.ZOOM).endZoomInMode()}},{key:"zoomOut",value:function(){this.getComponent(j.componentNames.ZOOM).zoomOut()}},{key:"startHandMode",value:function(){this.getComponent(j.componentNames.ZOOM).startHandMode()}},{key:"endHandMode",value:function(){this.getComponent(j.componentNames.ZOOM).endHandMode()}},{key:"resetZoom",value:function(){this.getComponent(j.componentNames.ZOOM).resetZoom()}},{key:"toDataURL",value:function(e){var t=this.getComponent(j.componentNames.CROPPER);t.changeVisibility(!1);e=this._canvas&&this._canvas.toDataURL(e);return t.changeVisibility(!0),e}},{key:"setCanvasImage",value:function(e,t){t&&A(t),this.imageName=e,this.canvasImage=t}},{key:"setCssMaxDimension",value:function(e){this.cssMaxWidth=e.width||this.cssMaxWidth,this.cssMaxHeight=e.height||this.cssMaxHeight}},{key:"adjustCanvasDimension",value:function(){this.adjustCanvasDimensionBase(this.canvasImage.scale(1))}},{key:"adjustCanvasDimensionBase",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=(e=e||this.canvasImage).getBoundingRect(),n=t.width,o=t.height,t=this._calcMaxDimension(n,o);this.setCanvasCssDimension({width:"100%",height:"100%","max-width":t.width+"px","max-height":t.height+"px"}),this.setCanvasBackstoreDimension({width:n,height:o}),this._canvas.centerObject(e)}},{key:"setCanvasCssDimension",value:function(e){this._canvas.setDimensions(e,z)}},{key:"setCanvasBackstoreDimension",value:function(e){this._canvas.setDimensions(e,H)}},{key:"setImageProperties",value:function(e,t){var n=this.canvasImage;n&&(n.set(e).setCoords(),t&&this._canvas.renderAll())}},{key:"getCanvasElement",value:function(){return this._canvas.getElement()}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getCanvasImage",value:function(){return this.canvasImage}},{key:"getImageName",value:function(){return this.imageName}},{key:"addImageObject",value:function(e){var n=this,o=this._callbackAfterLoadingImageObject.bind(this);return new M.Promise(function(t){r.default.Image.fromURL(e,function(e){o(e),t(n.createObjectProperties(e))},{crossOrigin:"Anonymous"})})}},{key:"getCenter",value:function(){return this._canvas.getCenter()}},{key:"getCropzoneRect",value:function(){return this.getComponent(j.componentNames.CROPPER).getCropzoneRect()}},{key:"setCropzoneRect",value:function(e){this.getComponent(j.componentNames.CROPPER).setCropzoneRect(e)}},{key:"getCroppedImageData",value:function(e){return this.getComponent(j.componentNames.CROPPER).getCroppedImageData(e)}},{key:"setBrush",value:function(e){var t=this._drawingMode,n=j.componentNames.FREE_DRAWING;t===j.drawingModes.LINE_DRAWING&&(n=j.componentNames.LINE),this.getComponent(n).setBrush(e)}},{key:"setDrawingShape",value:function(e,t){this.getComponent(j.componentNames.SHAPE).setStates(e,t)}},{key:"setIconStyle",value:function(e,t){this.getComponent(j.componentNames.ICON).setStates(e,t)}},{key:"registerPaths",value:function(e){this.getComponent(j.componentNames.ICON).registerPaths(e)}},{key:"changeCursor",value:function(e){var t=this.getCanvas();t.defaultCursor=e,t.renderAll()}},{key:"hasFilter",value:function(e){return this.getComponent(j.componentNames.FILTER).hasFilter(e)}},{key:"setSelectionStyle",value:function(e){S(j.fObjectOptions.SELECTION_STYLE,e)}},{key:"setObjectProperties",value:function(e,t){e=this.getObject(e),t=S({},t);return e.set(t),e.setCoords(),this.getCanvas().renderAll(),t}},{key:"getObjectProperties",value:function(e,t){var n=this.getObject(e),o={};return I(t)?o[t]=n[t]:D(t)?N(t,function(e){o[e]=n[e]}):R(t,function(e,t){o[t]=n[t]}),o}},{key:"getObjectPosition",value:function(e,t,n){e=this.getObject(e);return e?e.getPointByOrigin(t,n):null}},{key:"setObjectPosition",value:function(e,t){var n=this.getObject(e),o=t.x,i=t.y,r=t.originX,e=t.originY;if(!n)return!1;t=n.getPointByOrigin(r,e),r=n.getPointByOrigin("center","center"),e=r.x-t.x,t=r.y-t.y;return n.set({left:o+e,top:i+t}),n.setCoords(),!0}},{key:"getCanvasSize",value:function(){var e=this.getCanvasImage();return{width:e?e.width:0,height:e?e.height:0}}},{key:"createStaticCanvas",value:function(){var e=new r.default.StaticCanvas;return e.set({enableRetinaScaling:!1}),e}},{key:"_getDrawingModeInstance",value:function(e){return this._drawingModeMap[e]}},{key:"_setObjectCachingToFalse",value:function(){r.default.Object.prototype.objectCaching=!1}},{key:"_setCanvasElement",value:function(e){var t=void 0,n=void 0;"CANVAS"!==(t=e.nodeType?e:document.querySelector(e)).nodeName.toUpperCase()&&(n=document.createElement("canvas"),t.appendChild(n)),this._canvas=new r.default.Canvas(n,{containerClass:"tui-image-editor-canvas-container",enableRetinaScaling:!1})}},{key:"_createDrawingModeInstances",value:function(){this._register(this._drawingModeMap,new y.default),this._register(this._drawingModeMap,new _.default),this._register(this._drawingModeMap,new b.default),this._register(this._drawingModeMap,new O.default),this._register(this._drawingModeMap,new E.default),this._register(this._drawingModeMap,new C.default),this._register(this._drawingModeMap,new w.default),this._register(this._drawingModeMap,new P.default)}},{key:"_createComponents",value:function(){this._register(this._componentMap,new a.default(this)),this._register(this._componentMap,new s.default(this)),this._register(this._componentMap,new c.default(this)),this._register(this._componentMap,new l.default(this)),this._register(this._componentMap,new h.default(this)),this._register(this._componentMap,new f.default(this)),this._register(this._componentMap,new d.default(this)),this._register(this._componentMap,new p.default(this)),this._register(this._componentMap,new v.default(this)),this._register(this._componentMap,new g.default(this)),this._register(this._componentMap,new m.default(this)),this._register(this._componentMap,new x.default(this))}},{key:"_register",value:function(e,t){e[t.getName()]=t}},{key:"_isSameDrawingMode",value:function(e){return this.getDrawingMode()===e}},{key:"_calcMaxDimension",value:function(e,t){var n=this.cssMaxWidth/e,o=this.cssMaxHeight/t,i=Math.min(e,this.cssMaxWidth),r=Math.min(t,this.cssMaxHeight);return n<1&&n<o?(i=e*n,r=t*n):o<1&&o<n&&(i=e*o,r=t*o),{width:Math.floor(i),height:Math.floor(r)}}},{key:"_callbackAfterLoadingImageObject",value:function(e){var t=this.getCanvasImage().getCenterPoint();e.set(j.fObjectOptions.SELECTION_STYLE),e.set({left:t.x,top:t.y,crossOrigin:"Anonymous"}),this.getCanvas().add(e).setActiveObject(e)}},{key:"_attachCanvasEvents",value:function(){var e=this._canvas,t=this._handler;e.on({"mouse:down":t.onMouseDown,"object:added":t.onObjectAdded,"object:removed":t.onObjectRemoved,"object:moving":t.onObjectMoved,"object:scaling":t.onObjectScaled,"object:modified":t.onObjectModified,"object:rotating":t.onObjectRotated,"path:created":t.onPathCreated,"selection:cleared":t.onSelectionCleared,"selection:created":t.onSelectionCreated,"selection:updated":t.onObjectSelected})}},{key:"_onMouseDown",value:function(e){var t,n=this,o=e.e,i=e.target,e=this._canvas.getPointer(o);i&&(t=i.type,i=(0,k.makeSelectionUndoData)(i,function(e){return(0,k.makeSelectionUndoDatum)(n.getObjectId(e),e,"activeSelection"===t)}),(0,k.setCachedUndoDataForDimension)(i)),this.fire(j.eventNames.MOUSE_DOWN,o,e)}},{key:"_onObjectAdded",value:function(e){e=e.target;e.isType("cropzone")||this._addFabricObject(e)}},{key:"_onObjectRemoved",value:function(e){e=e.target;this._removeFabricObject(A(e))}},{key:"_onObjectMoved",value:function(e){var t=this;this._lazyFire(j.eventNames.OBJECT_MOVED,function(e){return t.createObjectProperties(e)},e.target)}},{key:"_onObjectScaled",value:function(e){var t=this;this._lazyFire(j.eventNames.OBJECT_SCALED,function(e){return t.createObjectProperties(e)},e.target)}},{key:"_onObjectModified",value:function(e){var t=e.target;"activeSelection"===t.type&&t.getObjects().forEach(function(e){return e.fire("modifiedInGroup",t)}),this.fire(j.eventNames.OBJECT_MODIFIED,t,this.getObjectId(t))}},{key:"_onObjectRotated",value:function(e){var t=this;this._lazyFire(j.eventNames.OBJECT_ROTATED,function(e){return t.createObjectProperties(e)},e.target)}},{key:"_lazyFire",value:function(t,n,e){var o=this,i=e&&e.canvasEventDelegation?e.canvasEventDelegation(t):"none";"unregistered"===i&&e.canvasEventRegister(t,function(e){o.fire(t,n(e))}),"none"===i&&this.fire(t,n(e))}},{key:"_onObjectSelected",value:function(e){e=e.target,e=this.createObjectProperties(e);this.fire(j.eventNames.OBJECT_ACTIVATED,e)}},{key:"_onPathCreated",value:function(e){var t=e.path.getCenterPoint(),n=t.x,t=t.y;e.path.set(S({left:n,top:t},j.fObjectOptions.SELECTION_STYLE));e=this.createObjectProperties(e.path);this.fire(j.eventNames.ADD_OBJECT,e)}},{key:"_onSelectionCleared",value:function(){this.fire(j.eventNames.SELECTION_CLEARED)}},{key:"_onSelectionCreated",value:function(e){var t=e.target,t=this.createObjectProperties(t);this.fire(j.eventNames.OBJECT_ACTIVATED,t),this.fire(j.eventNames.SELECTION_CREATED,e.target)}},{key:"discardSelection",value:function(){this._canvas.discardActiveObject(),this._canvas.renderAll()}},{key:"changeSelectableAll",value:function(t){this._canvas.forEachObject(function(e){e.selectable=t,e.hoverCursor=t?"move":"crosshair"})}},{key:"createObjectProperties",value:function(e){var t,n={id:A(e),type:e.type};return S(n,(0,M.getProperties)(e,["left","top","width","height","fill","stroke","strokeWidth","opacity","angle"])),(0,M.includes)(["i-text","text"],e.type)?S(n,this._createTextProperties(e,n)):(0,M.includes)(["rect","triangle","circle"],e.type)&&(t=this.getComponent(j.componentNames.SHAPE),S(n,{fill:t.makeFillPropertyForUserEvent(e)})),n}},{key:"_createTextProperties",value:function(e){var t={};return S(t,(0,M.getProperties)(e,["text","fontFamily","fontSize","fontStyle","textAlign","textDecoration","fontWeight"])),t}},{key:"_addFabricObject",value:function(e){var t=A(e);return this._objects[t]=e,t}},{key:"_removeFabricObject",value:function(e){delete this._objects[e]}},{key:"resetTargetObjectForCopyPaste",value:function(){var e=this.getActiveObject();e&&(this.targetObjectForCopyPaste=e)}},{key:"pasteObject",value:function(){var t=this;if(!this.targetObjectForCopyPaste)return M.Promise.resolve([]);var e=this.targetObjectForCopyPaste,e="activeSelection"===e.type?e.getObjects():[e],n=null;return this.discardSelection(),this._cloneObject(e).then(function(e){n=1<e.length?t.getActiveSelectionFromObjects(e):e[0],t.targetObjectForCopyPaste=n,t.setActiveObject(n)})}},{key:"_cloneObject",value:function(e){var t=this,e=u.default.map(e,function(e){return t._cloneObjectItem(e)});return M.Promise.all(e)}},{key:"_cloneObjectItem",value:function(e){var n=this;return this._copyFabricObjectForPaste(e).then(function(e){var t=n.createObjectProperties(e);return n.add(e),n.fire(j.eventNames.ADD_OBJECT,t),e})}},{key:"_copyFabricObjectForPaste",value:function(e){function s(e,t){return t?e-10:e+10}var c=this;return this._copyFabricObject(e).then(function(e){var t=e.left,n=e.top,o=e.width,i=e.height,r=c.getCanvasSize(),a=r.width,r=r.height;return e.set(u.default.extend({left:s(t,a<t+o/2+10),top:s(n,r<n+i/2+10)},j.fObjectOptions.SELECTION_STYLE)),e})}},{key:"_copyFabricObject",value:function(o){var i=this;return new M.Promise(function(n){o.clone(function(e){var t=i.getComponent(j.componentNames.SHAPE);(0,M.isShape)(e)&&t.processForCopiedObject(e,o),n(e)})})}},{key:"getCurrentDimensions",value:function(){return this.getComponent(j.componentNames.RESIZE).getCurrentDimensions()}},{key:"getOriginalDimensions",value:function(){return this.getComponent(j.componentNames.RESIZE).getOriginalDimensions()}},{key:"setOriginalDimensions",value:function(e){this.getComponent(j.componentNames.RESIZE).setOriginalDimensions(e)}},{key:"resize",value:function(e){return this.getComponent(j.componentNames.RESIZE).resize(e)}},{key:"toJSON",value:function(){return this._canvas.toJSON()}},{key:"loadFromJSON",value:function(e){this._canvas.loadFromJSON(e,this._canvas.renderAll.bind(this._canvas))}}]),B);function B(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.cssMaxWidth,t=t.cssMaxHeight;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,B),this.canvasImage=null,this.cssMaxWidth=n||L,this.cssMaxHeight=t||F,this.cropSelectionStyle={},this.targetObjectForCopyPaste=null,this.imageName="",this._objects={},this._canvas=null,this._drawingMode=j.drawingModes.NORMAL,this._drawingModeMap={},this._componentMap={},this._handler={onMouseDown:this._onMouseDown.bind(this),onObjectAdded:this._onObjectAdded.bind(this),onObjectRemoved:this._onObjectRemoved.bind(this),onObjectMoved:this._onObjectMoved.bind(this),onObjectScaled:this._onObjectScaled.bind(this),onObjectModified:this._onObjectModified.bind(this),onObjectRotated:this._onObjectRotated.bind(this),onObjectSelected:this._onObjectSelected.bind(this),onPathCreated:this._onPathCreated.bind(this),onSelectionCleared:this._onSelectionCleared.bind(this),onSelectionCreated:this._onSelectionCreated.bind(this)},this._setObjectCachingToFalse(),this._setCanvasElement(e),this._createDrawingModeInstances(),this._createComponents(),this._attachCanvasEvents(),this._attachZoomEvents()}n.mixin(o),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(7),s=(r=a)&&r.__esModule?r:{default:r},c=n(1),u=n(0);var l={padding:0,crossOrigin:"Anonymous"},o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,s.default),o(h,[{key:"load",value:function(t,e){var n=this;return t||e?this._setBackgroundImage(e).then(function(e){return n.setCanvasImage(t,e),n.adjustCanvasDimension(),e}):((e=this.getCanvas()).backgroundImage=null,e.renderAll(),new c.Promise(function(e){n.setCanvasImage("",null),e()}))}},{key:"_setBackgroundImage",value:function(e){var i=this;return e?new c.Promise(function(t,n){var o=i.getCanvas();o.setBackgroundImage(e,function(){var e=o.backgroundImage;e&&e.getElement()?t(e):n(u.rejectMessages.loadingImageFailed)},l)}):c.Promise.reject(u.rejectMessages.loadImage)}}]),h);function h(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,u.componentNames.IMAGE_LOADER,e))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=h(n(3)),r=h(n(4)),a=h(n(7)),s=h(n(122)),c=n(0),l=n(1);function h(e){return e&&e.__esModule?e:{default:e}}var f={presetRatio:null,top:-10,left:-10,height:1,width:1},o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,a.default),o(d,[{key:"start",value:function(){var e;this._cropzone||((e=this.getCanvas()).forEachObject(function(e){e.evented=!1}),this._cropzone=new s.default(e,u.default.extend({left:0,top:0,width:.5,height:.5,strokeWidth:0,cornerSize:10,cornerColor:"black",fill:"transparent"},c.CROPZONE_DEFAULT_OPTIONS,this.graphics.cropSelectionStyle)),e.discardActiveObject(),e.add(this._cropzone),e.on("mouse:down",this._listeners.mousedown),e.selection=!1,e.defaultCursor="crosshair",r.default.util.addListener(document,"keydown",this._listeners.keydown),r.default.util.addListener(document,"keyup",this._listeners.keyup))}},{key:"end",value:function(){var e=this.getCanvas(),t=this._cropzone;t&&(e.remove(t),e.selection=!0,e.defaultCursor="default",e.off("mouse:down",this._listeners.mousedown),e.forEachObject(function(e){e.evented=!0}),this._cropzone=null,r.default.util.removeListener(document,"keydown",this._listeners.keydown),r.default.util.removeListener(document,"keyup",this._listeners.keyup))}},{key:"changeVisibility",value:function(e){this._cropzone&&this._cropzone.set({visible:e})}},{key:"_onFabricMouseDown",value:function(e){var t=this.getCanvas();e.target||(t.selection=!1,e=t.getPointer(e.e),this._startX=e.x,this._startY=e.y,t.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup}))}},{key:"_onFabricMouseMove",value:function(e){var t=this.getCanvas(),n=t.getPointer(e.e),o=n.x,e=n.y,n=this._cropzone;10<Math.abs(o-this._startX)+Math.abs(e-this._startY)&&(t.remove(n),n.set(this._calcRectDimensionFromPoint(o,e)),t.add(n),t.setActiveObject(n))}},{key:"_calcRectDimensionFromPoint",value:function(e,t){var n=this.getCanvas(),o=n.getWidth(),i=n.getHeight(),r=this._startX,a=this._startY,s=(0,l.clamp)(e,0,r),n=(0,l.clamp)(t,0,a),o=(0,l.clamp)(e,r,o)-s,i=(0,l.clamp)(t,a,i)-n;return this._withShiftKey&&(i<o?i=o:o<i&&(o=i),e<=r&&(s=r-o),t<=a&&(n=a-i)),{left:s,top:n,width:o,height:i}}},{key:"_onFabricMouseUp",value:function(){var e=this._cropzone,t=this._listeners,n=this.getCanvas();n.setActiveObject(e),n.off({"mouse:move":t.mousemove,"mouse:up":t.mouseup})}},{key:"getCroppedImageData",value:function(e){var t=this.getCanvas(),n=t.contains(this._cropzone);if(!e)return null;n&&t.remove(this._cropzone);e={imageName:this.getImageName(),url:t.toDataURL(e)};return n&&t.add(this._cropzone),e}},{key:"getCropzoneRect",value:function(){var e=this._cropzone;return e.isValid()?{left:e.left,top:e.top,width:e.width,height:e.height}:null}},{key:"setCropzoneRect",value:function(e){var t=this.getCanvas(),n=this._cropzone;t.discardActiveObject(),t.selection=!1,t.remove(n),n.set(e?this._getPresetPropertiesForCropSize(e):f),t.add(n),t.selection=!0,e&&t.setActiveObject(n)}},{key:"_getPresetPropertiesForCropSize",value:function(e){function t(e,t){return t<e?t/e:1}var n=this.getCanvas(),o=n.getWidth(),i=n.getHeight(),r=i<=o?o:i,a=r,s=t(n=r*e,o),r=u.default.map([n,r],function(e){return e*s}),n=r[0],c=t(a=r[1],i),r=u.default.map([n,a],function(e){return(0,l.fixFloatingPoint)(e*c)});return n=r[0],{presetRatio:e,top:(i-(a=r[1]))/2,left:(o-n)/2,width:n,height:a}}},{key:"_onKeyDown",value:function(e){e.keyCode===c.keyCodes.SHIFT&&(this._withShiftKey=!0)}},{key:"_onKeyUp",value:function(e){e.keyCode===c.keyCodes.SHIFT&&(this._withShiftKey=!1)}}]),d);function d(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,c.componentNames.CROPPER,e));return e._cropzone=null,e._startX=null,e._startY=null,e._withShiftKey=!1,e._listeners={keydown:e._onKeyDown.bind(e),keyup:e._onKeyUp.bind(e),mousedown:e._onFabricMouseDown.bind(e),mousemove:e._onFabricMouseMove.bind(e),mouseup:e._onFabricMouseUp.bind(e)},e}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=r(n(3)),o=r(n(4)),u=n(1),i=n(0);function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(){}var l=["tl","tr","mt","ml","mr","mb","bl","br"];function h(e,t){return t<e?"width":"height"}n=o.default.util.createClass(o.default.Rect,{initialize:function(e,t,n){(t=c.default.extend(t,n)).type="cropzone",this.callSuper("initialize",t),this._addEventHandler(),this.canvas=e,this.options=t},canvasEventDelegation:function(e){var t="unregistered";return this.canvasEventTrigger[e]!==s?t="registered":[i.eventNames.OBJECT_MOVED,i.eventNames.OBJECT_SCALED].indexOf(e)<0&&(t="none"),t},canvasEventRegister:function(e,t){this.canvasEventTrigger[e]=t},_addEventHandler:function(){var e;this.canvasEventTrigger=(a(e={},i.eventNames.OBJECT_MOVED,s),a(e,i.eventNames.OBJECT_SCALED,s),e),this.on({moving:this._onMoving.bind(this),scaling:this._onScaling.bind(this)}),o.default.util.addListener(document,"keydown",this._onKeyDown.bind(this)),o.default.util.addListener(document,"keyup",this._onKeyUp.bind(this))},_renderCropzone:function(e){var t=this.flipX?-1:1,n=this.flipY?-1:1,t=t/this.scaleX,n=n/this.scaleY;e.scale(t,n),this._fillOuterRect(e,"rgba(0, 0, 0, 0.5)"),this.options.lineWidth?(this._fillInnerRect(e),this._strokeBorder(e,"rgb(255, 255, 255)",{lineWidth:this.options.lineWidth})):(this._strokeBorder(e,"rgb(0, 0, 0)",{lineDashWidth:7}),this._strokeBorder(e,"rgb(255, 255, 255)",{lineDashWidth:7,lineDashOffset:7})),e.scale(1/t,1/n)},_render:function(e){this.callSuper("_render",e),this._renderCropzone(e)},_fillOuterRect:function(e,t){var n=this._getCoordinates(),o=n.x,n=n.y;e.save(),e.fillStyle=t,e.beginPath(),e.moveTo(o[0]-1,n[0]-1),e.lineTo(o[3]+1,n[0]-1),e.lineTo(o[3]+1,n[3]+1),e.lineTo(o[0]-1,n[3]+1),e.lineTo(o[0]-1,n[0]-1),e.closePath(),e.moveTo(o[1],n[1]),e.lineTo(o[1],n[2]),e.lineTo(o[2],n[2]),e.lineTo(o[2],n[1]),e.lineTo(o[1],n[1]),e.closePath(),e.fill(),e.restore()},_fillInnerRect:function(e){var t=this._getCoordinates(),n=t.x,t=t.y,n=this._caculateInnerPosition(n,(n[2]-n[1])/3),t=this._caculateInnerPosition(t,(t[2]-t[1])/3);e.save(),e.strokeStyle="rgba(255, 255, 255, 0.7)",e.lineWidth=this.options.lineWidth,e.beginPath(),e.moveTo(n[0],t[1]),e.lineTo(n[3],t[1]),e.moveTo(n[0],t[2]),e.lineTo(n[3],t[2]),e.moveTo(n[1],t[0]),e.lineTo(n[1],t[3]),e.moveTo(n[2],t[0]),e.lineTo(n[2],t[3]),e.stroke(),e.closePath(),e.restore()},_caculateInnerPosition:function(e,t){var n=[];return n[0]=e[1],n[1]=e[1]+t,n[2]=e[1]+2*t,n[3]=e[2],n},_getCoordinates:function(){var e=this.canvas,t=this.width,n=this.height,o=this.left,i=this.top,r=t/2,a=n/2,s=e.getHeight(),e=e.getWidth();return{x:c.default.map([-(r+o),-r,r,e-o-t+r],Math.ceil),y:c.default.map([-(a+i),-a,a,s-i-n+a],Math.ceil)}},_strokeBorder:function(e,t,n){var o=n.lineDashWidth,i=n.lineDashOffset,r=n.lineWidth,a=this.width/2,n=this.height/2;e.save(),e.strokeStyle=t,e.setLineDash&&e.setLineDash([o,o]),i&&(e.lineDashOffset=i),r&&(e.lineWidth=r),e.beginPath(),e.moveTo(-a,-n),e.lineTo(a,-n),e.lineTo(a,n),e.lineTo(-a,n),e.lineTo(-a,-n),e.stroke(),e.restore()},_onMoving:function(){var e=this.height,t=this.width,n=this.left,o=this.top,t=this.canvas.getWidth()-t,e=this.canvas.getHeight()-e;this.left=(0,u.clamp)(n,0,t),this.top=(0,u.clamp)(o,0,e),this.canvasEventTrigger[i.eventNames.OBJECT_MOVED](this)},_onScaling:function(e){var t=e.transform.corner,e=this.canvas.getPointer(e.e),t=this._calcScalingSizeFromPointer(e,t);this.scale(1).set(t),this.canvasEventTrigger[i.eventNames.OBJECT_SCALED](this)},_calcScalingSizeFromPointer:function(e,t){return 0<=l.indexOf(t)&&this._resizeCropZone(e,t)},adjustRatioCropzoneSize:function(e){var t=e.width,n=e.height,o=e.leftMaker,i=e.topMaker,r=e.maxWidth,a=e.maxHeight,e=e.scaleTo;if(t=r?(0,u.clamp)(t,1,r):t,n=a?(0,u.clamp)(n,1,a):n,!this.presetRatio)return this._withShiftKey&&(n<t?n=t:t<n&&(t=n)),{width:t,height:n,left:o(t),top:i(n)};"width"===e?n=t/this.presetRatio:t=n*this.presetRatio;var s=Math.min(r/t,a/n);return s<=1&&(t=(a=[t,n].map(function(e){return e*s}))[0],n=a[1]),{width:t,height:n,left:o(t),top:i(n)}},_getCropzoneRectInfo:function(){var e=this.canvas,t=e.width,n=e.height,o=this.getBoundingRect(!1,!0),i=o.top,r=o.left,e=o.width,o=o.height;return{rectTop:i,rectLeft:r,rectWidth:e,rectHeight:o,rectRight:r+e,rectBottom:i+o,canvasWidth:t,canvasHeight:n}},_resizeCropZone:function(e,t){var n=e.x,o=e.y,i=this._getCropzoneRectInfo(),r=i.rectWidth,a=i.rectHeight,s=i.rectTop,c=i.rectLeft,u=i.rectBottom,l=i.rectRight,e=i.canvasWidth,i=i.canvasHeight,o={tl:{width:l-n,height:u-o,leftMaker:function(e){return l-e},topMaker:function(e){return u-e},maxWidth:l,maxHeight:u,scaleTo:h(c-n,s-o)},tr:{width:n-c,height:u-o,leftMaker:function(){return c},topMaker:function(e){return u-e},maxWidth:e-c,maxHeight:u,scaleTo:h(n-l,s-o)},mt:{width:r,height:u-o,leftMaker:function(){return c},topMaker:function(e){return u-e},maxWidth:e-c,maxHeight:u,scaleTo:"height"},ml:{width:l-n,height:a,leftMaker:function(e){return l-e},topMaker:function(){return s},maxWidth:l,maxHeight:i-s,scaleTo:"width"},mr:{width:n-c,height:a,leftMaker:function(){return c},topMaker:function(){return s},maxWidth:e-c,maxHeight:i-s,scaleTo:"width"},mb:{width:r,height:o-s,leftMaker:function(){return c},topMaker:function(){return s},maxWidth:e-c,maxHeight:i-s,scaleTo:"height"},bl:{width:l-n,height:o-s,leftMaker:function(e){return l-e},topMaker:function(){return s},maxWidth:l,maxHeight:i-s,scaleTo:h(c-n,o-u)},br:{width:n-c,height:o-s,leftMaker:function(){return c},topMaker:function(){return s},maxWidth:e-c,maxHeight:i-s,scaleTo:h(n-l,o-u)}};return this.adjustRatioCropzoneSize(o[t])},isValid:function(){return 0<=this.left&&0<=this.top&&0<this.width&&0<this.height},_onKeyDown:function(e){e.keyCode===i.keyCodes.SHIFT&&(this._withShiftKey=!0)},_onKeyUp:function(e){e.keyCode===i.keyCodes.SHIFT&&(this._withShiftKey=!1)}});t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=u(n(3)),a=u(n(7)),s=n(1),c=n(0);function u(e){return e&&e.__esModule?e:{default:e}}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(l,a.default),o(l,[{key:"getCurrentSetting",value:function(){var e=this.getCanvasImage();return{flipX:e.flipX,flipY:e.flipY}}},{key:"set",value:function(e){var t=this.getCurrentSetting(),n=t.flipX!==e.flipX,o=t.flipY!==e.flipY;return n||o?(r.default.extend(t,e),this.setImageProperties(t,!0),this._invertAngle(n,o),this._flipObjects(n,o),s.Promise.resolve({flipX:t.flipX,flipY:t.flipY,angle:this.getCanvasImage().angle})):s.Promise.reject(c.rejectMessages.flip)}},{key:"_invertAngle",value:function(e,t){var n=this.getCanvasImage(),o=n.angle;e&&(o*=-1),t&&(o*=-1),n.rotate(parseFloat(o)).setCoords()}},{key:"_flipObjects",value:function(e,t){var n=this.getCanvas();e&&n.forEachObject(function(e){e.set({angle:parseFloat(-1*e.angle),flipX:!e.flipX,left:n.width-e.left}).setCoords()}),t&&n.forEachObject(function(e){e.set({angle:parseFloat(-1*e.angle),flipY:!e.flipY,top:n.height-e.top}).setCoords()}),n.renderAll()}},{key:"reset",value:function(){return this.set({flipX:!1,flipY:!1})}},{key:"flipX",value:function(){var e=this.getCurrentSetting();return this.set({flipX:!e.flipX,flipY:e.flipY})}},{key:"flipY",value:function(){var e=this.getCurrentSetting();return this.set({flipX:e.flipX,flipY:!e.flipY})}}]),o=l;function l(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,c.componentNames.FLIP,e))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=u(n(4)),r=u(n(7)),a=n(1),c=n(0);function u(e){return e&&e.__esModule?e:{default:e}}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(l,r.default),o(l,[{key:"getCurrentAngle",value:function(){return this.getCanvasImage().angle}},{key:"setAngle",value:function(e){var t=this.getCurrentAngle()%360;e%=360;var n=this.getCanvasImage(),o=n.getCenterPoint();n.set({angle:e}).setCoords(),this.adjustCanvasDimension();n=n.getCenterPoint();return this._rotateForEachObject(o,n,e-t),a.Promise.resolve(e)}},{key:"_rotateForEachObject",value:function(o,e,i){var t=this.getCanvas(),r=o.x-e.x,a=o.y-e.y;t.forEachObject(function(e){var t=e.getCenterPoint(),n=s.default.util.degreesToRadians(i),n=s.default.util.rotatePoint(t,o,n);e.set({left:n.x-r,top:n.y-a,angle:(e.angle+i)%360}),e.setCoords()}),t.renderAll()}},{key:"rotate",value:function(e){var t=this.getCurrentAngle();return this.setAngle(t+e)}}]),o=l;function l(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,c.componentNames.ROTATION,e))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=c(n(4)),a=c(n(7)),s=n(0);function c(e){return e&&e.__esModule?e:{default:e}}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(u,a.default),o(u,[{key:"start",value:function(e){this.getCanvas().isDrawingMode=!0,this.setBrush(e)}},{key:"setBrush",value:function(e){var t=this.getCanvas().freeDrawingBrush;this.width=(e=e||{}).width||this.width,e.color&&(this.oColor=new r.default.Color(e.color)),t.width=this.width,t.color=this.oColor.toRgba()}},{key:"end",value:function(){this.getCanvas().isDrawingMode=!1}}]),o=u;function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,s.componentNames.FREE_DRAWING,e));return e.width=12,e.oColor=new r.default.Color("rgba(0, 0, 0, 0.5)"),e}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=l(n(3)),a=l(n(4)),s=l(n(7)),c=l(n(127)),u=n(0);function l(e){return e&&e.__esModule?e:{default:e}}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(h,s.default),o(h,[{key:"setHeadOption",value:function(e){e=e.arrowType;this._arrowType=void 0===e?{head:null,tail:null}:e}},{key:"start",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.getCanvas();t.defaultCursor="crosshair",t.selection=!1,this.setHeadOption(e),this.setBrush(e),t.forEachObject(function(e){e.set({evented:!1})}),t.on({"mouse:down":this._listeners.mousedown})}},{key:"setBrush",value:function(e){var t=this.getCanvas().freeDrawingBrush;this._width=(e=e||{}).width||this._width,e.color&&(this._oColor=new a.default.Color(e.color)),t.width=this._width,t.color=this._oColor.toRgba()}},{key:"end",value:function(){var e=this.getCanvas();e.defaultCursor="default",e.selection=!0,e.forEachObject(function(e){e.set({evented:!0})}),e.off("mouse:down",this._listeners.mousedown)}},{key:"_onFabricMouseDown",value:function(e){var t=this.getCanvas(),n=t.getPointer(e.e),e=n.x,n=n.y;this._line=new c.default([e,n,e,n],{stroke:this._oColor.toRgba(),strokeWidth:this._width,arrowType:this._arrowType,evented:!1}),this._line.set(u.fObjectOptions.SELECTION_STYLE),t.add(this._line),t.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup}),this.fire(u.eventNames.ADD_OBJECT,this._createLineEventObjectProperties())}},{key:"_onFabricMouseMove",value:function(e){var t=this.getCanvas(),e=t.getPointer(e.e);this._line.set({x2:e.x,y2:e.y}),this._line.setCoords(),t.renderAll()}},{key:"_onFabricMouseUp",value:function(){var e=this.getCanvas();this.fire(u.eventNames.OBJECT_ADDED,this._createLineEventObjectProperties()),this._line=null,e.off({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}},{key:"_createLineEventObjectProperties",value:function(){var e=this.graphics.createObjectProperties(this._line),t=this._line,n=t.x1,o=t.x2,i=t.y1,t=t.y2;return r.default.extend({},e,{startPosition:{x:n,y:i},endPosition:{x:o,y:t}})}}]),o=h;function h(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,u.componentNames.LINE,e));return e._width=12,e._oColor=new a.default.Color("rgba(0, 0, 0, 0.5)"),e._listeners={mousedown:e._onFabricMouseDown.bind(e),mousemove:e._onFabricMouseMove.bind(e),mouseup:e._onFabricMouseUp.bind(e)},e}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),n=(o=i)&&o.__esModule?o:{default:o};n=n.default.util.createClass(n.default.Line,{type:"line",initialize:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.callSuper("initialize",e,t),this.arrowType=t.arrowType},_render:function(e){var t=this.calcLinePoints(),t={fromX:t.x1,fromY:t.y1,toX:t.x2,toY:t.y2};(this.ctx=e).lineWidth=this.strokeWidth,this._renderBasicLinePath(t),this._drawDecoratorPath(t),this._renderStroke(e)},_renderBasicLinePath:function(e){var t=e.fromX,n=e.fromY,o=e.toX,e=e.toY;this.ctx.beginPath(),this.ctx.moveTo(t,n),this.ctx.lineTo(o,e)},_drawDecoratorPath:function(e){this._drawDecoratorPathType("head",e),this._drawDecoratorPathType("tail",e)},_drawDecoratorPathType:function(e,t){switch(this.arrowType[e]){case"triangle":this._drawTrianglePath(e,t);break;case"chevron":this._drawChevronPath(e,t)}},_drawTrianglePath:function(e,t){var n=1.7*this.ctx.lineWidth;this._drawChevronPath(e,t,n),this.ctx.closePath()},_drawChevronPath:function(e,t,n){var o=this,i=t.fromX,r=t.fromY,a=t.toX,s=t.toY,c=this.ctx;n=n||2.7*this.ctx.lineWidth;var t="head"===e?[i,r]:[a,s],u=t[0],l=t[1],i="head"===e?[a,s]:[i,r],r=180*Math.atan2(i[1]-l,i[0]-u)/Math.PI,i=function(e){return o.getRotatePosition(n,e,{x:u,y:l})};c.moveTo.apply(c,i(30+r)),c.lineTo(u,l),c.lineTo.apply(c,i(r-30))},getRotatePosition:function(e,t,n){var o=t*Math.PI/180,t=n.x,n=n.y;return[e*Math.cos(o)+t,e*Math.sin(o)+n]}});t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=a(n(3)),u=a(n(4)),r=a(n(7)),l=n(1),h=n(0);function a(e){return e&&e.__esModule?e:{default:e}}var s={fill:"#000000",left:0,top:0},f={fill:"#000000",fontStyle:"normal",fontWeight:"normal",textAlign:"tie-text-align-left",underline:!1},o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,r.default),o(d,[{key:"start",value:function(){var t=this,e=this.getCanvas();e.selection=!1,e.defaultCursor="text",e.on({"mouse:down":this._listeners.mousedown,"selection:created":this._listeners.select,"selection:updated":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._listeners.scaling,"text:changed":this._listeners.textChanged}),e.forEachObject(function(e){"i-text"===e.type&&t.adjustOriginPosition(e,"start")}),this.setCanvasRatio()}},{key:"end",value:function(){var t=this,n=this.getCanvas();n.selection=!0,n.defaultCursor="default",n.forEachObject(function(e){"i-text"===e.type&&(""===e.text?n.remove(e):t.adjustOriginPosition(e,"end"))}),n.off({"mouse:down":this._listeners.mousedown,"selection:created":this._listeners.select,"selection:updated":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:selected":this._listeners.select,"object:scaling":this._listeners.scaling,"text:changed":this._listeners.textChanged})}},{key:"adjustOriginPosition",value:function(e,t){var n="center",o="center";"start"===t&&(n="left",o="top");var i=e.getPointByOrigin(n,o),t=i.x,i=i.y;e.set({left:t,top:i,originX:n,originY:o}),e.setCoords()}},{key:"add",value:function(r,a){var s=this;return new l.Promise(function(e){var t=s.getCanvas(),n=null,o=h.fObjectOptions.SELECTION_STYLE,i=s._defaultStyles;s._setInitPos(a.position),a.styles&&(i=c.default.extend(i,a.styles)),c.default.isExisty(a.autofocus)||(a.autofocus=!0),n=new u.default.IText(r,i),o=c.default.extend({},o,{originX:"left",originY:"top"}),n.set(o),n.on({mouseup:s._onFabricMouseUp.bind(s)}),t.add(n),a.autofocus&&(n.enterEditing(),n.selectAll()),t.getActiveObject()||t.setActiveObject(n),s.isPrevEditing=!0,e(s.graphics.createObjectProperties(n))})}},{key:"change",value:function(t,n){var o=this;return new l.Promise(function(e){t.set("text",n),o.getCanvas().renderAll(),e()})}},{key:"setStyle",value:function(n,o){var t=this;return new l.Promise(function(e){c.default.forEach(o,function(e,t){n[t]===e&&"fontSize"!==t&&(o[t]=f[t]||"")},t),"textDecoration"in o&&c.default.extend(o,t._getTextDecorationAdaptObject(o.textDecoration)),n.set(o),t.getCanvas().renderAll(),e()})}},{key:"getText",value:function(e){return e.text}},{key:"setSelectedInfo",value:function(e,t){this._selectedObj=e,this._isSelected=t}},{key:"isSelected",value:function(){return this._isSelected}},{key:"getSelectedObj",value:function(){return this._selectedObj}},{key:"setCanvasRatio",value:function(){var e=this.getCanvasElement(),t=parseInt(e.style.maxWidth,10),e=e.width;this._ratio=e/t}},{key:"getCanvasRatio",value:function(){return this._ratio}},{key:"_getTextDecorationAdaptObject",value:function(e){return{underline:"underline"===e,linethrough:"line-through"===e,overline:"overline"===e}}},{key:"_setInitPos",value:function(e){e=e||this.getCanvasImage().getCenterPoint(),this._defaultStyles.left=e.x,this._defaultStyles.top=e.y}},{key:"_onInput",value:function(){var e=this.getCanvasRatio(),t=this._editingObj,n=this._textarea.style;n.width=Math.ceil(t.width/e)+"px",n.height=Math.ceil(t.height/e)+"px"}},{key:"_onKeyDown",value:function(){var e=this,t=this.getCanvasRatio(),n=this._editingObj,o=this._textarea.style;setTimeout(function(){n.text(e._textarea.value),o.width=Math.ceil(n.width/t)+"px",o.height=Math.ceil(n.height/t)+"px"},0)}},{key:"_onBlur",value:function(){var e=this.getCanvasRatio(),t=this._editingObj,n=this._editingObjInfos,o=this._textarea.value,i=t.width/e-n.width/e,r=t.height/e-n.height/e;1===e&&(i/=2,r/=2),this._textarea.style.display="none",t.set({left:n.left+i,top:n.top+r}),o.length&&(this.getCanvas().add(t),o={id:c.default.stamp(t),type:t.type,text:o},this.fire(h.eventNames.TEXT_CHANGED,o))}},{key:"_onScroll",value:function(){this._textarea.scrollLeft=0,this._textarea.scrollTop=0}},{key:"_onFabricScaling",value:function(e){e=e.target;e.fontSize=e.fontSize*e.scaleY,e.scaleX=1,e.scaleY=1}},{key:"_onFabricTextChanged",value:function(e){this.fire(h.eventNames.TEXT_CHANGED,e.target)}},{key:"_onFabricSelectClear",value:function(e){var t=this.getSelectedObj();this.isPrevEditing=!0,this.setSelectedInfo(e.target,!1),t&&""===t.text&&this.getCanvas().remove(t)}},{key:"_onFabricSelect",value:function(e){this.isPrevEditing=!0,this.setSelectedInfo(e.target,!0)}},{key:"_onFabricMouseDown",value:function(e){var t=e.target;t&&!t.isType("text")||(this.isPrevEditing?this.isPrevEditing=!1:this._fireAddText(e))}},{key:"_fireAddText",value:function(e){var t=e.target,n=e.e||{},e=this.getCanvas().getPointer(n);t||this.fire(h.eventNames.ADD_TEXT,{originPosition:{x:e.x,y:e.y},clientPosition:{x:n.clientX||0,y:n.clientY||0}})}},{key:"_onFabricMouseUp",value:function(e){var t=e.target,e=(new Date).getTime();this._isDoubleClick(e)&&!t.isEditing&&t.enterEditing(),t.isEditing&&this.fire(h.eventNames.TEXT_EDITING),this._lastClickTime=e}},{key:"_isDoubleClick",value:function(e){return e-this._lastClickTime<500}}]),d);function d(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,h.componentNames.TEXT,e));return e._defaultStyles=s,e._isSelected=!1,e._selectedObj={},e._editingObj={},e._listeners={mousedown:e._onFabricMouseDown.bind(e),select:e._onFabricSelect.bind(e),selectClear:e._onFabricSelectClear.bind(e),scaling:e._onFabricScaling.bind(e),textChanged:e._onFabricTextChanged.bind(e)},e._textarea=null,e._ratio=1,e._lastClickTime=(new Date).getTime(),e._editingObjInfos={},e.isPrevEditing=!1,e}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=s(n(3)),r=s(n(4)),a=s(n(7)),u=n(1),l=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var h={arrow:"M 0 90 H 105 V 120 L 160 60 L 105 0 V 30 H 0 Z",cancel:"M 0 30 L 30 60 L 0 90 L 30 120 L 60 90 L 90 120 L 120 90 L 90 60 L 120 30 L 90 0 L 60 30 L 30 0 Z"},o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,a.default),o(f,[{key:"setStates",value:function(e,t){this._type=e,this._iconColor=t}},{key:"start",value:function(){var e=this.getCanvas();e.selection=!1,e.on("mouse:down",this._handlers.mousedown)}},{key:"end",value:function(){var e=this.getCanvas();e.selection=!0,e.off({"mouse:down":this._handlers.mousedown})}},{key:"add",value:function(r,a){var s=this;return new u.Promise(function(e,t){var n=s.getCanvas(),o=s._pathMap[r],i=l.fObjectOptions.SELECTION_STYLE,o=o?s._createIcon(o):null;(s._icon=o)||t(l.rejectMessages.invalidParameters),o.set(c.default.extend({type:"icon",fill:s._oColor},i,a,s.graphics.controlStyle)),n.add(o).setActiveObject(o),e(s.graphics.createObjectProperties(o))})}},{key:"registerPaths",value:function(e){var n=this;c.default.forEach(e,function(e,t){n._pathMap[t]=e},this)}},{key:"setColor",value:function(e,t){this._oColor=e,t&&"icon"===t.get("type")&&(t.set({fill:this._oColor}),this.getCanvas().renderAll())}},{key:"getColor",value:function(e){return e.fill}},{key:"_createIcon",value:function(e){return new r.default.Path(e)}},{key:"_onFabricMouseDown",value:function(e){var t=this,n=this.getCanvas();this._startPoint=n.getPointer(e.e);var o=this._startPoint,e=o.x,o=o.y;this.add(this._type,{left:e,top:o,fill:this._iconColor}).then(function(){t.fire(l.eventNames.ADD_OBJECT,t.graphics.createObjectProperties(t._icon)),n.on("mouse:move",t._handlers.mousemove),n.on("mouse:up",t._handlers.mouseup)})}},{key:"_onFabricMouseMove",value:function(e){var t,n=this.getCanvas();this._icon&&(e=((t=n.getPointer(e.e)).x-this._startPoint.x)/this._icon.width,t=(t.y-this._startPoint.y)/this._icon.height,this._icon.set({scaleX:Math.abs(2*e),scaleY:Math.abs(2*t)}),this._icon.setCoords(),n.renderAll())}},{key:"_onFabricMouseUp",value:function(){var e=this.getCanvas();this.fire(l.eventNames.OBJECT_ADDED,this.graphics.createObjectProperties(this._icon)),this._icon=null,e.off("mouse:down",this._handlers.mousedown),e.off("mouse:move",this._handlers.mousemove),e.off("mouse:up",this._handlers.mouseup)}}]),f);function f(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,l.componentNames.ICON,e));return e._oColor="#000000",e._pathMap=h,e._type=null,e._iconColor=null,e._handlers={mousedown:e._onFabricMouseDown.bind(e),mousemove:e._onFabricMouseMove.bind(e),mouseup:e._onFabricMouseUp.bind(e)},e}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=n(3),a=p(n(4)),s=p(n(7)),c=n(1),u=n(0),l=p(n(131)),h=p(n(132)),f=p(n(133)),d=p(n(134));function p(e){return e&&e.__esModule?e:{default:e}}n=a.default.Image.filters;n.Mask=l.default,n.Sharpen=h.default,n.Emboss=f.default,n.ColorFilter=d.default;(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(v,s.default),o(v,[{key:"add",value:function(r,a){var s=this;return new c.Promise(function(e,t){var n=s._getSourceImage(),o=s.getCanvas(),i=s._getFilter(n,r);(i=i||s._createFilter(n,r,a))||t(u.rejectMessages.invalidParameters),s._changeFilterValues(i,a),s._apply(n,function(){o.renderAll(),e({type:r,action:"add",options:a})})})}},{key:"remove",value:function(r){var a=this;return new c.Promise(function(e,t){var n=a._getSourceImage(),o=a.getCanvas(),i=a.getOptions(r);n.filters.length||t(u.rejectMessages.unsupportedOperation),a._removeFilter(n,r),a._apply(n,function(){o.renderAll(),e({type:r,action:"remove",options:i})})})}},{key:"hasFilter",value:function(e){return!!this._getFilter(this._getSourceImage(),e)}},{key:"getOptions",value:function(e){var t=this._getSourceImage(),e=this._getFilter(t,e);return e?(0,r.extend)({},e.options):null}},{key:"_changeFilterValues",value:function(n,o){(0,r.forEach)(o,function(e,t){(0,r.isUndefined)(n[t])||(n[t]=e)}),(0,r.forEach)(n.options,function(e,t){(0,r.isUndefined)(o[t])||(n.options[t]=o[t])})}},{key:"_apply",value:function(e,t){e.filters.push(),e.applyFilters()&&t()}},{key:"_getSourceImage",value:function(){return this.getCanvasImage()}},{key:"_createFilter",value:function(e,t,n){var o=void 0,t=this._getFabricFilterType(t),t=a.default.Image.filters[t];return t&&((o=new t(n)).options=n,e.filters.push(o)),o}},{key:"_getFilter",value:function(e,t){var n=null;if(e)for(var o,i=this._getFabricFilterType(t),r=e.filters.length,a=void 0,a=0;a<r;a+=1)if((o=e.filters[a]).type===i){n=o;break}return n}},{key:"_removeFilter",value:function(e,t){var n=this._getFabricFilterType(t);e.filters=(0,r.filter)(e.filters,function(e){return e.type!==n})}},{key:"_getFabricFilterType",value:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}]),o=v;function v(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,u.componentNames.FILTER,e))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),r=(o=i)&&o.__esModule?o:{default:o};n=r.default.util.createClass(r.default.Image.filters.BlendImage,{applyTo:function(e){var t,n,o,i,r,a;this.mask&&(n=(t=e.canvasEl).width,o=t.height,a=this._createCanvasOfMask(n,o),i=t.getContext("2d"),r=a.getContext("2d"),a=i.getImageData(0,0,n,o),this._drawMask(r,t,i),this._mapData(r,a,n,o),e.imageData=a)},_createCanvasOfMask:function(e,t){var n=r.default.util.createCanvasElement();return n.width=e,n.height=t,n},_drawMask:function(e){var t=this.mask,n=t.getElement(),o=t.angle,i=t.left,r=t.scaleX,a=t.scaleY,t=t.top;e.save(),e.translate(i,t),e.rotate(o*Math.PI/180),e.scale(r,a),e.drawImage(n,-n.width/2,-n.height/2),e.restore()},_mapData:function(e,t,n,o){for(var i=t.data,r=t.height,a=i,s=t.width*r*4,c=e.getImageData(0,0,n,o).data,u=0;u<s;u+=4)a[u+3]=c[u]}});t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),n=(o=i)&&o.__esModule?o:{default:o};n=n.default.util.createClass(n.default.Image.filters.Convolute,{type:"Sharpen",initialize:function(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0]}});t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),n=(o=i)&&o.__esModule?o:{default:o};n=n.default.util.createClass(n.default.Image.filters.Convolute,{type:"Emboss",initialize:function(){this.matrix=[1,1,1,1,.7,-1,-1,-1,-1]}});t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),s=(o=i)&&o.__esModule?o:{default:o};n=s.default.util.createClass(s.default.Image.filters.BaseFilter,{type:"ColorFilter",initialize:function(e){this.color=(e=e||{}).color||"#FFFFFF",this.threshold=e.threshold||45,this.x=e.x||null,this.y=e.y||null},applyTo:function(e){var t,n=e.canvasEl,e=n.getContext("2d"),n=e.getImageData(0,0,n.width,n.height),o=n.data,i=this.threshold,r=s.default.Color.sourceFromHex(this.color),a=void 0;for(this.x&&this.y&&(r=this._getColor(n,this.x,this.y)),a=0,t=o.length;a<t;a+=4)this._isOutsideThreshold(o[a],r[0],i)||this._isOutsideThreshold(o[a+1],r[1],i)||this._isOutsideThreshold(o[a+2],r[2],i)||(o[a]=o[a+1]=o[a+2]=o[a+3]=0);e.putImageData(n,0,0)},_isOutsideThreshold:function(e,t,n){return Math.abs(e-t)>n},_getColor:function(e,t,n){var o=[0,0,0,0],i=e.data,t=4*(e.width*n+t);return o[0]=i[t],o[1]=i[1+t],o[2]=i[2+t],o[3]=i[3+t],o}});t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=n(3),r=f(n(4)),a=f(n(7)),c=f(n(70)),u=n(136),l=n(1),h=n(0);function f(e){return e&&e.__esModule?e:{default:e}}var d=(0,s.extend)({strokeWidth:1,stroke:"#000000",fill:"#ffffff",width:1,height:1,rx:0,ry:0},h.SHAPE_DEFAULT_OPTIONS),p="rect";function v(e,t,n){var o=e.fill,i=(0,l.getFillTypeFromOption)(e.fill),r=o;o.color&&(r=o.color);var a=null;return a="filter"===i?(n=n(),(0,u.makeFillPatternForFilter)(t,o.filter,n)):{fill:r},(0,s.extend)({},e,a)}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(g,a.default),o(g,[{key:"start",value:function(){var e=this.getCanvas();this._isSelected=!1,e.defaultCursor="crosshair",e.selection=!1,e.uniformScaling=!0,e.on({"mouse:down":this._handlers.mousedown}),r.default.util.addListener(document,"keydown",this._handlers.keydown),r.default.util.addListener(document,"keyup",this._handlers.keyup)}},{key:"end",value:function(){var e=this.getCanvas();this._isSelected=!1,e.defaultCursor="default",e.selection=!0,e.uniformScaling=!1,e.off({"mouse:down":this._handlers.mousedown}),r.default.util.removeListener(document,"keydown",this._handlers.keydown),r.default.util.removeListener(document,"keyup",this._handlers.keyup)}},{key:"setStates",value:function(e,t){this._type=e,t&&(this._options=(0,s.extend)(this._options,t))}},{key:"add",value:function(i,r){var a=this;return new l.Promise(function(e){var t=a.getCanvas(),n=a._extendOptions(r),o=a._createInstance(i,n),n=a.graphics.createObjectProperties(o);a._bindEventOnShape(o),t.add(o).setActiveObject(o),a._resetPositionFillFilter(o),e(n)})}},{key:"change",value:function(i,r){var a=this;return new l.Promise(function(e,t){(0,l.isShape)(i)||t(h.rejectMessages.unsupportedType);var n="filter"===(0,l.getFillTypeFromOption)(r.fill),o=a.graphics,t=o.canvasImage,o=o.createStaticCanvas;i.set(n?v(r,t,o):r),n&&a._resetPositionFillFilter(i),a.getCanvas().renderAll(),e()})}},{key:"makeFillPropertyForUserEvent",value:function(e){var t,n=(0,l.getFillTypeFromObject)(e),o={};return n===h.SHAPE_FILL_TYPE.FILTER?(t=(0,u.getFillImageFromShape)(e),t=(0,u.makeFilterOptionFromFabricImage)(t),o.type=n,o.filter=t):(o.type=h.SHAPE_FILL_TYPE.COLOR,o.color=e.fill||"transparent"),o}},{key:"processForCopiedObject",value:function(e,t){var n;this._bindEventOnShape(e),"filter"===(0,l.getFillTypeFromObject)(e)&&(n=(0,u.getFillImageFromShape)(t),t=(0,u.makeFilterOptionFromFabricImage)(n),n=this.graphics.createStaticCanvas(),e.set((0,u.makeFillPatternForFilter)(this.graphics.canvasImage,t,n)),this._resetPositionFillFilter(e))}},{key:"_createInstance",value:function(e,t){var n=void 0;switch(e){case"rect":n=new r.default.Rect(t);break;case"circle":n=new r.default.Ellipse((0,s.extend)({type:"circle"},t));break;case"triangle":n=new r.default.Triangle(t);break;default:n={}}return n}},{key:"_extendOptions",value:function(e){var t=h.fObjectOptions.SELECTION_STYLE,n=this.graphics,o=n.canvasImage,n=n.createStaticCanvas;return v(e=(0,s.extend)({},d,this._options,t,e),o,n)}},{key:"_bindEventOnShape",value:function(t){var n=this,o=this.getCanvas();t.on({added:function(){n._shapeObj=this,c.default.setOrigins(n._shapeObj)},selected:function(){n._isSelected=!0,n._shapeObj=this,o.uniformScaling=!0,o.defaultCursor="default",c.default.setOrigins(n._shapeObj)},deselected:function(){n._isSelected=!1,n._shapeObj=null,o.defaultCursor="crosshair",o.uniformScaling=!1},modified:function(){var e=n._shapeObj;c.default.adjustOriginToCenter(e),c.default.setOrigins(e)},modifiedInGroup:function(e){n._fillFilterRePositionInGroupSelection(t,e)},moving:function(){n._resetPositionFillFilter(this)},rotating:function(){n._resetPositionFillFilter(this)},scaling:function(e){var t=o.getPointer(e.e),e=n._shapeObj;o.setCursor("crosshair"),c.default.resize(e,t,!0),n._resetPositionFillFilter(this)}})}},{key:"_onFabricMouseDown",value:function(e){var t;e.target||(this._isSelected=!1,this._shapeObj=!1),this._isSelected||this._shapeObj||(t=this.getCanvas(),this._startPoint=t.getPointer(e.e),t.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup}))}},{key:"_onFabricMouseMove",value:function(e){var t=this,n=this.getCanvas(),o=n.getPointer(e.e),i=this._startPoint.x,r=this._startPoint.y,a=i-o.x,s=r-o.y,e=this._shapeObj;e?(this._shapeObj.set({isRegular:this._withShiftKey}),c.default.resize(e,o),n.renderAll(),this._resetPositionFillFilter(e)):this.add(this._type,{left:i,top:r,width:a,height:s}).then(function(e){t.fire(h.eventNames.ADD_OBJECT,e)})}},{key:"_onFabricMouseUp",value:function(){var t=this,e=this.getCanvas(),n=this._startPoint.x,o=this._startPoint.y,i=this._shapeObj;i?i&&(c.default.adjustOriginToCenter(i),this.fire(h.eventNames.OBJECT_ADDED,this.graphics.createObjectProperties(i))):this.add(this._type,{left:n,top:o,width:20,height:20}).then(function(e){t.fire(h.eventNames.ADD_OBJECT,e)}),e.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}},{key:"_onKeyDown",value:function(e){e.keyCode===h.keyCodes.SHIFT&&(this._withShiftKey=!0,this._shapeObj&&(this._shapeObj.isRegular=!0))}},{key:"_onKeyUp",value:function(e){e.keyCode===h.keyCodes.SHIFT&&(this._withShiftKey=!1,this._shapeObj&&(this._shapeObj.isRegular=!1))}},{key:"_resetPositionFillFilter",value:function(e){var t,n,o;"filter"===(0,l.getFillTypeFromObject)(e)&&(t=(0,l.getCustomProperty)(e,"patternSourceCanvas").patternSourceCanvas,n=(0,u.getFillImageFromShape)(e),o=(0,l.getCustomProperty)(n,"originalAngle").originalAngle,this.graphics.canvasImage.angle!==o&&(0,u.reMakePatternImageSource)(e,this.graphics.canvasImage),n=e.originX,o=e.originY,c.default.adjustOriginToCenter(e),e.width*=e.scaleX,e.height*=e.scaleY,e.rx*=e.scaleX,e.ry*=e.scaleY,e.scaleX=1,e.scaleY=1,(0,u.rePositionFilterTypeFillImage)(e),(0,l.changeOrigin)(e,{originX:n,originY:o}),(0,u.resetFillPatternCanvas)(t))}},{key:"_fillFilterRePositionInGroupSelection",value:function(e,t){1===t.scaleX&&1===t.scaleY||t.addWithUpdate();var n=e.angle,o=e.left,i=e.top;r.default.util.addTransformToObject(e,t.calcTransformMatrix()),this._resetPositionFillFilter(e),e.set({angle:n,left:o,top:i})}}]),o=g;function g(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,h.componentNames.SHAPE,e));return e._shapeObj=null,e._type=p,e._options=(0,s.extend)({},d),e._isSelected=!1,e._startPoint={},e._withShiftKey=!1,e._handlers={mousedown:e._onFabricMouseDown.bind(e),mousemove:e._onFabricMouseMove.bind(e),mouseup:e._onFabricMouseUp.bind(e),keydown:e._onKeyDown.bind(e),keyup:e._onKeyUp.bind(e)},e}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFillImageFromShape=_,t.rePositionFilterTypeFillImage=function(e){var t=e.angle,n=e.flipX,o=e.flipY,i=_(e),r=function(e){var t=b(e),n=t[0],o=n.x,i=n.y,r=t[1],a=r.x,s=r.y,c=t[2],u=c.x,e=c.y,n=t[3],r=n.x,c=n.y,t=Math.min(o,a,u,r),n=Math.min(i,s,e,c),r=Math.max(o,a,u,r),c=Math.max(i,s,e,c);return{left:t,top:n,right:r,bottom:c,width:r-t,height:c-n}}(e),a=r.right,s=r.bottom,c=r.width,u=r.height,l=(c-e.width)/2,h=(u-e.height)/2,f=e.left-e.width/2-l,d=e.top-e.height/2-h,p=c/2-l,r=u/2-h,h=Math.max(c,u)+Math.max(l,h),s=function(e){function t(e,t,n,o){return r=(i={type:e,outDistance:t,shapeObj:c,flipX:u,flipY:l,left:n,top:o}).type,a=i.shapeObj,s=i.outDistance,e=i.left,t=i.top,n=i.flipX,o=i.flipY,i=b(a),a=function(n,e,t){var o=0,i=0;(0,g.forEach)(e,function(e,t){e[n]<o&&(o=e[n],i=t)});e=t[i],t=e[0],e=e[1];return{startPointIndex:i,endPointIndex1:t,endPointIndex2:e}}(r,i,[[1,2],[0,3],[0,3],[1,2]]),i=function(e,o,t){var i=t.startPointIndex,n=t.endPointIndex1,t=t.endPointIndex2,r="x"===e?180:270;return(0,g.map)([n,t],function(e){var t=o[i],n=o[e],e=t.y-n.y,n=t.x-n.x;return 180*Math.atan2(e,n)/Math.PI-r})}(r,i,a),a=a.startPointIndex,i=function(e){var t=e.outDistance,n=e.startPointIndex,o=e.flipX,i=e.flipY,r=e.reatAngles,e=t*Math.cos(r[0]*Math.PI/180),t=t*Math.cos(r[1]*Math.PI/180),r=2===n||3===n,e={top:r?e:t,left:r?t:e};!function(e,t,n){return(!t&&n||!t&&!n)&&0===e||(t&&n||t&&!n)&&1===e||(!t&&!n||!t&&n)&&2===e||(t&&!n||t&&n)&&3===e}(n,o,i)||(e.left=-1*e.left);!function(e,t,n){return(t&&!n||!t&&!n)&&0===e||(!t&&!n||t&&!n)&&1===e||(t&&n||!t&&n)&&2===e||(!t&&n||t&&n)&&3===e}(n,o,i)||(e.top=-1*e.top);return e}({outDistance:s,startPointIndex:a,flipX:n,flipY:o,reatAngles:i}),[e+i.left,t+i.top];var i,r,a,s}var c=e.shapeObj,n=e.left,o=e.top,i=e.width,r=e.height,a=e.cropX,s=e.cropY,u=e.flipX,l=e.flipY,h=e.right,f=e.bottom,d=i,p=r,e=function(i,e){var r=e.left,a=e.top,t=e.width,n=e.height,s=e.cropX,c=e.cropY,u={width:t,height:n};return(0,g.forEach)(["x","y"],function(e){var t="x"===e?s:c,n=u[m[e]],o=y[m[e]];o<n&&(n=(n-o)/2,u[m[e]]=o,n=i(e,n,r,a),r=n[0],a=n[1]),t<0&&(t=i(e,t,r,a),r=t[0],a=t[1])}),[r,a,u.width,u.height]}(t,{left:n,top:o,width:i,height:r,cropX:a,cropY:s});n=e[0],o=e[1],i=e[2],r=e[3];p=function(n,e){var o=e.left,i=e.top,t=e.insideCanvasRealImageWidth,r=e.insideCanvasRealImageHeight,a=e.right,s=e.bottom,c=e.cropX,u=e.cropY,l=e.originalWidth,h=e.originalHeight,f=t,d=r,p=y.width,e=y.height;p<a&&0<c&&(f=l-Math.abs(a-p));e<s&&0<u&&(d=h-Math.abs(s-e));var v={x:(t-f)/2,y:(r-d)/2};return(0,g.forEach)(["x","y"],function(e){var t=v[e];0<t&&(t=n(e,t,o,i),o=t[0],i=t[1])}),[o,i,f,d]}(t,{left:n,top:o,insideCanvasRealImageWidth:i,insideCanvasRealImageHeight:r,right:h,bottom:f,cropX:a,cropY:s,originalWidth:d,originalHeight:p});return n=p[0],o=p[1],i=p[2],r=p[3],[n,o,i,r]}({shapeObj:e,left:p,top:r,width:c,height:u,cropX:f,cropY:d,flipX:n,flipY:o,right:a,bottom:s});p=s[0],r=s[1],c=s[2],u=s[3],i.set({angle:n===o?-t:t,left:p,top:r,width:c,height:u,cropX:f,cropY:d,flipX:n,flipY:o}),(0,v.setCustomProperty)(i,{fillImageMaxSize:h})},t.makeFilterOptionFromFabricImage=u,t.makeFillPatternForFilter=function(e,t,n){t=h(l(e),e.angle,t);n.add(t);t={fill:new fabric.Pattern({source:n.getElement(),repeat:"no-repeat"})};return(0,v.setCustomProperty)(t,{patternSourceCanvas:n}),t},t.resetFillPatternCanvas=function(e){var t=e.getObjects()[0],t=(0,v.getCustomProperty)(t,"fillImageMaxSize").fillImageMaxSize;t=Math.max(1,t),e.setDimensions({width:t,height:t}),e.renderAll()},t.reMakePatternImageSource=function(e,t){var n=(0,v.getCustomProperty)(e,"patternSourceCanvas").patternSourceCanvas,o=n.getObjects()[0],e=u(o);n.remove(o);e=h(l(t,!0),t.angle,e);n.add(e)},t.getCachedCanvasImageElement=l;var o,g=n(3),i=n(70),r=(o=i)&&o.__esModule?o:{default:o},v=n(1);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s={pixelate:"blocksize",blur:"blur"},m={x:"width",y:"height"},c=(0,v.flipObject)(s),y=null;function _(e){return(0,v.getCustomProperty)(e,"patternSourceCanvas").patternSourceCanvas.getObjects()[0]}function u(e){return(0,g.map)(e.filters,function(e){var t=Object.keys(e)[0];return a({},c[t],e[t])})}function l(e){return y=!y||1<arguments.length&&void 0!==arguments[1]&&arguments[1]?e.toCanvasElement():y}function b(e){return[e.getPointByOrigin("left","top"),e.getPointByOrigin("right","top"),e.getPointByOrigin("left","bottom"),e.getPointByOrigin("right","bottom")]}function h(e,t,n){var o=new fabric.Image(e);return(0,g.forEach)(g.extend.apply(void 0,[{}].concat(n)),function(e,t){var n=(0,v.capitalizeString)(t),e=new fabric.Image.filters[n](a({},s[t],e));o.filters.push(e)}),o.applyFilters(),(0,v.setCustomProperty)(o,{originalAngle:t,fillImageMaxSize:Math.max(o.width,o.height)}),r.default.adjustOriginToCenter(o),o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=c(n(4)),a=c(n(7)),u=n(1),s=n(0);function c(e){return e&&e.__esModule?e:{default:e}}var l={left:0,top:0,width:0,height:0,stroke:"#000000",strokeWidth:0,fill:"#000000",opacity:.4,evented:!1,selectable:!1,hoverCursor:"auto"},h=.0045,f=.003,d=.003,p=.0066,v=.0044,g=.003,m=1,y=s.eventNames.ZOOM_CHANGED,_=s.eventNames.ADD_TEXT,b=s.eventNames.TEXT_EDITING,O=s.eventNames.OBJECT_MODIFIED,E=s.eventNames.KEY_DOWN,C=s.eventNames.KEY_UP,w=s.eventNames.HAND_STARTED,k=s.eventNames.HAND_STOPPED,o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(M,a.default),o(M,[{key:"attachKeyboardZoomEvents",value:function(){r.default.util.addListener(document,E,this._listeners.keydown),r.default.util.addListener(document,C,this._listeners.keyup)}},{key:"detachKeyboardZoomEvents",value:function(){r.default.util.removeListener(document,E,this._listeners.keydown),r.default.util.removeListener(document,C,this._listeners.keyup)}},{key:"_startTextEditingHandler",value:function(){this.isTextEditing=!0}},{key:"_stopTextEditingHandler",value:function(){this.isTextEditing=!1}},{key:"_startHandModeWithSpaceBar",value:function(e){this.withSpace||this.isTextEditing||e.keyCode===s.keyCodes.SPACE&&(this.withSpace=!0,this.startHandMode())}},{key:"_endHandModeWithSpaceBar",value:function(e){e.keyCode===s.keyCodes.SPACE&&(this.withSpace=!1,this.endHandMode())}},{key:"startZoomInMode",value:function(){var e;this.zoomArea||(this.endHandMode(),this.zoomMode=s.zoomModes.ZOOM,e=this.getCanvas(),this._changeObjectsEventedState(!1),this.zoomArea=new r.default.Rect({left:0,top:0,width:.5,height:.5,stroke:"black",strokeWidth:1,fill:"transparent",hoverCursor:"zoom-in"}),e.discardActiveObject(),e.add(this.zoomArea),e.on("mouse:down",this._listeners.startZoom),e.selection=!1,e.defaultCursor="zoom-in")}},{key:"endZoomInMode",value:function(){this.zoomMode=s.zoomModes.DEFAULT;var e=this.getCanvas(),t=this._listeners,n=t.startZoom,o=t.moveZoom,t=t.stopZoom;e.selection=!0,e.defaultCursor="auto",e.off({"mouse:down":n,"mouse:move":o,"mouse:up":t}),this._changeObjectsEventedState(!0),e.remove(this.zoomArea),this.zoomArea=null}},{key:"start",value:function(){this.zoomArea=null,this._startPoint=null,this._startHandPoint=null}},{key:"end",value:function(){this.endZoomInMode(),this.endHandMode()}},{key:"startHandMode",value:function(){this.endZoomInMode(),this.zoomMode=s.zoomModes.HAND;var e=this.getCanvas();this._changeObjectsEventedState(!1),e.discardActiveObject(),e.off("mouse:down",this._listeners.startHand),e.on("mouse:down",this._listeners.startHand),e.selection=!1,e.defaultCursor="grab",e.fire(w)}},{key:"endHandMode",value:function(){this.zoomMode=s.zoomModes.DEFAULT;var e=this.getCanvas();this._changeObjectsEventedState(!0),e.off("mouse:down",this._listeners.startHand),e.selection=!0,e.defaultCursor="auto",this._startHandPoint=null,e.fire(k)}},{key:"_onMouseDownWithZoomMode",value:function(e){var t=e.target,n=e.e;t||((e=this.getCanvas()).selection=!1,this._startPoint=e.getPointer(n),this.zoomArea.set({width:0,height:0}),n=(t=this._listeners).moveZoom,t=t.stopZoom,e.on({"mouse:move":n,"mouse:up":t}))}},{key:"_onMouseMoveWithZoomMode",value:function(e){var t=e.e,n=this.getCanvas(),o=n.getPointer(t),i=o.x,e=o.y,t=this.zoomArea,o=this._startPoint;10<Math.abs(i-o.x)+Math.abs(e-o.y)&&(n.remove(t),t.set(this._calcRectDimensionFromPoint(i,e)),n.add(t))}},{key:"_calcRectDimensionFromPoint",value:function(e,t){var n=this.getCanvas(),o=n.getWidth(),i=n.getHeight(),r=this._startPoint,a=r.x,s=r.y,n=Math.min,r=n(a,e),n=n(s,t);return{left:r,top:n,width:(0,u.clamp)(e,a,o)-r,height:(0,u.clamp)(t,s,i)-n}}},{key:"_onMouseUpWithZoomMode",value:function(){var e=this.zoomLevel,t=this.zoomArea,n=this._listeners,o=n.moveZoom,i=n.stopZoom,r=this.getCanvas(),a=this._getCenterPoint(),n=a.x,a=a.y;this._isMaxZoomLevel()||(this._centerPoints.push({x:n,y:a,prevZoomLevel:e,zoomLevel:e+1}),r.zoomToPoint({x:n,y:a},e+=1),this._fireZoomChanged(r,e),this.zoomLevel=e),r.off({"mouse:move":o,"mouse:up":i}),r.remove(t),this._startPoint=null}},{key:"_getCenterPoint",value:function(){var e=this.zoomArea,t=e.left,n=e.top,o=e.width,i=e.height,r=this._startPoint,a=r.x,e=r.y,r=this.aspectRatio;return o<10&&i<10?{x:a,y:e}:i<o?{x:t+r*i/2,y:n+i/2}:{x:t+o/2,y:n+o/r/2}}},{key:"zoom",value:function(e){for(var t=e.x,e=e.y,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.zoomLevel,o=this.getCanvas(),i=this._centerPoints,r=i.length-1;0<=r&&!(i[r].zoomLevel<n);--r){var a=i.pop(),s=a.x,c=a.y,a=a.prevZoomLevel;o.zoomToPoint({x:s,y:c},a),this.zoomLevel=a}o.zoomToPoint({x:t,y:e},n),this._isDefaultZoomLevel(n)||this._centerPoints.push({x:t,y:e,zoomLevel:n,prevZoomLevel:this.zoomLevel}),this.zoomLevel=n,this._fireZoomChanged(o,n)}},{key:"zoomOut",value:function(){var e,t,n,o=this._centerPoints;o.length&&(e=this.getCanvas(),t=(n=o.pop()).x,o=n.y,n=n.prevZoomLevel,this._isDefaultZoomLevel(n)?e.setViewportTransform([1,0,0,1,0,0]):e.zoomToPoint({x:t,y:o},n),this.zoomLevel=n,this._fireZoomChanged(e,this.zoomLevel))}},{key:"resetZoom",value:function(){var e=this.getCanvas();e.setViewportTransform([1,0,0,1,0,0]),this.zoomLevel=m,this._centerPoints=[],this._fireZoomChanged(e,this.zoomLevel)}},{key:"_isMaxZoomLevel",value:function(){return 5<=this.zoomLevel}},{key:"_movePointOfZoom",value:function(e){var t,n,o,i,r=e.x,a=e.y,s=this._centerPoints;s.length&&(t=this.getCanvas(),n=this.zoomLevel,o=(i=s.pop()).x,e=i.y,i=i.prevZoomLevel,r=o-r,a=e-a,t.zoomToPoint({x:o,y:e},i),t.zoomToPoint({x:r,y:a},n),s.push({x:r,y:a,prevZoomLevel:i,zoomLevel:n}),this._fireZoomChanged(t,n))}},{key:"_onMouseDownWithHandMode",value:function(e){var t=e.target,n=e.e;t||(e=this.getCanvas(),this.zoomLevel<=m||(e.selection=!1,this._startHandPoint=e.getPointer(n),n=(t=this._listeners).moveHand,t=t.stopHand,e.on({"mouse:move":n,"mouse:up":t})))}},{key:"_onMouseMoveWithHandMode",value:function(e){var t=e.e,e=this.getCanvas().getPointer(t),t=e.x,e=e.y,t=t-this._startHandPoint.x,e=e-this._startHandPoint.y;this._movePointOfZoom({x:t,y:e})}},{key:"_onMouseUpWithHandMode",value:function(){var e=this.getCanvas(),t=this._listeners,n=t.moveHand,t=t.stopHand;e.off({"mouse:move":n,"mouse:up":t}),this._startHandPoint=null}},{key:"_changeScrollState",value:function(e){var t,n,o,i,r,a=e.viewport,s=e.zoomLevel,c=this.getCanvas();c.remove(this._verticalScroll),c.remove(this._horizontalScroll),this._isDefaultZoomLevel(s)||(i=c.width,r=c.height,t=a.tl,n=a.tr,o=a.bl,e=n.x-t.x,c=(s=o.y-t.y)*p,i=(0,u.clamp)(t.x+t.x/i*e,t.x,n.x-(a=e*e/i)),this._horizontalScroll.set({left:i,top:o.y-c-s*v,width:a,height:c,rx:c=s*g,ry:c}),c=e*h,r=(0,u.clamp)(t.y+t.y/r*s,n.y,o.y-(s=s*s/r)),this._verticalScroll.set({left:n.x-c-e*f,top:r,width:c,height:s,rx:e=e*d,ry:e}),this._addScrollBar())}},{key:"_changeObjectsEventedState",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.getCanvas().forEachObject(function(e){e.evented=t})}},{key:"_addScrollBar",value:function(){var e=this,t=this.getCanvas();t.add(this._horizontalScroll),t.add(this._verticalScroll),this.scrollBarTid&&clearTimeout(this.scrollBarTid),this.scrollBarTid=setTimeout(function(){t.remove(e._horizontalScroll),t.remove(e._verticalScroll)},3e3)}},{key:"_isDefaultZoomLevel",value:function(e){return e===m}},{key:"_fireZoomChanged",value:function(e,t){e.fire(y,{viewport:e.calcViewportBoundaries(),zoomLevel:t})}},{key:"mode",get:function(){return this.zoomMode}}]),M);function M(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,M);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,s.componentNames.ZOOM,e));t.zoomArea=null,t._startPoint=null,t._centerPoints=[],t.zoomLevel=m,t.zoomMode=s.zoomModes.DEFAULT,t._listeners={startZoom:t._onMouseDownWithZoomMode.bind(t),moveZoom:t._onMouseMoveWithZoomMode.bind(t),stopZoom:t._onMouseUpWithZoomMode.bind(t),startHand:t._onMouseDownWithHandMode.bind(t),moveHand:t._onMouseMoveWithHandMode.bind(t),stopHand:t._onMouseUpWithHandMode.bind(t),zoomChanged:t._changeScrollState.bind(t),keydown:t._startHandModeWithSpaceBar.bind(t),keyup:t._endHandModeWithSpaceBar.bind(t)};e=t.getCanvas();return t.aspectRatio=e.width/e.height,t._verticalScroll=new r.default.Rect(l),t._horizontalScroll=new r.default.Rect(l),e.on(y,t._listeners.zoomChanged),t.graphics.on(_,t._startTextEditingHandler.bind(t)),t.graphics.on(b,t._startTextEditingHandler.bind(t)),t.graphics.on(O,t._stopTextEditingHandler.bind(t)),t}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(12),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(u,s.default),o(u,[{key:"start",value:function(e){e.getComponent(c.componentNames.CROPPER).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.CROPPER).end()}}]),o=u;function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,c.drawingModes.CROPPER))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(12),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(u,s.default),o(u,[{key:"start",value:function(e,t){e.getComponent(c.componentNames.FREE_DRAWING).start(t)}},{key:"end",value:function(e){e.getComponent(c.componentNames.FREE_DRAWING).end()}}]),o=u;function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,c.drawingModes.FREE_DRAWING))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(12),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(u,s.default),o(u,[{key:"start",value:function(e,t){e.getComponent(c.componentNames.LINE).start(t)}},{key:"end",value:function(e){e.getComponent(c.componentNames.LINE).end()}}]),o=u;function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,c.drawingModes.LINE_DRAWING))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(12),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(u,s.default),o(u,[{key:"start",value:function(e){e.getComponent(c.componentNames.SHAPE).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.SHAPE).end()}}]),o=u;function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,c.drawingModes.SHAPE))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(12),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(u,s.default),o(u,[{key:"start",value:function(e){e.getComponent(c.componentNames.TEXT).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.TEXT).end()}}]),o=u;function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,c.drawingModes.TEXT))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(12),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(u,s.default),o(u,[{key:"start",value:function(e){e.getComponent(c.componentNames.ICON).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.ICON).end()}}]),o=u;function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,c.drawingModes.ICON))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(12),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(u,s.default),o(u,[{key:"start",value:function(e){e.getComponent(c.componentNames.ZOOM).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.ZOOM).end()}}]),o=u;function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,c.drawingModes.ZOOM))}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,s=n(1),a=n(7),c=(r=a)&&r.__esModule?r:{default:r},u=n(0);(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(l,c.default),o(l,[{key:"getCurrentDimensions",value:function(){var e,t=this.getCanvasImage();return!this._dimensions&&t&&(e=t.width,t=t.height,this._dimensions={width:e,height:t}),this._dimensions}},{key:"getOriginalDimensions",value:function(){return this._originalDimensions}},{key:"setOriginalDimensions",value:function(e){this._originalDimensions=e}},{key:"resize",value:function(e){var t=this.getCanvasImage(),n=t.width,o=t.height,i=t.scaleX,r=t.scaleY,a=e.width,e=e.height,o={scaleX:a?a/n:i,scaleY:e?e/o:r};return i===o.scaleX&&r===o.scaleY||(t.set(o).setCoords(),this._dimensions={width:t.width*t.scaleX,height:t.height*t.scaleY}),this.adjustCanvasDimensionBase(),s.Promise.resolve()}},{key:"start",value:function(){var e=this.getCurrentDimensions();this.setOriginalDimensions(e)}},{key:"end",value:function(){}}]),o=l;function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,u.componentNames.RESIZE,e));return e._dimensions=null,e._originalDimensions=null,e}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(12),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(u,s.default),o(u,[{key:"start",value:function(e){e.getComponent(c.componentNames.RESIZE).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.RESIZE).end()}}]),o=u;function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,c.drawingModes.RESIZE))}t.default=o},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),n=n(0);var s=n.componentNames.ICON,n={name:n.commandNames.ADD_ICON,execute:function(t,e,n){var o=this;return t.getComponent(s).add(e,n).then(function(e){return o.undoData.object=t.getObject(e.id),e})},undo:function(e){return e.remove(this.undoData.object),a.Promise.resolve()}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1);n={name:n(0).commandNames.ADD_IMAGE_OBJECT,execute:function(t,e){var n=this;return t.addImageObject(e).then(function(e){return n.undoData.object=t.getObject(e.id),e})},undo:function(e){return e.remove(this.undoData.object),a.Promise.resolve()}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);n={name:s.commandNames.ADD_OBJECT,execute:function(n,o){return new a.Promise(function(e,t){n.contains(o)?t(s.rejectMessages.addedObject):(n.add(o),e(o))})},undo:function(n,o){return new a.Promise(function(e,t){n.contains(o)?(n.remove(o),e(o)):t(s.rejectMessages.noObject)})}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),n=n(0);var s=n.componentNames.SHAPE,n={name:n.commandNames.ADD_SHAPE,execute:function(n,e,t){var o=this;return n.getComponent(s).add(e,t).then(function(e){var t=e.id;return o.undoData.object=n.getObject(t),e})},undo:function(e){return e.remove(this.undoData.object),a.Promise.resolve()}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0),c=n(27);var u=s.componentNames.TEXT,n={name:s.commandNames.ADD_TEXT,execute:function(o,e,t){var i=this,n=o.getComponent(u);if(this.undoData.object){var r=this.undoData.object;return new a.Promise(function(e,t){o.contains(r)?t(s.rejectMessages.redo):(o.add(r),e(r))})}return n.add(e,t).then(function(e){var t=e.id,n=o.getObject(t);return i.undoData.object=n,(0,c.setCachedUndoDataForDimension)((0,c.makeSelectionUndoData)(n,function(){return(0,c.makeSelectionUndoDatum)(t,n,!1)})),e})},undo:function(e){return e.remove(this.undoData.object),a.Promise.resolve()}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(3)),o=i(n(2)),c=n(0);function i(e){return e&&e.__esModule?e:{default:e}}var u=c.componentNames.FILTER,l=null;n={name:c.commandNames.APPLY_FILTER,execute:function(e,t,n,o){var i,r=e.getComponent(u);if("mask"===t){var a=e.getObject(n.maskObjId);if(!a||!a.isType("image"))return Promise.reject(c.rejectMessages.invalidParameters);s.default.extend(n,{mask:a}),e.remove(n.mask)}return this.isRedo||(i=r.getOptions(t),a=i,e=n,i={},"mask"===t&&(i.object=e.mask),i.options=a,l=this.setUndoData(i,l,o)),r.add(t,n)},undo:function(e,t){var n=e.getComponent(u);if("mask"!==t)return this.undoData.options?n.add(t,this.undoData.options):n.remove(t);var o=this.undoData.object;return e.add(o),e.setActiveObject(o),n.remove(t)}};o.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},c=n(1),u=n(0);var l=u.componentNames.ICON,n={name:u.commandNames.CHANGE_ICON_COLOR,execute:function(i,r,a){var s=this;return new c.Promise(function(e,t){var n=i.getComponent(l),o=i.getObject(r);o||t(u.rejectMessages.noObject),s.undoData.object=o,s.undoData.color=n.getColor(o),n.setColor(a,o),e()})},undo:function(e){var t=e.getComponent(l),n=this.undoData,e=n.object,n=n.color;return t.setColor(n,e),c.Promise.resolve()}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(3)),o=i(n(2)),c=n(1),u=n(0);function i(e){return e&&e.__esModule?e:{default:e}}var l=u.componentNames.SHAPE,h=null;n={name:u.commandNames.CHANGE_SHAPE,execute:function(e,t,n,o){var i,r,a=e.getComponent(l),t=e.getObject(t);return t?(this.isRedo||(r={object:i=t,options:{}},s.default.forEachOwnProperties(n,function(e,t){r.options[t]=i[t]}),h=this.setUndoData(r,h,o)),a.change(t,n)):c.Promise.reject(u.rejectMessages.noObject)},undo:function(e){var t=e.getComponent(l),n=this.undoData,e=n.object,n=n.options;return t.change(e,n)}};o.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);var c=s.componentNames.TEXT,n={name:s.commandNames.CHANGE_TEXT,execute:function(e,t,n){var o=e.getComponent(c),t=e.getObject(t);return t?(this.undoData.object=t,this.undoData.text=o.getText(t),o.change(t,n)):a.Promise.reject(s.rejectMessages.noObject)},undo:function(e){var t=e.getComponent(c),n=this.undoData,e=n.object,n=n.text;return t.change(e,n)}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(3)),o=i(n(2)),c=n(1),u=n(0);function i(e){return e&&e.__esModule?e:{default:e}}var l=u.componentNames.TEXT,h=null;n={name:u.commandNames.CHANGE_TEXT_STYLE,execute:function(e,t,n,o){var i,r,a=e.getComponent(l),t=e.getObject(t);return t?(this.isRedo||(r={object:i=t,styles:{}},s.default.forEachOwnProperties(n,function(e,t){var n=i[t];r.styles[t]=n}),h=this.setUndoData(r,h,o)),a.setStyle(t,n)):c.Promise.reject(u.rejectMessages.noObject)},undo:function(e){var t=e.getComponent(l),n=this.undoData,e=n.object,n=n.styles;return t.setStyle(e,n)}};o.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1);n={name:n(0).commandNames.CLEAR_OBJECTS,execute:function(t){var n=this;return new a.Promise(function(e){n.undoData.objects=t.removeAll(),e()})},undo:function(e){return e.add(this.undoData.objects),a.Promise.resolve()}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},n=n(0);var a=n.componentNames.FLIP,n={name:n.commandNames.FLIP_IMAGE,execute:function(e,t){e=e.getComponent(a);return this.undoData.setting=e.getCurrentSetting(),e[t]()},undo:function(e){return e.getComponent(a).set(this.undoData.setting)}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},n=n(0);var s=n.componentNames.IMAGE_LOADER,n={name:n.commandNames.LOAD_IMAGE,execute:function(e,t,n){var o=e.getComponent(s),i=o.getCanvasImage(),r=i?i.width:0,a=i?i.height:0,e=e.removeAll(!0).filter(function(e){return"cropzone"!==e.type});return e.forEach(function(e){e.evented=!0}),this.undoData={name:o.getImageName(),image:i,objects:e},o.load(t,n).then(function(e){return{oldWidth:r,oldHeight:a,newWidth:e.width,newHeight:e.height}})},undo:function(e){var t=e.getComponent(s),n=this.undoData,o=n.objects,i=n.name,n=n.image;return e.removeAll(!0),e.add(o),t.load(i,n)}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},n=n(0);var a=n.componentNames.FILTER,n={name:n.commandNames.REMOVE_FILTER,execute:function(e,t){e=e.getComponent(a);return this.undoData.options=e.getOptions(t),e.remove(t)},undo:function(e,t){var n=e.getComponent(a),e=this.undoData.options;return n.add(t,e)}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);n={name:s.commandNames.REMOVE_OBJECT,execute:function(n,o){var i=this;return new a.Promise(function(e,t){i.undoData.objects=n.removeObjectById(o),i.undoData.objects.length?e():t(s.rejectMessages.noObject)})},undo:function(e){return e.add(this.undoData.objects),a.Promise.resolve()}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1);n={name:n(0).commandNames.RESIZE_CANVAS_DIMENSION,execute:function(t,n){var o=this;return new a.Promise(function(e){o.undoData.size={width:t.cssMaxWidth,height:t.cssMaxHeight},t.setCssMaxDimension(n),t.adjustCanvasDimension(),e()})},undo:function(e){return e.setCssMaxDimension(this.undoData.size),e.adjustCanvasDimension(),a.Promise.resolve()}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},n=n(0);var a=n.componentNames.ROTATION,s=null;n={name:n.commandNames.ROTATE_IMAGE,execute:function(e,t,n,o){var i=e.getComponent(a);return this.isRedo||(e={angle:i.getCurrentAngle()},s=this.setUndoData(e,s,o)),i[t](n)},undo:function(e){var t=e.getComponent(a),n=this.args,e=n[1],n=n[2];return"setAngle"===e?t[e](this.undoData.angle):t.rotate(-n)}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(3)),o=i(n(2)),a=n(1),s=n(0);function i(e){return e&&e.__esModule?e:{default:e}}n={name:s.commandNames.SET_OBJECT_PROPERTIES,execute:function(e,t,n){var o=this,i=e.getObject(t);return i?(this.undoData.props={},r.default.forEachOwnProperties(n,function(e,t){o.undoData.props[t]=i[t]}),e.setObjectProperties(t,n),a.Promise.resolve()):a.Promise.reject(s.rejectMessages.noObject)},undo:function(e,t){var n=this.undoData.props;return e.setObjectProperties(t,n),a.Promise.resolve()}};o.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);n={name:s.commandNames.SET_OBJECT_POSITION,execute:function(e,t,n){return e.getObject(t)?(this.undoData.objectId=t,this.undoData.props=e.getObjectProperties(t,["left","top"]),e.setObjectPosition(t,n),e.renderAll(),a.Promise.resolve()):a.Promise.reject(s.rejectMessages.noObject)},undo:function(e){var t=this.undoData,n=t.objectId,t=t.props;return e.setObjectProperties(n,t),e.renderAll(),a.Promise.resolve()}};r.default.register(n),t.default=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0),c=n(27);s={name:s.commandNames.CHANGE_SELECTION,execute:function(t,e){return this.isRedo?e.forEach(function(e){t.setObjectProperties(e.id,e)}):this.undoData=(0,c.getCachedUndoDataForDimension)(),a.Promise.resolve()},undo:function(t){return this.undoData.forEach(function(e){t.setObjectProperties(e.id,e)}),a.Promise.resolve()}};r.default.register(s),t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o},n=n(0);var a=n.componentNames.RESIZE,n={name:n.commandNames.RESIZE_IMAGE,execute:function(e,t){var n=e.getComponent(a),e=(e=n.getOriginalDimensions())||n.getCurrentDimensions();return this.undoData.dimensions=e,n.resize(t)},undo:function(e){return e.getComponent(a).resize(this.undoData.dimensions)}};r.default.register(n),t.default=n}],i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/dist",i(i.s=71);function i(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var r,a});
//# sourceMappingURL=tui-image-editor.min.js.map